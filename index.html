<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IT Leadership | Executive Overview</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        /* ============================================
           DESIGN PHILOSOPHY
           - Refined minimalism with healthcare precision
           - Inspired by: Apple clarity, Stripe confidence, Notion organization
           - Typography: Manrope (humanist sans-serif) for warmth + readability
           - Color: Clinical white + navy authority + subtle grays
           - Layout: Asymmetric confidence with generous whitespace
           - Motion: Purposeful, never gratuitous
           ============================================ */

        :root {
            /* Navy palette - authority without intimidation */
            --navy-950: #0a1628;
            --navy-900: #0f1f3a;
            --navy-800: #1a2f4d;
            --navy-700: #2d4266;
            --navy-600: #3d5580;
            --navy-500: #4d6899;
            --navy-400: #7088b3;
            
            /* Neutral palette - clinical precision */
            --white: #ffffff;
            --gray-50: #fafbfc;
            --gray-100: #f4f6f8;
            --gray-200: #e8ecf1;
            --gray-300: #dce1e9;
            --gray-400: #bec6d3;
            --gray-500: #8a95a8;
            --gray-600: #5d6779;
            --gray-700: #3e4554;
            
            /* Accent - trust signals */
            --accent-blue: #2563eb;
            --accent-green: #059669;
            --accent-amber: #d97706;
            
            /* Typography scale */
            --font-display: 'Manrope', system-ui, -apple-system, sans-serif;
            --font-mono: 'IBM Plex Mono', 'SF Mono', Consolas, monospace;
            
            /* Spacing system (4px base) */
            --space-1: 0.25rem;
            --space-2: 0.5rem;
            --space-3: 0.75rem;
            --space-4: 1rem;
            --space-5: 1.25rem;
            --space-6: 1.5rem;
            --space-8: 2rem;
            --space-10: 2.5rem;
            --space-12: 3rem;
            --space-16: 4rem;
            --space-20: 5rem;
            
            /* Shadows - subtle depth */
            --shadow-sm: 0 1px 3px rgba(10, 22, 40, 0.06);
            --shadow-md: 0 4px 12px rgba(10, 22, 40, 0.08);
            --shadow-lg: 0 12px 32px rgba(10, 22, 40, 0.12);
            
            /* Border radius */
            --radius-sm: 6px;
            --radius-md: 10px;
            --radius-lg: 16px;
            --radius-full: 9999px;
            
            /* Transitions */
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-base: 250ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 400ms cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-display);
            background: var(--white);
            color: var(--navy-900);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* ============================================
           LAYOUT STRUCTURE
           ============================================ */

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 0 var(--space-8);
        }

        /* Header - minimal, executive grade */
        .header {
            border-bottom: 1px solid var(--gray-200);
            background: var(--white);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(12px);
            background: rgba(255, 255, 255, 0.92);
        }

        .header-inner {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-5) 0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .logo-mark {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--navy-800), var(--navy-600));
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-weight: 700;
            font-size: 18px;
            letter-spacing: -0.02em;
        }

        .logo-text {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .logo-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--navy-900);
            letter-spacing: -0.01em;
        }

        .logo-subtitle {
            font-size: 12px;
            font-weight: 500;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 0.06em;
        }

        .header-meta {
            display: flex;
            align-items: center;
            gap: var(--space-6);
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2) var(--space-4);
            background: var(--gray-50);
            border-radius: var(--radius-full);
            font-size: 13px;
            font-weight: 500;
            color: var(--gray-600);
        }

        .status-dot {
            width: 6px;
            height: 6px;
            background: var(--accent-green);
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes subtleGlow {
            0%, 100% { 
                box-shadow: 0 0 0 0 rgba(37, 99, 235, 0);
            }
            50% { 
                box-shadow: 0 0 12px 2px rgba(37, 99, 235, 0.4);
            }
        }

        /* Main content area */
        .main {
            padding: var(--space-12) 0;
            min-height: calc(100vh - 80px);
        }

        /* Special handling for Kanban view - reduce left constraint */
        #profile-kanban.active ~ * .content-wrapper,
        .profile-container:has(#profile-kanban.active) {
            max-width: none;
        }

        .content-wrapper {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: var(--space-12);
            align-items: start;
        }

        /* ============================================
           NAVIGATION SIDEBAR
           ============================================ */

        .nav-sidebar {
            position: sticky;
            top: 100px;
        }

        .nav-header {
            margin-bottom: var(--space-6);
            padding-bottom: var(--space-4);
            border-bottom: 1px solid var(--gray-200);
        }

        .nav-title {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--gray-500);
            margin-bottom: var(--space-1);
        }

        .nav-count {
            font-size: 13px;
            color: var(--gray-600);
            font-weight: 500;
        }

        .nav-section {
            margin-bottom: var(--space-6);
        }

        .nav-section-title {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--gray-400);
            margin-bottom: var(--space-3);
            padding-left: var(--space-4);
        }

        .nav-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: var(--space-1);
        }

        .nav-item {
            position: relative;
        }

        .nav-button {
            width: 100%;
            padding: var(--space-3) var(--space-4);
            background: transparent;
            border: none;
            border-radius: var(--radius-md);
            text-align: left;
            font-family: inherit;
            font-size: 15px;
            font-weight: 500;
            color: var(--gray-600);
            cursor: pointer;
            transition: all var(--transition-base);
            display: flex;
            align-items: center;
            gap: var(--space-3);
            position: relative;
        }

        .nav-button::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 3px;
            height: 0;
            background: var(--navy-700);
            border-radius: 0 2px 2px 0;
            transition: height var(--transition-base);
        }

        .nav-button:hover {
            background: var(--gray-50);
            color: var(--navy-700);
        }

        .nav-button.active {
            background: var(--gray-100);
            color: var(--navy-900);
            font-weight: 600;
        }

        .nav-button.active::before {
            height: 24px;
        }

        .nav-initial {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-sm);
            background: var(--gray-100);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            font-weight: 600;
            color: var(--navy-700);
            transition: all var(--transition-base);
        }

        .nav-button.active .nav-initial {
            background: var(--navy-700);
            color: var(--white);
        }

        .nav-details {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .nav-name {
            font-size: 15px;
        }

        .nav-role {
            font-size: 12px;
            color: var(--gray-500);
            font-weight: 400;
        }

        /* ============================================
           PROFILE CARD - Main content area
           ============================================ */

        .profile-container {
            position: relative;
            min-height: 600px;
        }

        .profile-card {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-md);
            opacity: 0;
            transition: opacity var(--transition-slow);
        }

        .profile-card.active {
            opacity: 1;
        }

        .profile-card.exiting {
            opacity: 0;
        }

        .profile-grid {
            display: grid;
            grid-template-columns: 400px 1fr;
            min-height: 600px;
        }

        /* Left side - portrait */
        .profile-image-section {
            position: relative;
            border-right: 1px solid var(--gray-200);
            display: flex;
            flex-direction: column;
            align-items: stretch;
            justify-content: flex-start;
            padding: 0;
            background: linear-gradient(to bottom, transparent 0%, transparent 33.33%, var(--navy-900) 33.33%, var(--navy-800) 100%);
        }

        .profile-image-wrapper {
            position: relative;
            width: 100%;
            height: 33.33%;
            flex-shrink: 0;
            border-radius: 0;
            overflow: hidden;
            background: var(--gray-200);
        }

        /* Placeholder silhouette with initials */
        .profile-image-placeholder {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--gray-300), var(--gray-400));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 96px;
            font-weight: 300;
            color: rgba(255, 255, 255, 0.85);
            letter-spacing: -0.02em;
            transition: all 0.3s ease;
        }

        /* Pop effect in future mode - subtle blue */
        .future-mode .profile-image-placeholder {
            background: linear-gradient(135deg, var(--navy-900), #4A7FB8);
            color: rgba(255, 255, 255, 0.95);
            font-weight: 400;
            box-shadow: 0 4px 16px rgba(37, 99, 235, 0.15);
        }

        /* Replace with actual image by adding:
           <img src="path/to/image.jpg" alt="Name" class="profile-image">
           and style with:
        */
        .profile-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
        }

        .profile-badge {
            position: absolute;
            bottom: var(--space-6);
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(8px);
            padding: var(--space-3) var(--space-5);
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 600;
            color: var(--navy-700);
            box-shadow: 0 4px 12px rgba(10, 22, 40, 0.15);
            text-transform: uppercase;
            letter-spacing: 0.06em;
            z-index: 10;
        }

        .profile-info-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: var(--space-8) var(--space-6);
        }

        .profile-info-title {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: var(--space-6);
        }

        .profile-info-name {
            display: none;
        }

        .profile-info-role {
            display: none;
        }

        .expertise-sidebar {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-2);
            justify-content: center;
            max-width: 340px;
        }

        .expertise-tag-sidebar {
            padding: var(--space-2) var(--space-4);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.9);
            transition: all var(--transition-fast);
            backdrop-filter: blur(4px);
        }

        .expertise-tag-sidebar:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        /* Right side - content */
        .profile-content {
            padding: var(--space-10);
            display: flex;
            flex-direction: column;
            gap: var(--space-8);
        }

        /* Current State: Slightly desaturated/drab appearance */
        .profile-card:not(.future-mode) .profile-image-section {
            filter: saturate(0.7) brightness(0.95);
        }

        .profile-card:not(.future-mode) .profile-image {
            filter: saturate(0.8) brightness(0.98);
        }

        .profile-card:not(.future-mode) .profile-image-placeholder {
            background: linear-gradient(135deg, #3d4654, #5d6779);
        }

        /* Future State: Full color saturation and vibrancy */
        .profile-card.future-mode .profile-image-section {
            filter: saturate(1.05) brightness(1.02);
            transition: filter var(--transition-slow);
        }

        .profile-card.future-mode .profile-image {
            filter: saturate(1.1) brightness(1.02);
            transition: filter var(--transition-slow);
        }

        /* Profile State Toggle */
        .profile-state-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-4);
            background: var(--gray-50);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-6);
        }

        .profile-state-label {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--gray-500);
        }

        .profile-state-buttons {
            display: flex;
            gap: var(--space-2);
        }

        .profile-state-btn {
            padding: var(--space-2) var(--space-4);
            border: 1px solid var(--gray-300);
            background: var(--white);
            border-radius: var(--radius-md);
            font-family: inherit;
            font-size: 12px;
            font-weight: 600;
            color: var(--gray-600);
            cursor: pointer;
            transition: all var(--transition-base);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .profile-state-btn.active.current {
            background: var(--accent-amber);
            border-color: var(--accent-amber);
            color: var(--white);
        }

        .profile-state-btn.active.future {
            background: var(--accent-green);
            border-color: var(--accent-green);
            color: var(--white);
        }

        .profile-state-btn:hover:not(.active) {
            background: var(--gray-100);
            border-color: var(--gray-400);
        }

        .profile-state-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .profile-state-dot.current {
            background: var(--accent-amber);
        }

        .profile-state-dot.future {
            background: var(--accent-green);
        }

        .profile-state-btn.active .profile-state-dot {
            background: var(--white);
        }

        /* Future State Premium Treatment - Subtle Green Accents */
        .profile-card.future-mode {
            position: relative;
        }

        .profile-card.future-mode::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent 0%, var(--accent-green) 50%, transparent 100%);
        }

        .profile-card.future-mode .profile-header {
            position: relative;
        }

        .profile-card.future-mode .profile-title {
            color: var(--navy-700);
        }

        .profile-card.future-mode .accountability-box {
            background: linear-gradient(135deg, var(--navy-900), var(--navy-800));
            box-shadow: 0 8px 24px rgba(10, 22, 40, 0.15);
        }

        .profile-card.future-mode .accountability-box::before {
            content: '';
            display: block;
            position: absolute;
            top: 0;
            right: 0;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(5, 150, 105, 0.15), transparent);
            border-radius: 50%;
        }

        .profile-card.future-mode .accountability-label {
            color: rgba(255, 255, 255, 0.7);
        }

        .profile-card.future-mode .accountability-text {
            color: var(--white);
        }

        .profile-card.future-mode .section-label-icon {
            background: linear-gradient(135deg, var(--accent-green), #10b981);
        }

        .profile-card.future-mode .responsibility-item::before {
            color: var(--accent-green);
        }

        .profile-card.future-mode .engagement-card {
            border-left: 3px solid var(--accent-green);
        }

        .profile-card.future-mode .engagement-card:hover {
            border-color: #10b981;
            box-shadow: 0 4px 16px rgba(5, 150, 105, 0.1);
        }

        .profile-card.future-mode .profile-image-section {
            background: linear-gradient(to bottom, transparent 0%, transparent 33.33%, var(--navy-900) 33.33%, var(--navy-800) 100%);
            border-right: 1px solid rgba(5, 150, 105, 0.15);
        }

        .profile-card.future-mode .expertise-tag-sidebar:hover {
            background: var(--accent-green);
            border-color: var(--accent-green);
            color: var(--white);
        }

        /* Header section */
        .profile-header {
            border-bottom: 1px solid var(--gray-200);
            padding-bottom: var(--space-6);
        }

        .profile-name {
            font-size: 40px;
            font-weight: 700;
            color: var(--navy-900);
            letter-spacing: -0.02em;
            margin-bottom: var(--space-2);
            line-height: 1.1;
        }

        .profile-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--navy-600);
            margin-bottom: var(--space-4);
        }

        .profile-summary {
            font-size: 16px;
            line-height: 1.7;
            color: var(--gray-600);
        }

        /* Content sections */
        .content-section {
            display: flex;
            flex-direction: column;
            gap: var(--space-4);
        }

        .section-label {
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--gray-500);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .section-label-icon {
            width: 4px;
            height: 16px;
            background: var(--navy-700);
            border-radius: 2px;
        }

        /* Responsibilities list */
        .responsibilities-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }

        .responsibility-item {
            padding-left: var(--space-6);
            position: relative;
            font-size: 15px;
            line-height: 1.6;
            color: var(--gray-700);
        }

        .responsibility-item::before {
            content: '→';
            position: absolute;
            left: 0;
            color: var(--navy-600);
            font-weight: 600;
        }

        /* Expertise tags */
        .expertise-grid {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-2);
        }

        .expertise-tag {
            padding: var(--space-2) var(--space-4);
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-full);
            font-size: 13px;
            font-weight: 500;
            color: var(--navy-700);
            transition: all var(--transition-fast);
        }

        .expertise-tag:hover {
            background: var(--navy-700);
            border-color: var(--navy-700);
            color: var(--white);
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        /* Accountability callout */
        .accountability-box {
            background: var(--gray-100);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-md);
            padding: var(--space-6);
            color: var(--navy-800);
            position: relative;
            overflow: hidden;
        }

        .accountability-box::before {
            display: none;
        }

        .accountability-label {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--gray-500);
            margin-bottom: var(--space-3);
            position: relative;
        }

        .accountability-text {
            font-size: 15px;
            line-height: 1.6;
            font-weight: 500;
            position: relative;
            color: var(--navy-700);
        }

        /* Example engagements */
        .engagements-grid {
            display: grid;
            gap: var(--space-4);
        }

        .engagement-card {
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-md);
            padding: var(--space-5);
            transition: all var(--transition-base);
        }

        .engagement-card:hover {
            border-color: var(--navy-400);
            box-shadow: var(--shadow-sm);
            transform: translateX(4px);
        }

        .engagement-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--navy-900);
            margin-bottom: var(--space-2);
        }

        .engagement-description {
            font-size: 14px;
            line-height: 1.6;
            color: var(--gray-600);
        }

        .engagement-metric {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            margin-top: var(--space-3);
            padding: var(--space-2) var(--space-3);
            background: var(--white);
            border-radius: var(--radius-sm);
            font-size: 13px;
            font-weight: 600;
            color: var(--accent-green);
        }

        .engagement-metric-icon {
            font-size: 16px;
        }

        /* ============================================
           RESPONSIVE DESIGN
           ============================================ */

        @media (max-width: 1200px) {
            .content-wrapper {
                grid-template-columns: 240px 1fr;
                gap: var(--space-8);
            }

            .profile-grid {
                grid-template-columns: 320px 1fr;
            }
        }

        @media (max-width: 968px) {
            .content-wrapper {
                grid-template-columns: 1fr;
            }

            .nav-sidebar {
                position: relative;
                top: 0;
                margin-bottom: var(--space-8);
            }

            .nav-list {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: var(--space-2);
            }

            .profile-grid {
                grid-template-columns: 1fr;
            }

            .profile-image-section {
                min-height: 400px;
            }

            .profile-content {
                padding: var(--space-8);
            }
        }

        @media (max-width: 640px) {
            .container {
                padding: 0 var(--space-4);
            }

            .main {
                padding: var(--space-8) 0;
            }

            .profile-name {
                font-size: 32px;
            }

            .profile-title {
                font-size: 16px;
            }

            .header-meta {
                display: none;
            }
        }

        /* ============================================
           UTILITY CLASSES
           ============================================ */

        .hidden {
            display: none !important;
        }

        /* Smooth transitions between cards */
        .profile-card {
            animation: fadeIn var(--transition-slow);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(8px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ============================================
           HEAT MAP STYLES
           ============================================ */

        .heatmap-container {
            padding: var(--space-10);
            overflow-x: auto;
        }

        .heatmap-header {
            margin-bottom: var(--space-8);
            border-bottom: 1px solid var(--gray-200);
            padding-bottom: var(--space-6);
        }

        .heatmap-title {
            font-size: 32px;
            font-weight: 700;
            color: var(--navy-900);
            letter-spacing: -0.02em;
            margin-bottom: var(--space-3);
            line-height: 1.1;
        }

        .heatmap-subtitle {
            font-size: 16px;
            line-height: 1.7;
            color: var(--gray-600);
            margin-bottom: var(--space-4);
        }

        .heatmap-legend {
            display: flex;
            gap: var(--space-6);
            flex-wrap: wrap;
            margin-top: var(--space-4);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            font-size: 13px;
            font-weight: 500;
            color: var(--gray-700);
        }

        .legend-badge {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 12px;
        }

        .legend-badge.accountable {
            background: var(--navy-800);
            color: var(--white);
        }

        .legend-badge.responsible {
            background: var(--accent-blue);
            color: var(--white);
        }

        .legend-badge.consulted {
            background: var(--gray-300);
            color: var(--gray-700);
        }

        .legend-badge.informed {
            background: var(--gray-100);
            color: var(--gray-600);
        }

        .heatmap-table-wrapper {
            overflow-x: auto;
            margin: var(--space-6) 0;
        }

        .heatmap-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            font-size: 14px;
        }

        .heatmap-table thead th {
            background: var(--navy-900);
            color: var(--white);
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            padding: var(--space-4);
            text-align: left;
            position: sticky;
            top: 0;
            z-index: 10;
            border-bottom: 2px solid var(--navy-800);
        }

        .heatmap-table thead th:first-child {
            border-top-left-radius: var(--radius-md);
        }

        .heatmap-table thead th:last-child {
            border-top-right-radius: var(--radius-md);
        }

        .heatmap-table tbody tr {
            border-bottom: 1px solid var(--gray-200);
        }

        .heatmap-table tbody tr:hover {
            background: var(--gray-50);
        }

        .heatmap-table tbody td {
            padding: var(--space-4);
            vertical-align: top;
        }

        .heatmap-table tbody td:first-child {
            font-weight: 600;
            color: var(--navy-900);
            background: var(--gray-50);
            position: sticky;
            left: 0;
            z-index: 5;
        }

        .heatmap-cell {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-1);
            min-height: 32px;
            flex-wrap: wrap;
            padding: var(--space-1);
        }

        .heatmap-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border-radius: var(--radius-sm);
            font-weight: 700;
            font-size: 12px;
            transition: all var(--transition-fast);
            cursor: pointer;
            user-select: none;
            flex-shrink: 0;
        }

        .heatmap-badge:hover {
            transform: scale(1.15);
            box-shadow: var(--shadow-md);
            z-index: 10;
            position: relative;
        }

        .heatmap-badge.a {
            background: var(--navy-800);
            color: var(--white);
        }

        .heatmap-badge.r {
            background: var(--accent-blue);
            color: var(--white);
        }

        .heatmap-badge.c {
            background: var(--gray-300);
            color: var(--gray-700);
        }

        .heatmap-badge.i {
            background: var(--gray-100);
            color: var(--gray-600);
        }

        .heatmap-badge.empty {
            background: transparent;
            border: 2px dashed var(--gray-200);
            color: var(--gray-300);
            font-weight: 400;
        }

        .heatmap-badge.empty:hover {
            border-color: var(--accent-blue);
            color: var(--accent-blue);
        }

        .heatmap-edit-mode {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2) var(--space-4);
            background: var(--accent-amber);
            color: var(--white);
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 600;
            margin-left: var(--space-4);
        }

        .heatmap-help {
            font-size: 12px;
            color: var(--gray-500);
            margin-top: var(--space-2);
            font-style: italic;
        }

        .section-divider {
            margin: var(--space-8) 0;
            border-top: 2px solid var(--gray-200);
        }

        /* ============================================
           KANBAN BOARD STYLES
           ============================================ */

        .kanban-container {
            padding: var(--space-10);
            min-height: 100vh;
        }

        .kanban-header {
            margin-bottom: var(--space-8);
            border-bottom: 1px solid var(--gray-200);
            padding-bottom: var(--space-6);
        }

        .kanban-title {
            font-size: 32px;
            font-weight: 700;
            color: var(--navy-900);
            letter-spacing: -0.02em;
            margin-bottom: var(--space-3);
            line-height: 1.1;
        }

        .kanban-subtitle {
            font-size: 16px;
            line-height: 1.7;
            color: var(--gray-600);
            margin-bottom: var(--space-6);
        }

        .kanban-controls {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--space-4);
            flex-wrap: wrap;
        }

        .state-toggle {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            background: var(--gray-100);
            padding: var(--space-2);
            border-radius: var(--radius-full);
        }

        .state-toggle-btn {
            padding: var(--space-3) var(--space-6);
            border: none;
            background: transparent;
            border-radius: var(--radius-full);
            font-family: inherit;
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-600);
            cursor: pointer;
            transition: all var(--transition-base);
        }

        .state-toggle-btn.active {
            background: var(--navy-800);
            color: var(--white);
            box-shadow: var(--shadow-sm);
        }

        .state-toggle-btn:hover:not(.active) {
            color: var(--navy-700);
        }

        .kanban-actions {
            display: flex;
            gap: var(--space-3);
        }

        .kanban-btn {
            padding: var(--space-3) var(--space-5);
            border: 1px solid var(--gray-300);
            background: var(--white);
            border-radius: var(--radius-md);
            font-family: inherit;
            font-size: 14px;
            font-weight: 600;
            color: var(--navy-700);
            cursor: pointer;
            transition: all var(--transition-base);
        }

        .kanban-btn:hover {
            background: var(--navy-800);
            color: var(--white);
            border-color: var(--navy-800);
        }

        .kanban-btn.primary {
            background: var(--accent-blue);
            color: var(--white);
            border-color: var(--accent-blue);
        }

        .kanban-btn.primary:hover {
            background: #1e50cc;
            border-color: #1e50cc;
        }

        .kanban-btn.authenticated {
            background: var(--accent-green);
            border-color: var(--accent-green);
            color: var(--white);
        }

        .kanban-btn.authenticated:hover {
            background: #047857;
            border-color: #047857;
        }

        .kanban-board {
            display: grid;
            grid-template-columns: 420px repeat(6, minmax(210px, 1fr));
            gap: var(--space-5);
            margin-top: var(--space-6);
            align-items: start;
            min-width: 1800px;
        }

        .kanban-column {
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: var(--space-5);
            min-height: 400px;
            display: flex;
            flex-direction: column;
        }

        .kanban-column.backlog {
            background: var(--white);
            border: 2px dashed var(--gray-300);
        }

        .kanban-column.drag-over {
            background: rgba(37, 99, 235, 0.05);
            border-color: var(--accent-blue);
        }

        .kanban-column-header {
            margin-bottom: var(--space-4);
            padding-bottom: var(--space-3);
            border-bottom: 2px solid var(--gray-200);
        }

        .kanban-column-title {
            font-size: 13px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--navy-800);
            margin-bottom: var(--space-1);
        }

        .kanban-column-count {
            font-size: 12px;
            color: var(--gray-500);
            font-weight: 500;
        }

        .kanban-cards {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
            min-height: 200px;
        }

        .kanban-card {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-md);
            padding: var(--space-4);
            cursor: grab;
            transition: all var(--transition-base);
            user-select: none;
        }

        .kanban-card:hover {
            box-shadow: var(--shadow-md);
            border-color: var(--navy-400);
            transform: translateY(-2px);
        }

        .kanban-card.dragging {
            opacity: 0.5;
            cursor: grabbing;
            transform: rotate(2deg);
        }

        .kanban-card-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--navy-900);
            line-height: 1.4;
            margin-bottom: var(--space-2);
        }

        .kanban-card-meta {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            font-size: 11px;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 0.06em;
            font-weight: 600;
        }

        .kanban-card-badge {
            padding: var(--space-1) var(--space-2);
            background: var(--gray-100);
            border-radius: var(--radius-sm);
            font-size: 10px;
            font-weight: 700;
            color: var(--gray-600);
        }

        .kanban-card-badge.current {
            background: var(--accent-amber);
            color: var(--white);
        }

        .kanban-card-badge.future {
            background: var(--accent-green);
            color: var(--white);
        }

        .kanban-card-star {
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
            padding: 0;
            margin-left: var(--space-2);
            transition: transform var(--transition-base);
            opacity: 0.5;
        }

        .kanban-card-star:hover {
            transform: scale(1.2);
            opacity: 1;
        }

        .kanban-card-star.active {
            opacity: 1;
        }

        .kanban-empty {
            text-align: center;
            padding: var(--space-8) var(--space-4);
            color: var(--gray-400);
            font-size: 13px;
            font-style: italic;
        }

        .add-responsibility {
            margin-top: var(--space-4);
            padding-top: var(--space-4);
            border-top: 1px solid var(--gray-200);
        }

        .add-responsibility-input {
            width: 100%;
            padding: var(--space-3);
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-md);
            font-family: inherit;
            font-size: 14px;
            color: var(--navy-900);
            resize: vertical;
            min-height: 60px;
            margin-bottom: var(--space-2);
            transition: all var(--transition-base);
        }

        .add-responsibility-input:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .add-responsibility-input::placeholder {
            color: var(--gray-400);
        }

        .add-responsibility-btn {
            width: 100%;
            padding: var(--space-3);
            background: var(--accent-blue);
            color: var(--white);
            border: none;
            border-radius: var(--radius-md);
            font-family: inherit;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-base);
        }

        .add-responsibility-btn:hover {
            background: #1e50cc;
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        .add-responsibility-btn:active {
            transform: translateY(0);
        }

        .comparison-indicator {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2) var(--space-4);
            background: var(--gray-100);
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 600;
            color: var(--gray-600);
            margin-top: var(--space-4);
        }

        .comparison-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent-amber);
        }

        .comparison-dot.future {
            background: var(--accent-green);
        }

        @media (max-width: 1400px) {
            .kanban-board {
                grid-template-columns: 280px repeat(6, minmax(200px, 1fr));
                overflow-x: auto;
            }
        }

        @media (max-width: 968px) {
            .kanban-board {
                grid-template-columns: 1fr;
                overflow-x: visible;
            }

            .kanban-column {
                min-height: auto;
            }

            .kanban-container {
                margin-left: 0;
                width: 100%;
            }
        }

        /* ============================================
           BUDGET VIEW STYLES
           ============================================ */

        .budget-container {
            padding: var(--space-10);
        }

        .budget-header {
            margin-bottom: var(--space-8);
            border-bottom: 1px solid var(--gray-200);
            padding-bottom: var(--space-6);
        }

        .budget-title {
            font-size: 32px;
            font-weight: 700;
            color: var(--navy-900);
            letter-spacing: -0.02em;
            margin-bottom: var(--space-3);
            line-height: 1.1;
        }

        .budget-subtitle {
            font-size: 16px;
            line-height: 1.7;
            color: var(--gray-600);
            margin-bottom: var(--space-6);
        }

        .budget-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--space-6);
            margin-bottom: var(--space-8);
        }

        .budget-card {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: var(--space-6);
            transition: all var(--transition-base);
        }

        .budget-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .budget-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-4);
        }

        .budget-card-title {
            font-size: 13px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--gray-500);
        }

        .budget-card-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--navy-900);
            letter-spacing: -0.02em;
            margin-bottom: var(--space-2);
        }

        .budget-card-change {
            font-size: 13px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: var(--space-1);
        }

        .budget-card-change.positive {
            color: var(--accent-green);
        }

        .budget-card-change.neutral {
            color: var(--gray-500);
        }

        .budget-table-wrapper {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            overflow: hidden;
        }

        .budget-table {
            width: 100%;
            border-collapse: collapse;
        }

        .budget-table thead {
            background: var(--navy-900);
            color: var(--white);
        }

        .budget-table thead th {
            padding: var(--space-4) var(--space-5);
            text-align: left;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        .budget-table thead th:last-child {
            text-align: right;
        }

        .budget-table tbody tr {
            border-bottom: 1px solid var(--gray-200);
        }

        .budget-table tbody tr:hover {
            background: var(--gray-50);
        }

        .budget-table tbody td {
            padding: var(--space-4) var(--space-5);
            font-size: 14px;
        }

        .budget-table tbody td:last-child {
            text-align: right;
            font-weight: 600;
            color: var(--navy-900);
        }

        .budget-category {
            font-weight: 600;
            color: var(--navy-900);
        }

        .budget-subcategory {
            color: var(--gray-600);
            padding-left: var(--space-6);
            position: relative;
        }

        .budget-subcategory::before {
            content: '└';
            position: absolute;
            left: var(--space-3);
            color: var(--gray-400);
        }

        .budget-total-row {
            background: var(--gray-100);
            font-weight: 700;
        }

        .budget-total-row td {
            color: var(--navy-900);
            font-size: 16px;
            padding: var(--space-5);
        }

        /* ============================================
           BUDGET PLANNER STYLES
           ============================================ */

        .planner-controls {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--space-4);
            margin-bottom: var(--space-6);
            padding: var(--space-5);
            background: var(--gray-50);
            border-radius: var(--radius-lg);
            flex-wrap: wrap;
        }

        .planner-mode-toggle {
            display: flex;
            gap: var(--space-2);
        }

        .planner-actions {
            display: flex;
            gap: var(--space-3);
        }

        .planner-summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-4);
            margin-bottom: var(--space-8);
        }

        .planner-summary-card {
            background: var(--white);
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: var(--space-5);
            transition: all var(--transition-base);
        }

        .planner-summary-card.current {
            opacity: 0.5;
            border-style: dashed;
        }

        .planner-summary-card.proposed {
            border-color: var(--navy-700);
        }

        .planner-summary-card.risk-high {
            border-color: #dc2626;
            background: linear-gradient(135deg, #fef2f2, var(--white));
        }

        .planner-summary-card.risk-medium {
            border-color: #f59e0b;
            background: linear-gradient(135deg, #fffbeb, var(--white));
        }

        .planner-summary-card.risk-low {
            border-color: var(--accent-green);
            background: linear-gradient(135deg, #f0fdf4, var(--white));
        }

        .planner-item {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: var(--space-6);
            margin-bottom: var(--space-4);
            transition: all var(--transition-base);
        }

        .planner-item:hover {
            box-shadow: var(--shadow-md);
        }

        .planner-item-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: var(--space-5);
            gap: var(--space-4);
        }

        .planner-item-info {
            flex: 1;
        }

        .planner-item-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--navy-900);
            margin-bottom: var(--space-2);
        }

        .planner-item-values {
            display: flex;
            align-items: center;
            gap: var(--space-6);
            flex-wrap: wrap;
        }

        .planner-value {
            display: flex;
            flex-direction: column;
            gap: var(--space-1);
        }

        .planner-value-label {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--gray-500);
        }

        .planner-value-amount {
            font-size: 24px;
            font-weight: 700;
            color: var(--navy-900);
        }

        .planner-value-amount.current {
            color: var(--gray-400);
        }

        .planner-slider-container {
            margin-bottom: var(--space-4);
        }

        .planner-slider-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-3);
        }

        .planner-slider-labels {
            display: flex;
            gap: var(--space-4);
            font-size: 12px;
        }

        .planner-slider-label {
            color: var(--gray-500);
        }

        .planner-slider-wrapper {
            position: relative;
            padding: var(--space-3) 0;
        }

        .planner-slider-sweetspot {
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 3px;
            height: 20px;
            background: var(--navy-900);
            border-radius: 2px;
            pointer-events: none;
            z-index: 5;
        }

        .planner-slider-sweetspot::after {
            content: '⭐';
            position: absolute;
            top: -28px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 16px;
        }

        .planner-slider {
            width: 100%;
            height: 8px;
            border-radius: var(--radius-full);
            background: linear-gradient(90deg, 
                #450a0a 0%,      /* Dark Red - Severely Underfunded */
                #dc2626 12.5%,   /* Red - High Risk */
                #f59e0b 25%,     /* Yellow - Caution */
                #059669 50%,     /* Green - Optimal */
                #f59e0b 75%,     /* Yellow - Premium */
                #dc2626 87.5%,   /* Red - Overfunding */
                #450a0a 100%     /* Dark Red - Severe Overspend */
            );
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        .planner-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--white);
            border: 3px solid var(--navy-800);
            cursor: grab;
            box-shadow: var(--shadow-md);
            transition: all var(--transition-fast);
        }

        .planner-slider::-webkit-slider-thumb:active {
            cursor: grabbing;
            transform: scale(1.2);
        }

        .planner-slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--white);
            border: 3px solid var(--navy-800);
            cursor: grab;
            box-shadow: var(--shadow-md);
        }

        .planner-risk-indicator {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2) var(--space-4);
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.06em;
        }

        .planner-risk-indicator.high {
            background: #fef2f2;
            color: #dc2626;
            border: 2px solid #dc2626;
        }

        .planner-risk-indicator.medium {
            background: #fffbeb;
            color: #d97706;
            border: 2px solid #f59e0b;
        }

        .planner-risk-indicator.low {
            background: #f0fdf4;
            color: #059669;
            border: 2px solid var(--accent-green);
        }

        .planner-impact-box {
            background: var(--gray-50);
            border-left: 4px solid var(--gray-300);
            padding: var(--space-4);
            border-radius: var(--radius-md);
            font-size: 14px;
            line-height: 1.6;
            color: var(--gray-700);
        }

        .planner-impact-box.risk-high {
            background: #fef2f2;
            border-left-color: #dc2626;
            color: #7f1d1d;
        }

        .planner-impact-box.risk-medium {
            background: #fffbeb;
            border-left-color: #f59e0b;
            color: #78350f;
        }

        .planner-impact-box.risk-low {
            background: #f0fdf4;
            border-left-color: var(--accent-green);
            color: #14532d;
        }

        .planner-tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-2);
            margin-bottom: var(--space-4);
            min-height: 32px;
        }

        .planner-tag {
            display: inline-flex;
            align-items: center;
            gap: var(--space-1);
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-md);
            font-size: 12px;
            font-weight: 600;
            border: 2px solid;
            transition: all var(--transition-fast);
        }

        .planner-tag.risk {
            background: #fef2f2;
            border-color: #dc2626;
            color: #7f1d1d;
        }

        .planner-tag.caution {
            background: #fffbeb;
            border-color: #f59e0b;
            color: #78350f;
        }

        .planner-tag.optimal {
            background: #f0fdf4;
            border-color: var(--accent-green);
            color: #14532d;
        }

        .planner-tag.premium {
            background: #eff6ff;
            border-color: #3b82f6;
            color: #1e3a8a;
        }

        .planner-tag.overspend {
            background: #450a0a;
            border-color: #7f1d1d;
            color: #fef2f2;
        }

        .planner-subcategories {
            margin-left: var(--space-8);
            padding-left: var(--space-6);
            border-left: 3px solid var(--gray-200);
            margin-top: var(--space-4);
        }

        .planner-subcategory-item {
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-md);
            padding: var(--space-5);
            margin-bottom: var(--space-3);
        }

        .planner-subcategory-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-4);
        }

        .planner-subcategory-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--navy-800);
        }

        .planner-subcategory-actions {
            display: flex;
            gap: var(--space-2);
        }

        .planner-icon-btn {
            width: 28px;
            height: 28px;
            border: 1px solid var(--gray-300);
            background: var(--white);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: 14px;
        }

        .planner-icon-btn:hover {
            background: var(--gray-100);
            border-color: var(--gray-400);
        }

        .planner-icon-btn.danger:hover {
            background: #fef2f2;
            border-color: #dc2626;
            color: #dc2626;
        }

        .planner-add-item-form {
            display: flex;
            gap: var(--space-3);
            padding: var(--space-4);
            background: var(--white);
            border: 2px dashed var(--gray-300);
            border-radius: var(--radius-md);
            margin-top: var(--space-3);
        }

        .planner-add-item-form input {
            flex: 1;
            padding: var(--space-2) var(--space-3);
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-md);
            font-size: 14px;
        }

        .planner-view-toggle {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2) var(--space-4);
            background: var(--white);
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-md);
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-base);
        }

        .planner-view-toggle:hover {
            background: var(--gray-50);
            border-color: var(--gray-400);
        }

        .planner-view-toggle.active {
            background: var(--navy-800);
            border-color: var(--navy-800);
            color: var(--white);
        }

        .planner-manual-input {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            margin-top: var(--space-3);
        }

        .planner-manual-input input {
            padding: var(--space-2) var(--space-3);
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-md);
            font-size: 14px;
            font-weight: 600;
            width: 120px;
        }

        .planner-manual-input.deep-red input {
            border-color: #7f1d1d;
            background: #fef2f2;
            color: #7f1d1d;
        }

        /* ============================================
           BUDGET PLANNER TABLE VIEW
           ============================================ */

        .budget-table-planner {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }

        .budget-table-planner thead th {
            position: sticky;
            top: 0;
            background: var(--navy-900);
            color: var(--white);
            padding: var(--space-4) var(--space-5);
            text-align: left;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            z-index: 10;
        }

        .budget-table-planner tbody tr {
            border-bottom: 1px solid var(--gray-200);
            transition: all var(--transition-fast);
        }

        .budget-table-planner tbody tr:hover {
            background: var(--gray-50);
        }

        .budget-table-planner tbody tr.category-row {
            background: var(--gray-100);
            font-weight: 700;
        }

        .budget-table-planner tbody tr.category-row td {
            padding: var(--space-5);
            font-size: 16px;
            color: var(--navy-900);
        }

        .budget-table-planner tbody tr.subcategory-row td {
            padding: var(--space-4) var(--space-5);
        }

        .budget-table-planner tbody tr.risk-critical {
            background: linear-gradient(90deg, #fef2f2 0%, var(--white) 100%);
            border-left: 4px solid #dc2626;
        }

        .budget-table-planner tbody tr.risk-critical:hover {
            background: linear-gradient(90deg, #fee2e2 0%, var(--gray-50) 100%);
        }

        .budget-table-planner tbody tr.risk-severe {
            background: linear-gradient(90deg, #450a0a 0%, #7f1d1d 100%);
            border-left: 4px solid #450a0a;
        }

        .budget-table-planner tbody tr.risk-severe td {
            color: var(--white);
        }

        .budget-table-planner tbody tr.risk-severe:hover {
            background: linear-gradient(90deg, #7f1d1d 0%, #991b1b 100%);
        }

        .budget-table-planner tbody tr.risk-severe .table-description,
        .budget-table-planner tbody tr.risk-severe .table-value-display {
            color: rgba(255, 255, 255, 0.9);
        }

        .budget-table-planner td.category-cell {
            font-weight: 600;
            color: var(--navy-800);
            font-size: 14px;
            width: 22%;
        }

        .budget-table-planner td.description-cell {
            width: 38%;
        }

        .budget-table-planner td.slider-cell {
            width: 40%;
            padding: var(--space-3) var(--space-5);
        }

        .table-description {
            font-size: 13px;
            color: var(--gray-600);
            line-height: 1.5;
            margin-bottom: var(--space-2);
        }

        .table-slider-wrapper {
            display: flex;
            align-items: center;
            gap: var(--space-4);
        }

        .table-slider-container {
            flex: 1;
            min-width: 200px;
        }

        .table-slider {
            width: 100%;
            height: 6px;
            border-radius: var(--radius-full);
            background: linear-gradient(90deg, 
                #450a0a 0%,
                #dc2626 12.5%,
                #f59e0b 25%,
                #059669 50%,
                #f59e0b 75%,
                #dc2626 87.5%,
                #450a0a 100%
            );
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        .table-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--white);
            border: 2px solid var(--navy-800);
            cursor: grab;
            box-shadow: var(--shadow-sm);
        }

        .table-slider::-webkit-slider-thumb:active {
            cursor: grabbing;
        }

        .table-slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--white);
            border: 2px solid var(--navy-800);
            cursor: grab;
            box-shadow: var(--shadow-sm);
        }

        .table-value-display {
            font-size: 16px;
            font-weight: 700;
            color: var(--navy-900);
            min-width: 80px;
            text-align: right;
        }

        .table-manual-input {
            width: 90px;
            padding: var(--space-2);
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-md);
            font-size: 13px;
            font-weight: 600;
            text-align: right;
        }

        /* Modal styles */
        .config-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .config-modal.active {
            display: flex;
        }

        .config-modal-content {
            background: var(--white);
            border-radius: var(--radius-lg);
            padding: var(--space-8);
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
        }

        .config-modal-header {
            margin-bottom: var(--space-6);
        }

        .config-modal-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--navy-900);
            margin-bottom: var(--space-2);
        }

        .config-modal-subtitle {
            font-size: 14px;
            color: var(--gray-600);
            line-height: 1.6;
        }

        .config-item {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: var(--space-4);
            padding: var(--space-4);
            border-bottom: 1px solid var(--gray-200);
            align-items: center;
        }

        .config-item:hover {
            background: var(--gray-50);
        }

        .config-item-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--navy-800);
        }

        .config-item-input {
            padding: var(--space-3);
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-md);
            font-size: 14px;
            font-weight: 600;
            text-align: right;
        }

        .config-modal-actions {
            display: flex;
            gap: var(--space-3);
            justify-content: flex-end;
            margin-top: var(--space-6);
            padding-top: var(--space-6);
            border-top: 2px solid var(--gray-200);
        }

        .add-item-modal-form {
            display: flex;
            flex-direction: column;
            gap: var(--space-4);
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }

        .form-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--navy-800);
        }

        .form-input,
        .form-select,
        .form-textarea {
            padding: var(--space-3);
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-md);
            font-size: 14px;
        }

        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }
    </style>
    <!-- Google Identity Services for OAuth -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
    <!-- ============================================
         HEADER
         ============================================ -->
    <header class="header">
        <div class="container">
            <div class="header-inner">
                <div class="logo">
                    <div class="logo-mark">IT</div>
                    <div class="logo-text">
                        <div class="logo-title">Information Technology</div>
                        <div class="logo-subtitle">Leadership Overview</div>
                    </div>
                </div>
                <div class="header-meta">
                    <div class="status-indicator">
                        <span class="status-dot"></span>
                        <span>6 Team Members + Heat Map</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- ============================================
         MAIN CONTENT
         ============================================ -->
    <main class="main">
        <div class="container">
            <div class="content-wrapper">
                
                <!-- Navigation Sidebar -->
                <nav class="nav-sidebar">
                    <div class="nav-header">
                        <div class="nav-title">2026-2028 Operations Field Guide</div>
                        <div class="nav-count">Strategic Planning & Execution</div>
                    </div>

                    <!-- SECTION: IT Team Structure -->
                    <div class="nav-section">
                        <div class="nav-section-title">IT Team Structure</div>
                        <ul class="nav-list" role="tablist">
                            <li class="nav-item">
                                <button class="nav-button active" 
                                        data-profile="anthony" 
                                        role="tab"
                                        aria-selected="true"
                                        aria-controls="profile-anthony">
                                    <div class="nav-initial">A</div>
                                    <div class="nav-details">
                                        <div class="nav-name">Anthony Trujillo</div>
                                        <div class="nav-role">VP-Level Lead</div>
                                    </div>
                                </button>
                            </li>
                            <li class="nav-item">
                                <button class="nav-button" 
                                        data-profile="geremia"
                                        role="tab"
                                        aria-selected="false"
                                        aria-controls="profile-geremia">
                                    <div class="nav-initial">G</div>
                                    <div class="nav-details">
                                        <div class="nav-name">Geremia Doan</div>
                                        <div class="nav-role">Infrastructure Lead</div>
                                    </div>
                                </button>
                            </li>
                            <li class="nav-item">
                                <button class="nav-button" 
                                        data-profile="francis"
                                        role="tab"
                                        aria-selected="false"
                                        aria-controls="profile-francis">
                                    <div class="nav-initial">F</div>
                                    <div class="nav-details">
                                        <div class="nav-name">Francis Ferma</div>
                                        <div class="nav-role">Service Delivery</div>
                                    </div>
                                </button>
                            </li>
                            <li class="nav-item">
                                <button class="nav-button" 
                                        data-profile="tom"
                                        role="tab"
                                        aria-selected="false"
                                        aria-controls="profile-tom">
                                    <div class="nav-initial">T</div>
                                    <div class="nav-details">
                                        <div class="nav-name">Tom Jarrell</div>
                                        <div class="nav-role">Systems Admin</div>
                                    </div>
                                </button>
                            </li>
                            <li class="nav-item">
                                <button class="nav-button" 
                                        data-profile="rogi"
                                        role="tab"
                                        aria-selected="false"
                                        aria-controls="profile-rogi">
                                    <div class="nav-initial">R</div>
                                    <div class="nav-details">
                                        <div class="nav-name">Rogi Poblete</div>
                                        <div class="nav-role">Clinical Systems</div>
                                    </div>
                                </button>
                            </li>
                            <li class="nav-item">
                                <button class="nav-button" 
                                        data-profile="jon"
                                        role="tab"
                                        aria-selected="false"
                                        aria-controls="profile-jon">
                                    <div class="nav-initial">J</div>
                                    <div class="nav-details">
                                        <div class="nav-name">Jon</div>
                                        <div class="nav-role">Database Admin</div>
                                    </div>
                                </button>
                            </li>
                            <li class="nav-item">
                                <button class="nav-button" 
                                        data-profile="heatmap"
                                        role="tab"
                                        aria-selected="false"
                                        aria-controls="profile-heatmap">
                                    <div class="nav-initial">◫</div>
                                    <div class="nav-details">
                                        <div class="nav-name">RACI Matrix</div>
                                        <div class="nav-role">Accountability Map</div>
                                    </div>
                                </button>
                            </li>
                            <li class="nav-item">
                                <button class="nav-button" 
                                        data-profile="kanban"
                                        role="tab"
                                        aria-selected="false"
                                        aria-controls="profile-kanban">
                                    <div class="nav-initial">⊞</div>
                                    <div class="nav-details">
                                        <div class="nav-name">Responsibility Planner</div>
                                        <div class="nav-role">Kanban Board</div>
                                    </div>
                                </button>
                            </li>
                        </ul>
                    </div>

                    <!-- SECTION: Project Planning -->
                    <div class="nav-section">
                        <div class="nav-section-title">Project Planning</div>
                        <ul class="nav-list" role="tablist">
                            <li class="nav-item">
                                <button class="nav-button" 
                                        data-profile="project-roadmap"
                                        role="tab"
                                        aria-selected="false"
                                        aria-controls="profile-project-roadmap">
                                    <div class="nav-initial">📅</div>
                                    <div class="nav-details">
                                        <div class="nav-name">Project Roadmap</div>
                                        <div class="nav-role">2026-2028 Timeline</div>
                                    </div>
                                </button>
                            </li>
                        </ul>
                    </div>

                    <!-- SECTION: Budget & Financial Planning -->
                    <div class="nav-section">
                        <div class="nav-section-title">Budget & Finance</div>
                        <ul class="nav-list" role="tablist">
                            <li class="nav-item">
                                <button class="nav-button" 
                                        data-profile="budget"
                                        role="tab"
                                        aria-selected="false"
                                        aria-controls="profile-budget">
                                    <div class="nav-initial">$</div>
                                    <div class="nav-details">
                                        <div class="nav-name">2026 IT Budget</div>
                                        <div class="nav-role">Annual Overview</div>
                                    </div>
                                </button>
                            </li>
                            <li class="nav-item">
                                <button class="nav-button" 
                                        data-profile="budget-planner-table"
                                        role="tab"
                                        aria-selected="false"
                                        aria-controls="profile-budget-planner-table">
                                    <div class="nav-initial">📋</div>
                                    <div class="nav-details">
                                        <div class="nav-name">Budget Planner</div>
                                        <div class="nav-role">Interactive Planning</div>
                                    </div>
                                </button>
                            </li>
                            <li class="nav-item">
                                <button class="nav-button" 
                                        data-profile="facility-calculator"
                                        role="tab"
                                        aria-selected="false"
                                        aria-controls="profile-facility-calculator">
                                    <div class="nav-initial">+</div>
                                    <div class="nav-details">
                                        <div class="nav-name">Facility Calculator</div>
                                        <div class="nav-role">New Facility Costs</div>
                                    </div>
                                </button>
                            </li>
                        </ul>
                    </div>
                </nav>

                <!-- Profile Cards Container -->
                <div class="profile-container">
                    
                    <!-- ==================== ANTHONY ==================== -->
                    <div id="profile-anthony" class="profile-card active" role="tabpanel" aria-labelledby="nav-anthony">
                        <div class="profile-grid">
                            <!-- Left: Image -->
                            <div class="profile-image-section">
                                <div class="profile-image-wrapper">
                                    <div class="profile-image-placeholder">AT</div>
                                </div>
                                <div class="profile-info-panel">
                                    <div class="profile-info-title">Areas of Expertise</div>
                                    <div class="expertise-sidebar">
                                        <span class="expertise-tag-sidebar">Technology Strategy</span>
                                        <span class="expertise-tag-sidebar">Business Systems Architecture</span>
                                        <span class="expertise-tag-sidebar">Software Asset Management (SAM)</span>
                                        <span class="expertise-tag-sidebar">Enterprise Mobility & Device Management</span>
                                        <span class="expertise-tag-sidebar">Vendor & Financial Governance</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Right: Content -->
                            <div class="profile-content">
                                <!-- State Toggle -->
                                <div class="profile-state-toggle">
                                    <span class="profile-state-label">Viewing</span>
                                    <div class="profile-state-buttons">
                                        <button class="profile-state-btn active current" data-state="current" data-person="anthony">
                                            <span class="profile-state-dot current"></span>
                                            Current State
                                        </button>
                                        <button class="profile-state-btn future" data-state="future" data-person="anthony">
                                            <span class="profile-state-dot future"></span>
                                            Future State
                                        </button>
                                    </div>
                                </div>

                                <!-- Header -->
                                <div class="profile-header">
                                    <h1 class="profile-name">Anthony Trujillo</h1>
                                    <h2 class="profile-title" data-current="IT Director, South" data-future="Vice President, Business Systems & Technology">IT Director, South</h2>
                                    <p class="profile-summary" 
                                       data-current="Anthony manages regional IT operations across the southern facilities, serving as the hands-on leader coordinating infrastructure, security, and end-user support. He oversees vendor relationships, equipment lifecycle, and day-to-day technology operations while ensuring alignment with organizational needs."
                                       data-future="Anthony transitions into executive leadership as VP, focusing on enterprise strategy, financial governance, and scalable technology architecture. He serves as the architect and steward of the department's long-term vision, ensuring systems support organizational growth, risk reduction, and operational efficiency across all facilities.">
                                        Anthony manages regional IT operations across the southern facilities, serving as the hands-on leader coordinating infrastructure, security, and end-user support.
                                    </p>
                                </div>

                                <!-- Accountability -->
                                <div class="content-section">
                                    <div class="accountability-box">
                                        <div class="accountability-label">Primary Accountability</div>
                                        <div class="accountability-text"
                                             data-current="Accountable for operational execution and coordination of IT services across southern facilities, ensuring reliable system performance, vendor management, and responsive support for staff and clinical operations."
                                             data-future="Accountable for the strategic alignment, governance, and financial return of enterprise technology investments, ensuring systems are scalable, secure, and cost-effective while enabling business and clinical operations across all facilities.">
                                            Accountable for operational execution and coordination of IT services across southern facilities.
                                        </div>
                                    </div>
                                </div>

                                <!-- Responsibilities -->
                                <div class="content-section">
                                    <div class="section-label">
                                        <div class="section-label-icon"></div>
                                        Key Responsibilities
                                    </div>
                                    <ul class="responsibilities-list">
                                        <!-- Populated dynamically from Responsibility Planner -->
                                    </ul>
                                </div>

                                <!-- Example Engagements -->
                                <div class="content-section">
                                    <div class="section-label">
                                        <div class="section-label-icon"></div>
                                        Example Engagements
                                    </div>
                                    <div class="engagements-grid">
                                        <div class="engagement-card">
                                            <div class="engagement-title">Clearview Project</div>
                                            <div class="engagement-description">
                                                Executive sponsor and architect of enterprise security camera unification initiative, standardizing physical security infrastructure across all facilities.
                                            </div>
                                            <span class="engagement-metric">
                                                <span class="engagement-metric-icon">✓</span> Enterprise Security Unification
                                            </span>
                                        </div>
                                        <div class="engagement-card">
                                            <div class="engagement-title">Enterprise MDM Strategy</div>
                                            <div class="engagement-description">
                                                Established the organization's first enterprise Mobile Device Management (MDM) strategy and deployment using Jamf / MaaS360, creating scalable device governance.
                                            </div>
                                            <span class="engagement-metric">
                                                <span class="engagement-metric-icon">✓</span> First Enterprise MDM
                                            </span>
                                        </div>
                                        <div class="engagement-card">
                                            <div class="engagement-title">eFax Modernization Initiative</div>
                                            <div class="engagement-description">
                                                Led modernization initiative transitioning legacy physical fax infrastructure to secure eFax systems across the organization.
                                            </div>
                                            <span class="engagement-metric">
                                                <span class="engagement-metric-icon">↓</span> Legacy Infrastructure Eliminated
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ==================== GEREMIA ==================== -->
                    <div id="profile-geremia" class="profile-card hidden" role="tabpanel" aria-labelledby="nav-geremia">
                        <div class="profile-grid">
                            <div class="profile-image-section">
                                <div class="profile-image-wrapper">
                                    <!-- REPLACE: <img src="path/to/geremia.jpg" alt="Geremia" class="profile-image"> -->
                                    <div class="profile-image-placeholder">GD</div>
                                </div>
                                <div class="profile-info-panel">
                                    <div class="profile-info-title">Areas of Expertise</div>
                                    <div class="expertise-sidebar">
                                        <span class="expertise-tag-sidebar">Network Architecture</span>
                                        <span class="expertise-tag-sidebar">Cybersecurity (Hardening & NDR)</span>
                                        <span class="expertise-tag-sidebar">Virtualization (Nutanix)</span>
                                        <span class="expertise-tag-sidebar">Infrastructure Design</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="profile-content">
                                <div class="profile-header">
                                    <h1 class="profile-name">Geremia Doan</h1>
                                    <h2 class="profile-title"
                                        data-current="Director, IT Infrastructure & Security" 
                                        data-future="Director, IT Infrastructure & Security">Director, IT Infrastructure & Security</h2>
                                    <p class="profile-summary"
                                       data-current="Geremia manages the organization's network, server, and security infrastructure. He handles day-to-day maintenance, troubleshooting, patching, and ensures systems stay operational across all facilities."
                                       data-future="Geremia is the primary architect of the organization's technical backbone. His role centers on infrastructure resilience, security execution, and platform scalability, ensuring systems are hardened, performant, and capable of supporting modern clinical and business operations.">
                                        Geremia manages the organization's network, server, and security infrastructure.
                                    </p>
                                </div>

                                <div class="content-section">
                                    <div class="accountability-box">
                                        <div class="accountability-label">Primary Accountability</div>
                                        <div class="accountability-text"
                                             data-current="Accountable for maintaining operational availability of network, server, and security systems, responding to outages and performance issues across all facilities."
                                             data-future="Accountable for the integrity, security, and performance of the organization's network, server, and infrastructure environments, ensuring high availability and resilience across all facilities.">
                                            Accountable for maintaining operational availability of network, server, and security systems.
                                        </div>
                                    </div>
                                </div>

                                <div class="content-section">
                                    <div class="section-label">
                                        <div class="section-label-icon"></div>
                                        Key Responsibilities
                                    </div>
                                    <ul class="responsibilities-list">
                                        <!-- Populated dynamically from Responsibility Planner -->
                                    </ul>
                                </div>

                                <div class="content-section">
                                    <div class="section-label">
                                        <div class="section-label-icon"></div>
                                        Example Engagements
                                    </div>
                                    <div class="engagements-grid">
                                        <div class="engagement-card">
                                            <div class="engagement-title">Dual Velo (SD-WAN) Implementation</div>
                                            <div class="engagement-description">
                                                Implemented SD-WAN infrastructure across all facilities, creating resilient, high-performance network connectivity.
                                            </div>
                                            <span class="engagement-metric">
                                                <span class="engagement-metric-icon">✓</span> Enterprise-Wide SD-WAN
                                            </span>
                                        </div>
                                        <div class="engagement-card">
                                            <div class="engagement-title">VMWare to Nutanix Migration</div>
                                            <div class="engagement-description">
                                                Managed migration from VMWare virtualization platform to Nutanix, modernizing data center infrastructure.
                                            </div>
                                            <span class="engagement-metric">
                                                <span class="engagement-metric-icon">✓</span> Platform Modernization
                                            </span>
                                        </div>
                                        <div class="engagement-card">
                                            <div class="engagement-title">Enterprise Bandwidth Upgrades</div>
                                            <div class="engagement-description">
                                                Led enterprise-wide bandwidth upgrade initiative, improving network capacity and performance across all locations.
                                            </div>
                                            <span class="engagement-metric">
                                                <span class="engagement-metric-icon">↑</span> Enhanced Connectivity
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ==================== FRANCIS ==================== -->
                    <div id="profile-francis" class="profile-card hidden" role="tabpanel" aria-labelledby="nav-francis">
                        <div class="profile-grid">
                            <div class="profile-image-section">
                                <div class="profile-image-wrapper">
                                    <!-- REPLACE: <img src="path/to/francis.jpg" alt="Francis" class="profile-image"> -->
                                    <div class="profile-image-placeholder">FF</div>
                                </div>
                                <div class="profile-info-panel">
                                    <div class="profile-info-title">Areas of Expertise</div>
                                    <div class="expertise-sidebar">
                                        <span class="expertise-tag-sidebar">ITIL Service Management</span>
                                        <span class="expertise-tag-sidebar">Incident Resolution</span>
                                        <span class="expertise-tag-sidebar">User Experience (UX)</span>
                                        <span class="expertise-tag-sidebar">Service Operations</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="profile-content">
                                <div class="profile-header">
                                    <h1 class="profile-name">Francis Ferma</h1>
                                    <h2 class="profile-title"
                                        data-current="IT Service Delivery Manager"
                                        data-future="Director, Service Delivery & User Enablement">IT Service Delivery Manager</h2>
                                    <p class="profile-summary"
                                       data-current="Francis manages the IT service desk, handling ticket routing, end-user support requests, and day-to-day troubleshooting. He ensures timely responses and resolution for staff technology issues."
                                       data-future="Francis owns the quality, consistency, and perception of IT services. His role focuses on scaling support operations while preserving empathy, responsiveness, and a strong end-user experience through AI-enabled tools and proactive enablement.">
                                        Francis manages the IT service desk and end-user support operations.
                                    </p>
                                </div>

                                <div class="content-section">
                                    <div class="accountability-box">
                                        <div class="accountability-label">Primary Accountability</div>
                                        <div class="accountability-text"
                                             data-current="Accountable for timely response and resolution of IT support requests, ensuring end-users receive responsive service and technical issues are addressed efficiently."
                                             data-future="Accountable for the quality, consistency, and scalability of IT support services, measured through service performance metrics, resolution efficiency, and end-user adoption outcomes.">
                                            Accountable for timely response and resolution of IT support requests.
                                        </div>
                                    </div>
                                </div>

                                <div class="content-section">
                                    <div class="section-label">
                                        <div class="section-label-icon"></div>
                                        Key Responsibilities
                                    </div>
                                    <ul class="responsibilities-list">
                                        <!-- Populated dynamically from Responsibility Planner -->
                                    </ul>
                                </div>

                                <div class="content-section">
                                    <div class="section-label">
                                        <div class="section-label-icon"></div>
                                        Example Engagements
                                    </div>
                                    <div class="engagements-grid">
                                        <div class="engagement-card">
                                            <div class="engagement-title">Service Excellence Recognition</div>
                                            <div class="engagement-description">
                                                Received peer-voted company awards for service excellence, reflecting consistently high-quality support and user satisfaction.
                                            </div>
                                            <span class="engagement-metric">
                                                <span class="engagement-metric-icon">✓</span> Peer-Voted Awards
                                            </span>
                                        </div>
                                        <div class="engagement-card">
                                            <div class="engagement-title">Large-Scale System Transitions</div>
                                            <div class="engagement-description">
                                                Managed transitions of large support systems while maintaining high resolution rates and minimal user disruption.
                                            </div>
                                            <span class="engagement-metric">
                                                <span class="engagement-metric-icon">✓</span> Seamless Transitions
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ==================== TOM ==================== -->
                    <div id="profile-tom" class="profile-card hidden" role="tabpanel" aria-labelledby="nav-tom">
                        <div class="profile-grid">
                            <div class="profile-image-section">
                                <div class="profile-image-wrapper">
                                    <!-- REPLACE: <img src="path/to/tom.jpg" alt="Tom" class="profile-image"> -->
                                    <div class="profile-image-placeholder">TJ</div>
                                </div>
                                <div class="profile-info-panel">
                                    <div class="profile-info-title">Areas of Expertise</div>
                                    <div class="expertise-sidebar">
                                        <span class="expertise-tag-sidebar">Systems Administration</span>
                                        <span class="expertise-tag-sidebar">Patch Management</span>
                                        <span class="expertise-tag-sidebar">Hardware Lifecycle Management</span>
                                        <span class="expertise-tag-sidebar">Site Infrastructure Optimization</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="profile-content">
                                <div class="profile-header">
                                    <h1 class="profile-name">Tom Jarrell</h1>
                                    <h2 class="profile-title"
                                        data-current="Systems Administrator"
                                        data-future="Senior Systems Administrator">Systems Administrator</h2>
                                    <p class="profile-summary"
                                       data-current="Tom handles hands-on hardware management, device deployment, and facility-level IT maintenance. He deploys equipment, manages device lifecycle, and responds to hardware failures across facilities."
                                       data-future="Tom ensures the operational health and standardization of facility-level systems, bridging physical infrastructure and centralized platforms to deliver reliable, consistent performance through strategic hardware lifecycle management.">
                                        Tom handles hands-on hardware management and device deployment.
                                    </p>
                                </div>

                                <div class="content-section">
                                    <div class="accountability-box">
                                        <div class="accountability-label">Primary Accountability</div>
                                        <div class="accountability-text"
                                             data-current="Accountable for hardware deployment, device management, and physical IT infrastructure maintenance across facilities."
                                             data-future="Accountable for the operational stability and physical integrity of facility-level IT systems, ensuring consistent connectivity and hardware reliability through proactive lifecycle management.">
                                            Accountable for hardware deployment and device management.
                                        </div>
                                    </div>
                                </div>

                                <div class="content-section">
                                    <div class="section-label">
                                        <div class="section-label-icon"></div>
                                        Key Responsibilities
                                    </div>
                                    <ul class="responsibilities-list">
                                        <!-- Populated dynamically from Responsibility Planner -->
                                    </ul>
                                </div>

                                <div class="content-section">
                                    <div class="section-label">
                                        <div class="section-label-icon"></div>
                                        Example Engagements
                                    </div>
                                    <div class="engagements-grid">
                                        <div class="engagement-card">
                                            <div class="engagement-title">Wireless AP Refresh (Silverconnect)</div>
                                            <div class="engagement-description">
                                                Led wireless access point refresh initiative, modernizing network infrastructure across all facilities.
                                            </div>
                                            <span class="engagement-metric">
                                                <span class="engagement-metric-icon">✓</span> Infrastructure Modernization
                                            </span>
                                        </div>
                                        <div class="engagement-card">
                                            <div class="engagement-title">E-Waste & Asset Recovery Program</div>
                                            <div class="engagement-description">
                                                Managed E-Waste and Asset Recovery initiatives, implementing sustainable IT asset disposal practices.
                                            </div>
                                            <span class="engagement-metric">
                                                <span class="engagement-metric-icon">✓</span> Sustainability Leadership
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ==================== ROGI ==================== -->
                    <div id="profile-rogi" class="profile-card hidden" role="tabpanel" aria-labelledby="nav-rogi">
                        <div class="profile-grid">
                            <div class="profile-image-section">
                                <div class="profile-image-wrapper">
                                    <!-- REPLACE: <img src="path/to/rogi.jpg" alt="Rogi" class="profile-image"> -->
                                    <div class="profile-image-placeholder">RP</div>
                                </div>
                                <div class="profile-info-panel">
                                    <div class="profile-info-title">Areas of Expertise</div>
                                    <div class="expertise-sidebar">
                                        <span class="expertise-tag-sidebar">EHR Systems</span>
                                        <span class="expertise-tag-sidebar">Clinical Workflow Optimization</span>
                                        <span class="expertise-tag-sidebar">Technical Documentation</span>
                                        <span class="expertise-tag-sidebar">Clinical SaaS Management</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="profile-content">
                                <div class="profile-header">
                                    <h1 class="profile-name">Rogi Poblete</h1>
                                    <h2 class="profile-title"
                                        data-current="Clinical Systems Specialist"
                                        data-future="Director, Clinical Systems & Integration">Clinical Systems Specialist</h2>
                                    <p class="profile-summary"
                                       data-current="Rogi provides technical support for clinical software platforms like PointClickCare. He assists clinical staff with system issues, trains users, and troubleshoots clinical application problems."
                                       data-future="Rogi serves as the bridge between technology and patient care. He ensures clinical systems are optimized, usable, and aligned with real-world workflows while leading strategic clinical system initiatives.">
                                        Rogi provides technical support for clinical software platforms.
                                    </p>
                                </div>

                                <div class="content-section">
                                    <div class="accountability-box">
                                        <div class="accountability-label">Primary Accountability</div>
                                        <div class="accountability-text"
                                             data-current="Accountable for providing responsive technical support for clinical systems, ensuring clinical staff can effectively use technology platforms for patient care."
                                             data-future="Accountable for the optimization, usability, and adoption of clinical software systems, ensuring technology enables—not obstructs—clinical excellence.">
                                            Accountable for providing technical support for clinical systems.
                                        </div>
                                    </div>
                                </div>

                                <div class="content-section">
                                    <div class="section-label">
                                        <div class="section-label-icon"></div>
                                        Key Responsibilities
                                    </div>
                                    <ul class="responsibilities-list">
                                        <!-- Populated dynamically from Responsibility Planner -->
                                    </ul>
                                </div>

                                <div class="content-section">
                                    <div class="section-label">
                                        <div class="section-label-icon"></div>
                                        Example Engagements
                                    </div>
                                    <div class="engagements-grid">
                                        <div class="engagement-card">
                                            <div class="engagement-title">PCC-to-Billing Integrations</div>
                                            <div class="engagement-description">
                                                Led PointClickCare-to-billing system integrations, streamlining financial workflows and reducing manual data entry.
                                            </div>
                                            <span class="engagement-metric">
                                                <span class="engagement-metric-icon">✓</span> Integration Success
                                            </span>
                                        </div>
                                        <div class="engagement-card">
                                            <div class="engagement-title">Clinical User Documentation</div>
                                            <div class="engagement-description">
                                                Authored comprehensive clinical user guides, improving system adoption and reducing support requests.
                                            </div>
                                            <span class="engagement-metric">
                                                <span class="engagement-metric-icon">✓</span> Knowledge Base Leadership
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ==================== JON ==================== -->
                    <div id="profile-jon" class="profile-card hidden" role="tabpanel" aria-labelledby="nav-jon">
                        <div class="profile-grid">
                            <div class="profile-image-section">
                                <div class="profile-image-wrapper">
                                    <!-- REPLACE: <img src="path/to/jon.jpg" alt="Jon" class="profile-image"> -->
                                    <div class="profile-image-placeholder">J</div>
                                </div>
                                <div class="profile-info-panel">
                                    <div class="profile-info-title">Areas of Expertise</div>
                                    <div class="expertise-sidebar">
                                        <span class="expertise-tag-sidebar">SQL Server</span>
                                        <span class="expertise-tag-sidebar">Database Optimization</span>
                                        <span class="expertise-tag-sidebar">Backup & Recovery</span>
                                        <span class="expertise-tag-sidebar">Performance Tuning</span>
                                        <span class="expertise-tag-sidebar">Database Security</span>
                                        <span class="expertise-tag-sidebar">Maintenance Automation</span>
                                        <span class="expertise-tag-sidebar">Capacity Planning</span>
                                        <span class="expertise-tag-sidebar">High Availability</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="profile-content">
                                <div class="profile-header">
                                    <h1 class="profile-name">Jon</h1>
                                    <h2 class="profile-title"
                                        data-current="Database Administrator"
                                        data-future="Senior Database Administrator">Database Administrator</h2>
                                    <p class="profile-summary"
                                       data-current="Focused specialist responsible for database maintenance, performance tuning, backup integrity, and routine database operations. Ensures data availability and optimal database performance."
                                       data-future="Strategic database architect responsible for enterprise data infrastructure, performance optimization, disaster recovery planning, and database platform evolution. Ensures data availability, security, and scalability across all systems.">
                                        Focused specialist responsible for database maintenance and operations.
                                    </p>
                                </div>

                                <div class="content-section">
                                    <div class="accountability-box">
                                        <div class="accountability-label">Primary Accountability</div>
                                        <div class="accountability-text"
                                             data-current="Responsible for database availability, backup integrity, and performance optimization. Ensures databases remain operational and data can be recovered in the event of system failure."
                                             data-future="Accountable for enterprise database architecture, availability, and disaster recovery strategy. Ensures databases support organizational growth, remain highly available, and data integrity is maintained across all systems.">
                                            Responsible for database availability and backup integrity.
                                        </div>
                                    </div>
                                </div>

                                <div class="content-section">
                                    <div class="section-label">
                                        <div class="section-label-icon"></div>
                                        Key Responsibilities
                                    </div>
                                    <ul class="responsibilities-list">
                                        <!-- Populated dynamically from Responsibility Planner -->
                                    </ul>
                                </div>

                                <div class="content-section">
                                    <div class="section-label">
                                        <div class="section-label-icon"></div>
                                        Example Engagements
                                    </div>
                                    <div class="engagements-grid">
                                        <div class="engagement-card">
                                            <div class="engagement-title">Database Performance Optimization</div>
                                            <div class="engagement-description">
                                                Identified and resolved query bottlenecks in financial reporting database, reducing monthly close process from 6 hours to 45 minutes through index optimization.
                                            </div>
                                            <span class="engagement-metric">
                                                <span class="engagement-metric-icon">↓</span> 88% Faster Processing
                                            </span>
                                        </div>
                                        <div class="engagement-card">
                                            <div class="engagement-title">Backup Infrastructure Modernization</div>
                                            <div class="engagement-description">
                                                Implemented automated backup verification and recovery testing protocols, achieving 100% backup success rate and reducing recovery time objectives by 75%.
                                            </div>
                                            <span class="engagement-metric">
                                                <span class="engagement-metric-icon">✓</span> 100% Backup Success
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ==================== HEAT MAP ==================== -->
                    <div id="profile-heatmap" class="profile-card hidden" role="tabpanel" aria-labelledby="nav-heatmap">
                        <div class="heatmap-container">
                            <div class="heatmap-header">
                                <h1 class="heatmap-title">IT Leadership Accountability Heat Map</h1>
                                <p class="heatmap-subtitle">
                                    This RACI matrix clarifies ownership and collaboration across all IT domains, ensuring clear lines of accountability and reducing ambiguity in decision-making and execution.
                                </p>
                                <div class="heatmap-legend">
                                    <div class="legend-item">
                                        <div class="legend-badge accountable">A</div>
                                        <span>Accountable</span>
                                    </div>
                                    <div class="legend-item">
                                        <div class="legend-badge responsible">R</div>
                                        <span>Responsible</span>
                                    </div>
                                    <div class="legend-item">
                                        <div class="legend-badge consulted">C</div>
                                        <span>Consulted</span>
                                    </div>
                                    <div class="legend-item">
                                        <div class="legend-badge informed">I</div>
                                        <span>Informed</span>
                                    </div>
                                </div>
                                <div style="margin-top: var(--space-4); display: flex; align-items: center; gap: var(--space-4); flex-wrap: wrap;">
                                    <button class="kanban-btn" id="toggle-heatmap-edit">
                                        🖊️ Enable Edit Mode
                                    </button>
                                    <span class="heatmap-help">Click badges to cycle: A → R → C → I → (empty). Click empty cell to add new badge.</span>
                                </div>
                            </div>

                            <div class="content-section">
                                <div class="section-label">
                                    <div class="section-label-icon"></div>
                                    1. Strategy, Governance & Financial Alignment
                                </div>
                                <div class="heatmap-table-wrapper">
                                    <table class="heatmap-table">
                                        <thead>
                                            <tr>
                                                <th style="min-width: 280px;">Domain / Activity</th>
                                                <th style="min-width: 100px;">Marc</th>
                                                <th style="min-width: 100px;">Anthony</th>
                                                <th style="min-width: 100px;">Geremia</th>
                                                <th style="min-width: 100px;">Francis</th>
                                                <th style="min-width: 100px;">Tom</th>
                                                <th style="min-width: 100px;">Rogi</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>IT Strategy & Roadmap</td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge i">I</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge a">A</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge c">C</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge i">I</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge i">I</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge c">C</span></div></td>
                                            </tr>
                                            <tr>
                                                <td>"30 by 30" Alignment</td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge c">C</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge a">A</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge c">C</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge i">I</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge i">I</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge c">C</span></div></td>
                                            </tr>
                                            <tr>
                                                <td>Budget Planning & Forecasting</td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge c">C</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge a">A</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge c">C</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge i">I</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge i">I</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge i">I</span></div></td>
                                            </tr>
                                            <tr>
                                                <td>Vendor Strategy & Contracts</td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge i">I</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge a">A</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge c">C</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge i">I</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge i">I</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge i">I</span></div></td>
                                            </tr>
                                            <tr>
                                                <td>Software Asset Management (SAM)</td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge i">I</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge a">A</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge c">C</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge i">I</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge c">C</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge c">C</span></div></td>
                                            </tr>
                                            <tr>
                                                <td>Policy & Standards</td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge i">I</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge a">A</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge r">R</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge c">C</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge c">C</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge c">C</span></div></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <div class="section-divider"></div>

                            <div class="content-section">
                                <div class="section-label">
                                    <div class="section-label-icon"></div>
                                    2. Infrastructure, Security & Platforms
                                </div>
                                <div class="heatmap-table-wrapper">
                                    <table class="heatmap-table">
                                        <thead>
                                            <tr>
                                                <th style="min-width: 280px;">Domain / Activity</th>
                                                <th style="min-width: 100px;">Marc</th>
                                                <th style="min-width: 100px;">Anthony</th>
                                                <th style="min-width: 100px;">Geremia</th>
                                                <th style="min-width: 100px;">Francis</th>
                                                <th style="min-width: 100px;">Tom</th>
                                                <th style="min-width: 100px;">Rogi</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Network Architecture (SD-WAN)</td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge i">I</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge i">I</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge a">A</span><span class="heatmap-badge r">R</span></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge c">C</span></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                            </tr>
                                            <tr>
                                                <td>Server & Virtualization</td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge i">I</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge i">I</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge a">A</span><span class="heatmap-badge r">R</span></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge c">C</span></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                            </tr>
                                            <tr>
                                                <td>Data Center / Cloud Strategy</td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge i">I</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge a">A</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge r">R</span></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                            </tr>
                                            <tr>
                                                <td>Cybersecurity Architecture</td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge i">I</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge a">A</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge r">R</span></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                            </tr>
                                            <tr>
                                                <td>Security Operations (NDR / Hardening)</td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge i">I</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge i">I</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge a">A</span><span class="heatmap-badge r">R</span></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge c">C</span></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                            </tr>
                                            <tr>
                                                <td>Disaster Recovery & BCP</td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge c">C</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge a">A</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge r">R</span></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <div class="section-divider"></div>

                            <div class="content-section">
                                <div class="section-label">
                                    <div class="section-label-icon"></div>
                                    3. Service Delivery & End-User Experience
                                </div>
                                <div class="heatmap-table-wrapper">
                                    <table class="heatmap-table">
                                        <thead>
                                            <tr>
                                                <th style="min-width: 280px;">Domain / Activity</th>
                                                <th style="min-width: 100px;">Marc</th>
                                                <th style="min-width: 100px;">Anthony</th>
                                                <th style="min-width: 100px;">Geremia</th>
                                                <th style="min-width: 100px;">Francis</th>
                                                <th style="min-width: 100px;">Tom</th>
                                                <th style="min-width: 100px;">Rogi</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Service Desk Operations</td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge i">I</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge i">I</span></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge a">A</span><span class="heatmap-badge r">R</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge c">C</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge c">C</span></div></td>
                                            </tr>
                                            <tr>
                                                <td>ITIL / Process Design</td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge i">I</span></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge a">A</span><span class="heatmap-badge r">R</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge c">C</span></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                            </tr>
                                            <tr>
                                                <td>AI Tier-0 Helpdesk</td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge i">I</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge c">C</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge c">C</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge a">A</span><span class="heatmap-badge r">R</span></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                            </tr>
                                            <tr>
                                                <td>End-User Satisfaction & Metrics</td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge i">I</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge i">I</span></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge a">A</span><span class="heatmap-badge r">R</span></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                            </tr>
                                            <tr>
                                                <td>Change Adoption & Training</td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge i">I</span></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge a">A</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge c">C</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge r">R</span></div></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <div class="section-divider"></div>

                            <div class="content-section">
                                <div class="section-label">
                                    <div class="section-label-icon"></div>
                                    4. Systems, Hardware & Facilities
                                </div>
                                <div class="heatmap-table-wrapper">
                                    <table class="heatmap-table">
                                        <thead>
                                            <tr>
                                                <th style="min-width: 280px;">Domain / Activity</th>
                                                <th style="min-width: 100px;">Marc</th>
                                                <th style="min-width: 100px;">Anthony</th>
                                                <th style="min-width: 100px;">Geremia</th>
                                                <th style="min-width: 100px;">Francis</th>
                                                <th style="min-width: 100px;">Tom</th>
                                                <th style="min-width: 100px;">Rogi</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Hardware Standards</td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge a">A</span></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge r">R</span></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                            </tr>
                                            <tr>
                                                <td>Network Closets & APs</td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge c">C</span></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge a">A</span><span class="heatmap-badge r">R</span></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                            </tr>
                                            <tr>
                                                <td>Patch & Update Cycles</td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge c">C</span></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge a">A</span><span class="heatmap-badge r">R</span></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                            </tr>
                                            <tr>
                                                <td>After-Hours Maintenance</td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge i">I</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge i">I</span></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge a">A</span><span class="heatmap-badge r">R</span></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                            </tr>
                                            <tr>
                                                <td>E-Waste & Asset Recovery</td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge i">I</span></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge a">A</span><span class="heatmap-badge r">R</span></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <div class="section-divider"></div>

                            <div class="content-section">
                                <div class="section-label">
                                    <div class="section-label-icon"></div>
                                    5. Clinical Systems & Workflow Enablement
                                </div>
                                <div class="heatmap-table-wrapper">
                                    <table class="heatmap-table">
                                        <thead>
                                            <tr>
                                                <th style="min-width: 280px;">Domain / Activity</th>
                                                <th style="min-width: 100px;">Marc</th>
                                                <th style="min-width: 100px;">Anthony</th>
                                                <th style="min-width: 100px;">Geremia</th>
                                                <th style="min-width: 100px;">Francis</th>
                                                <th style="min-width: 100px;">Tom</th>
                                                <th style="min-width: 100px;">Rogi</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>EHR Ownership (PCC)</td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge i">I</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge i">I</span></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge a">A</span><span class="heatmap-badge r">R</span></div></td>
                                            </tr>
                                            <tr>
                                                <td>Clinical SaaS Integrations</td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge c">C</span></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge c">C</span></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge a">A</span><span class="heatmap-badge r">R</span></div></td>
                                            </tr>
                                            <tr>
                                                <td>Clinical Workflow Optimization</td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge c">C</span></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge a">A</span><span class="heatmap-badge r">R</span></div></td>
                                            </tr>
                                            <tr>
                                                <td>Clinical Training & Documentation</td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge c">C</span></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge a">A</span><span class="heatmap-badge r">R</span></div></td>
                                            </tr>
                                            <tr>
                                                <td>PCC → Billing Integrations</td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge c">C</span></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"></div></td>
                                                <td><div class="heatmap-cell"><span class="heatmap-badge a">A</span><span class="heatmap-badge r">R</span></div></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ==================== KANBAN BOARD ==================== -->
                    <div id="profile-kanban" class="profile-card hidden" role="tabpanel" aria-labelledby="nav-kanban">
                        <div class="kanban-container">
                            <div class="kanban-header">
                                <h1 class="kanban-title">Responsibility Assignment Planner</h1>
                                <p class="kanban-subtitle">
                                    Drag responsibilities from the backlog to assign them to team members. Toggle between "Current State" and "Future State" to plan organizational changes. Changes update the bio pages in real-time.
                                </p>
                                <div class="kanban-controls">
                                    <div style="display: flex; align-items: center; gap: var(--space-4);">
                                        <div class="state-toggle">
                                            <button class="state-toggle-btn active" data-state="current">
                                                📋 Current State
                                            </button>
                                            <button class="state-toggle-btn" data-state="future">
                                                🎯 Future State
                                            </button>
                                        </div>
                                        <button class="kanban-btn" id="apply-changes">
                                            Apply to Bios
                                        </button>
                                    </div>
                                    <div class="kanban-actions">
                                        <button class="kanban-btn" id="google-auth-btn" onclick="signInWithGoogle()">🔐 Sign in with Google</button>
                                        <button class="kanban-btn" id="reload-from-sheet" onclick="reloadFromSheet()">↻ Reload from Sheet</button>
                                        <button class="kanban-btn" id="clear-all-assignments">🧹 Clear All Assignments</button>
                                        <button class="kanban-btn" id="save-as-default">💾 Save as Default</button>
                                        <button class="kanban-btn" id="reset-kanban">Reset to Default</button>
                                    </div>
                                </div>
                                <div class="comparison-indicator">
                                    <div class="comparison-dot"></div>
                                    <span>Viewing: <strong>Current State</strong></span>
                                    <div id="unsaved-changes-banner" style="display: none; margin-left: var(--space-6); padding: var(--space-2) var(--space-4); background: #FFF3CD; color: #856404; border: 1px solid #FFE69C; border-radius: var(--radius-md); font-size: 13px; font-weight: 600; animation: pulse 2s infinite;">
                                        ⚠️ Unsaved changes - Click "Apply to Bios" to update bio pages
                                    </div>
                                    <div id="save-notification" style="display: none; margin-left: var(--space-4); padding: var(--space-2) var(--space-4); background: var(--accent-green); color: white; border-radius: var(--radius-md); font-size: 13px; font-weight: 600;">
                                        Saved ✓
                                    </div>
                                </div>
                            </div>

                            <div class="kanban-board" id="kanban-board">
                                <!-- Backlog Column -->
                                <div class="kanban-column backlog" data-column="backlog">
                                    <div class="kanban-column-header">
                                        <div class="kanban-column-title">Unassigned</div>
                                        <div class="kanban-column-count"><span class="count">0</span> responsibilities</div>
                                    </div>
                                    <div class="kanban-cards" data-droppable="true">
                                        <!-- Cards will be dynamically added here -->
                                    </div>
                                    <div class="add-responsibility">
                                        <textarea 
                                            class="add-responsibility-input" 
                                            id="new-responsibility-input"
                                            placeholder="Enter a new responsibility to add to the backlog..."
                                            rows="3"></textarea>
                                        <button class="add-responsibility-btn" id="add-responsibility-btn">
                                            + Add Responsibility
                                        </button>
                                    </div>
                                </div>

                                <!-- Anthony Column -->
                                <div class="kanban-column" data-column="anthony">
                                    <div class="kanban-column-header">
                                        <div class="kanban-column-title">Anthony Trujillo</div>
                                        <div class="kanban-column-count"><span class="count">0</span> responsibilities</div>
                                    </div>
                                    <div class="kanban-cards" data-droppable="true"></div>
                                </div>

                                <!-- Geremia Column -->
                                <div class="kanban-column" data-column="geremia">
                                    <div class="kanban-column-header">
                                        <div class="kanban-column-title">Geremia Doan</div>
                                        <div class="kanban-column-count"><span class="count">0</span> responsibilities</div>
                                    </div>
                                    <div class="kanban-cards" data-droppable="true"></div>
                                </div>

                                <!-- Francis Column -->
                                <div class="kanban-column" data-column="francis">
                                    <div class="kanban-column-header">
                                        <div class="kanban-column-title">Francis Ferma</div>
                                        <div class="kanban-column-count"><span class="count">0</span> responsibilities</div>
                                    </div>
                                    <div class="kanban-cards" data-droppable="true"></div>
                                </div>

                                <!-- Tom Column -->
                                <div class="kanban-column" data-column="tom">
                                    <div class="kanban-column-header">
                                        <div class="kanban-column-title">Tom Jarrell</div>
                                        <div class="kanban-column-count"><span class="count">0</span> responsibilities</div>
                                    </div>
                                    <div class="kanban-cards" data-droppable="true"></div>
                                </div>

                                <!-- Rogi Column -->
                                <div class="kanban-column" data-column="rogi">
                                    <div class="kanban-column-header">
                                        <div class="kanban-column-title">Rogi Poblete</div>
                                        <div class="kanban-column-count"><span class="count">0</span> responsibilities</div>
                                    </div>
                                    <div class="kanban-cards" data-droppable="true"></div>
                                </div>

                                <!-- Jon Column -->
                                <div class="kanban-column" data-column="jon">
                                    <div class="kanban-column-header">
                                        <div class="kanban-column-title">Jon</div>
                                        <div class="kanban-column-count"><span class="count">0</span> responsibilities</div>
                                    </div>
                                    <div class="kanban-cards" data-droppable="true"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ==================== BUDGET ==================== -->
                    <!-- ==================== BUDGET PLANNER ==================== -->
                    <div id="profile-budget-planner" class="profile-card hidden" role="tabpanel" aria-labelledby="nav-budget-planner">
                        <div class="budget-container">
                            <div class="budget-header">
                                <h1 class="budget-title">Interactive Budget Planner</h1>
                                <p class="budget-subtitle">
                                    Data-driven budget planning tool with market benchmarking for SNF/Post-Acute IT operations in Orange County, CA. Adjust allocations using market-based sliders to understand risk and optimize spend.
                                </p>
                            </div>

                            <!-- Controls -->
                            <div class="planner-controls">
                                <div class="planner-mode-toggle">
                                    <button class="planner-view-toggle" id="toggle-granular-view">
                                        📊 Show Detailed Breakdown
                                    </button>
                                    <button class="kanban-btn primary" id="load-current-budget">
                                        📋 Load Current Budget
                                    </button>
                                    <button class="kanban-btn" id="compare-mode-toggle">
                                        👁️ Show Comparison
                                    </button>
                                </div>
                                <div class="planner-actions">
                                    <button class="kanban-btn" id="reset-to-optimal">↻ Reset to Optimal</button>
                                    <button class="kanban-btn primary" id="save-to-2026" style="display: none;">
                                        💾 Save to 2026 Budget
                                    </button>
                                </div>
                            </div>

                            <!-- Summary Cards -->
                            <div class="planner-summary-cards">
                                <div class="planner-summary-card proposed" id="proposed-total-card">
                                    <div class="budget-card-title">Proposed Total</div>
                                    <div class="budget-card-value" id="proposed-total">$2.4M</div>
                                    <div class="budget-card-change" id="proposed-status">Optimal Range</div>
                                </div>
                                <div class="planner-summary-card current" id="current-total-card" style="display: none;">
                                    <div class="budget-card-title">Current Budget</div>
                                    <div class="budget-card-value" id="current-total">$1.9M</div>
                                    <div class="budget-card-change">Reference</div>
                                </div>
                                <div class="planner-summary-card" id="variance-card">
                                    <div class="budget-card-title">Market Position</div>
                                    <div class="budget-card-value" id="market-position">50th Percentile</div>
                                    <div class="budget-card-change" id="market-position-detail">Mid-Market</div>
                                </div>
                                <div class="planner-summary-card" id="risk-card">
                                    <div class="budget-card-title">Risk Assessment</div>
                                    <div class="budget-card-value" id="risk-count">0 Critical</div>
                                    <div class="budget-card-change" id="risk-summary">All systems nominal</div>
                                </div>
                            </div>

                            <!-- Budget Line Items -->
                            <div id="budget-line-items">
                                <!-- Populated by JavaScript -->
                            </div>
                        </div>
                    </div>

                    <!-- ==================== BUDGET PLANNER TABLE VIEW ==================== -->
                    <div id="profile-budget-planner-table" class="profile-card hidden" role="tabpanel" aria-labelledby="nav-budget-planner-table">
                        <div class="budget-container">
                            <div class="budget-header">
                                <h1 class="budget-title">Budget Planner</h1>
                                <p class="budget-subtitle">
                                    Interactive planning tool with granular line items. Adjust individual costs, see risk/benefit tags in real-time, and understand the impact of every budget decision.
                                </p>
                                <div style="margin-top: var(--space-4); padding: var(--space-4); background: var(--gray-50); border-radius: var(--radius-md); border-left: 3px solid var(--accent-blue);">
                                    <div style="display: flex; align-items: center; justify-content: space-between; cursor: pointer;" onclick="toggleDataSources()">
                                        <div style="font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.08em; color: var(--gray-500);">
                                            📊 Data Sources & Benchmarking
                                        </div>
                                        <button id="data-sources-toggle" style="background: none; border: none; font-size: 18px; cursor: pointer; color: var(--gray-500);">▼</button>
                                    </div>
                                    <div id="data-sources-content" style="font-size: 13px; line-height: 1.6; color: var(--gray-700); margin-top: var(--space-3);">
                                        Market data sourced from: <strong>HIMSS Analytics IT Benchmarking</strong> (healthcare IT spending), 
                                        <strong>Gartner IT Key Metrics Data</strong> (industry benchmarks), 
                                        <strong>CHIME Healthcare CIO Surveys</strong> (post-acute/SNF specific), and 
                                        <strong>CompTIA Tech Salary Reports</strong> (Orange County, CA market rates). 
                                        Ranges reflect 25th-75th percentile spend for skilled nursing facilities with 8-12 facilities and 800-1,200 beds.
                                    </div>
                                </div>
                            </div>

                            <!-- Controls -->
                            <div class="planner-controls" style="margin-top: var(--space-6);">
                                <div class="planner-mode-toggle">
                                    <button class="kanban-btn primary" id="table-load-current">
                                        📋 Load Current Budget
                                    </button>
                                    <button class="kanban-btn" id="table-compare-toggle">
                                        👁️ Show Current Comparison
                                    </button>
                                    <button class="kanban-btn" id="table-configure-current">
                                        ⚙️ Configure Current Budget
                                    </button>
                                    <button class="kanban-btn" id="table-add-line-item">
                                        ➕ Add Line Item
                                    </button>
                                    <div style="width: 2px; height: 32px; background: var(--gray-300); margin: 0 var(--space-2);"></div>
                                    <button class="kanban-btn" id="table-reset-optimal">↻ Reset to Optimal</button>
                                </div>
                                <div class="planner-actions">
                                    <button class="kanban-btn primary" id="table-save-2026" style="display: none;">
                                        💾 Save to 2026 Budget
                                    </button>
                                </div>
                            </div>

                            <!-- Configure Current Budget Modal -->
                            <div id="configure-current-modal" class="config-modal">
                                <div class="config-modal-content">
                                    <div class="config-modal-header">
                                        <h2 class="config-modal-title">Configure Current Budget</h2>
                                        <p class="config-modal-subtitle">
                                            Enter your actual current spending for each line item. These values should reflect what you're paying today based on current contracts, salaries, and subscriptions. This will provide accurate comparison when analyzing proposed vs. current budget.
                                        </p>
                                    </div>
                                    <div id="current-budget-form">
                                        <!-- Populated by JavaScript -->
                                    </div>
                                    <div class="config-modal-actions">
                                        <button class="kanban-btn" onclick="closeConfigureModal()">Cancel</button>
                                        <button class="kanban-btn primary" onclick="saveCurrentBudget()">💾 Save Current Values</button>
                                    </div>
                                </div>
                            </div>

                            <!-- Add Line Item Modal -->
                            <div id="add-item-modal" class="config-modal">
                                <div class="config-modal-content">
                                    <div class="config-modal-header">
                                        <h2 class="config-modal-title">Add New Line Item</h2>
                                        <p class="config-modal-subtitle">
                                            Add a custom budget line item to any category. The system will automatically generate risk/benefit tags and market benchmarks based on your proposed amount.
                                        </p>
                                    </div>
                                    <form id="add-line-item-form" class="add-item-modal-form">
                                        <div class="form-group">
                                            <label class="form-label">Category *</label>
                                            <select id="new-item-category" class="form-select" required>
                                                <option value="">Select a category...</option>
                                                <option value="infrastructure">Infrastructure & Operations</option>
                                                <option value="personnel">Personnel & Team</option>
                                                <option value="software">Software & Licenses</option>
                                                <option value="security">Security & Compliance</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Line Item Name *</label>
                                            <input type="text" id="new-item-name" class="form-input" placeholder="e.g., Network UPS" required>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Current Annual Cost</label>
                                            <input type="number" id="new-item-current" class="form-input" placeholder="Enter current spending (optional)" min="0">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Proposed Annual Cost *</label>
                                            <input type="number" id="new-item-proposed" class="form-input" placeholder="Enter proposed amount" required min="0">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Description</label>
                                            <textarea id="new-item-description" class="form-textarea" placeholder="Brief description of what this covers..."></textarea>
                                        </div>
                                        <div class="config-modal-actions">
                                            <button type="button" class="kanban-btn" onclick="closeAddItemModal()">Cancel</button>
                                            <button type="button" class="kanban-btn primary" id="submit-new-line-item">✅ Add Line Item</button>
                                        </div>
                                    </form>
                                </div>
                            </div>

                            <!-- Summary Cards -->
                            <div class="planner-summary-cards" style="margin-top: var(--space-6); margin-bottom: var(--space-8);">
                                <div class="planner-summary-card proposed" id="table-total-card" title="Sum of all 17 line items below. Color indicates if you're in the optimal spending range (green), underfunded (red), or overfunded (yellow).">
                                    <div class="budget-card-title">Proposed Total 💡</div>
                                    <div class="budget-card-value" id="table-proposed-total">$2.6M</div>
                                    <div class="budget-card-change" id="table-proposed-status">Optimal Range</div>
                                </div>
                                <div class="planner-summary-card" id="table-current-card" style="display: none; opacity: 0.5; border-style: dashed;" title="Your actual current IT spending across all categories. Based on: current vendor contracts, employee salaries as of Jan 2026, active software subscriptions, and committed operational costs.">
                                    <div class="budget-card-title">Current Budget 💡</div>
                                    <div class="budget-card-value" id="table-current-total">$1.9M</div>
                                    <div class="budget-card-change">Actual Spend</div>
                                </div>
                                <div class="planner-summary-card" id="table-market-card" title="Where your proposed budget falls compared to similar organizations. Based on SNF facilities with 8-12 locations. 40-60th percentile is optimal (mid-market), below 40th is underfunded, above 80th is overspending.">
                                    <div class="budget-card-title">Market Position 💡</div>
                                    <div class="budget-card-value" id="table-market-position">50th Percentile</div>
                                    <div class="budget-card-change" id="table-market-detail">Mid-Market</div>
                                </div>
                                <div class="planner-summary-card" id="table-risk-summary-card" title="Number of line items that are critically underfunded (below safe operating levels). These areas pose operational risk, security vulnerabilities, or compliance issues.">
                                    <div class="budget-card-title">Risk Assessment 💡</div>
                                    <div class="budget-card-value" id="table-risk-count">0 Critical</div>
                                    <div class="budget-card-change" id="table-risk-summary">All systems nominal</div>
                                </div>
                            </div>

                            <!-- Current Budget Explanation (shows when comparison enabled) -->
                            <div id="current-budget-explanation" style="display: none; margin-bottom: var(--space-6); padding: var(--space-4); background: #fffbeb; border-left: 3px solid #f59e0b; border-radius: var(--radius-md);">
                                <div style="font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.08em; color: #78350f; margin-bottom: var(--space-2);">
                                    📊 About "Current Budget"
                                </div>
                                <div style="font-size: 13px; line-height: 1.6; color: #78350f;">
                                    <strong>Current Budget</strong> values represent your actual IT spending today based on:
                                    <ul style="margin-top: var(--space-2); margin-left: var(--space-5);">
                                        <li><strong>Vendor contracts:</strong> Current rates from Fortinet, Microsoft, PCC, cloud providers, etc.</li>
                                        <li><strong>Salaries:</strong> Team compensation as of January 2026 (Anthony, Geremia, Francis, Tom, Rogi, Jon)</li>
                                        <li><strong>Active subscriptions:</strong> Software licenses, SaaS platforms, support agreements in place</li>
                                        <li><strong>Hardware refresh:</strong> Current annual spend on workstation/equipment lifecycle</li>
                                    </ul>
                                    These numbers reflect committed costs - what you're actually paying right now. The gap between Current and Proposed shows underfunded areas that need investment.
                                </div>
                            </div>

                            <!-- Table -->
                            <div class="budget-table-wrapper">
                                <table class="budget-table-planner">
                                    <thead>
                                        <tr>
                                            <th>Category</th>
                                            <th>Description</th>
                                            <th>Annual Cost</th>
                                        </tr>
                                    </thead>
                                    <tbody id="table-budget-items">
                                        <!-- Populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- ==================== BUDGET (EXISTING) ==================== -->
                    <div id="profile-budget" class="profile-card hidden" role="tabpanel" aria-labelledby="nav-budget">
                        <div class="budget-container">
                            <div class="budget-header">
                                <h1 class="budget-title">IT Budget Overview</h1>
                                <p class="budget-subtitle">
                                    Comprehensive financial planning and allocation across infrastructure, personnel, software, and strategic initiatives supporting the "30 by 30" growth strategy.
                                </p>
                            </div>

                            <!-- Summary Cards -->
                            <div class="budget-grid">
                                <div class="budget-card">
                                    <div class="budget-card-header">
                                        <span class="budget-card-title">Total Annual Budget</span>
                                    </div>
                                    <div class="budget-card-value">$2.4M</div>
                                    <div class="budget-card-change neutral">FY 2025 Allocation</div>
                                </div>

                                <div class="budget-card">
                                    <div class="budget-card-header">
                                        <span class="budget-card-title">Infrastructure</span>
                                    </div>
                                    <div class="budget-card-value">$840K</div>
                                    <div class="budget-card-change neutral">35% of budget</div>
                                </div>

                                <div class="budget-card">
                                    <div class="budget-card-header">
                                        <span class="budget-card-title">Personnel</span>
                                    </div>
                                    <div class="budget-card-value">$960K</div>
                                    <div class="budget-card-change neutral">40% of budget</div>
                                </div>

                                <div class="budget-card">
                                    <div class="budget-card-header">
                                        <span class="budget-card-title">Software & Licenses</span>
                                    </div>
                                    <div class="budget-card-value">$480K</div>
                                    <div class="budget-card-change neutral">20% of budget</div>
                                </div>
                            </div>

                            <!-- Detailed Breakdown -->
                            <div class="content-section">
                                <div class="section-label">
                                    <div class="section-label-icon"></div>
                                    Detailed Budget Allocation
                                </div>
                            </div>

                            <div class="budget-table-wrapper">
                                <table class="budget-table">
                                    <thead>
                                        <tr>
                                            <th>Category</th>
                                            <th>Description</th>
                                            <th>Annual Cost</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Infrastructure -->
                                        <tr>
                                            <td colspan="3" class="budget-category">Infrastructure & Operations — $840,000</td>
                                        </tr>
                                        <tr>
                                            <td class="budget-subcategory">Network & SD-WAN</td>
                                            <td>Bandwidth, circuits, Dual Velo platform</td>
                                            <td>$180,000</td>
                                        </tr>
                                        <tr>
                                            <td class="budget-subcategory">Cloud Services</td>
                                            <td>Azure, AWS, data center hosting</td>
                                            <td>$240,000</td>
                                        </tr>
                                        <tr>
                                            <td class="budget-subcategory">Virtualization</td>
                                            <td>Nutanix licensing and support</td>
                                            <td>$120,000</td>
                                        </tr>
                                        <tr>
                                            <td class="budget-subcategory">Security Infrastructure</td>
                                            <td>Firewalls, NDR, EDR, email security</td>
                                            <td>$180,000</td>
                                        </tr>
                                        <tr>
                                            <td class="budget-subcategory">Hardware Refresh</td>
                                            <td>Servers, switches, APs, UPS</td>
                                            <td>$120,000</td>
                                        </tr>

                                        <!-- Personnel -->
                                        <tr>
                                            <td colspan="3" class="budget-category">Personnel — $960,000</td>
                                        </tr>
                                        <tr>
                                            <td class="budget-subcategory">Leadership (Anthony, Geremia)</td>
                                            <td>IT Directors / VP-level compensation</td>
                                            <td>$360,000</td>
                                        </tr>
                                        <tr>
                                            <td class="budget-subcategory">Technical Staff (Francis, Tom, Rogi)</td>
                                            <td>Managers, administrators, specialists</td>
                                            <td>$420,000</td>
                                        </tr>
                                        <tr>
                                            <td class="budget-subcategory">Database Admin (Jon)</td>
                                            <td>Database specialist</td>
                                            <td>$120,000</td>
                                        </tr>
                                        <tr>
                                            <td class="budget-subcategory">Training & Development</td>
                                            <td>Certifications, conferences, courses</td>
                                            <td>$60,000</td>
                                        </tr>

                                        <!-- Software & Licenses -->
                                        <tr>
                                            <td colspan="3" class="budget-category">Software & Licenses — $480,000</td>
                                        </tr>
                                        <tr>
                                            <td class="budget-subcategory">Clinical Systems (PCC)</td>
                                            <td>PointClickCare and clinical SaaS</td>
                                            <td>$180,000</td>
                                        </tr>
                                        <tr>
                                            <td class="budget-subcategory">Business Systems</td>
                                            <td>ERP, MDM (Jamf/MaaS360), eFax</td>
                                            <td>$120,000</td>
                                        </tr>
                                        <tr>
                                            <td class="budget-subcategory">Microsoft 365 & Azure AD</td>
                                            <td>Email, productivity, identity</td>
                                            <td>$96,000</td>
                                        </tr>
                                        <tr>
                                            <td class="budget-subcategory">Service Desk & ITSM</td>
                                            <td>Ticketing, monitoring, AI Tier-0</td>
                                            <td>$48,000</td>
                                        </tr>
                                        <tr>
                                            <td class="budget-subcategory">Backup & DR</td>
                                            <td>Backup software and cloud storage</td>
                                            <td>$36,000</td>
                                        </tr>

                                        <!-- Strategic Initiatives -->
                                        <tr>
                                            <td colspan="3" class="budget-category">Strategic Initiatives — $120,000</td>
                                        </tr>
                                        <tr>
                                            <td class="budget-subcategory">Clearview Project</td>
                                            <td>Security camera unification</td>
                                            <td>$48,000</td>
                                        </tr>
                                        <tr>
                                            <td class="budget-subcategory">Zero Trust Implementation</td>
                                            <td>MFA, network segmentation, monitoring</td>
                                            <td>$36,000</td>
                                        </tr>
                                        <tr>
                                            <td class="budget-subcategory">AI & Automation</td>
                                            <td>AI Tier-0 helpdesk, RPA pilots</td>
                                            <td>$24,000</td>
                                        </tr>
                                        <tr>
                                            <td class="budget-subcategory">Contingency Reserve</td>
                                            <td>Emergency projects, unplanned needs</td>
                                            <td>$12,000</td>
                                        </tr>

                                        <!-- Total -->
                                        <tr class="budget-total-row">
                                            <td colspan="2">TOTAL ANNUAL IT BUDGET</td>
                                            <td>$2,400,000</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- Notes Section -->
                            <div class="content-section" style="margin-top: var(--space-8);">
                                <div class="section-label">
                                    <div class="section-label-icon"></div>
                                    Budget Notes & Context
                                </div>
                                <div class="engagement-card">
                                    <div class="engagement-title">Alignment with "30 by 30" Strategy</div>
                                    <div class="engagement-description">
                                        This budget supports the organization's goal of operating 30 facilities by 2030. Infrastructure investments prioritize scalability, security investments address increased compliance complexity, and personnel allocations reflect the structured leadership model needed to support growth.
                                    </div>
                                </div>
                                <div class="engagement-card">
                                    <div class="engagement-title">Cost Optimization Opportunities</div>
                                    <div class="engagement-description">
                                        Through strategic vendor consolidation and cloud optimization initiatives, the IT department has identified potential savings of $180K annually while improving service delivery and system reliability.
                                    </div>
                                </div>
                                <div class="engagement-card">
                                    <div class="engagement-title">Personnel Investment Rationale</div>
                                    <div class="engagement-description">
                                        The personnel allocation (40% of budget) reflects industry benchmarks for healthcare IT organizations of this size. The structured leadership model with clear accountability reduces operational risk and supports compliance requirements.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ==================== FACILITY CALCULATOR ==================== -->
                    <div id="profile-facility-calculator" class="profile-card hidden" role="tabpanel" aria-labelledby="nav-facility-calculator">
                        <div class="budget-container">
                            <div class="budget-header">
                                <h1 class="budget-title">New Facility Onboarding Calculator</h1>
                                <p class="budget-subtitle">
                                    Interactive calculator for estimating IT costs when adding new facilities to support the "30 by 30" growth strategy. Includes infrastructure, licensing, labor, and one-time setup costs.
                                </p>
                            </div>

                            <!-- Calculator Inputs -->
                            <div class="budget-grid">
                                <div class="budget-card">
                                    <div class="budget-card-header">
                                        <span class="budget-card-title">Facility Size</span>
                                    </div>
                                    <div style="margin-top: var(--space-4);">
                                        <input type="number" id="bed-count" value="120" min="50" max="300" 
                                               style="width: 100%; padding: var(--space-3); border: 1px solid var(--gray-300); border-radius: var(--radius-md); font-size: 16px; font-weight: 600;">
                                        <div style="font-size: 13px; color: var(--gray-500); margin-top: var(--space-2);">Number of beds</div>
                                    </div>
                                </div>

                                <div class="budget-card">
                                    <div class="budget-card-header">
                                        <span class="budget-card-title">Staff Count</span>
                                    </div>
                                    <div style="margin-top: var(--space-4);">
                                        <input type="number" id="staff-count" value="85" min="30" max="200" 
                                               style="width: 100%; padding: var(--space-3); border: 1px solid var(--gray-300); border-radius: var(--radius-md); font-size: 16px; font-weight: 600;">
                                        <div style="font-size: 13px; color: var(--gray-500); margin-top: var(--space-2);">Total employees</div>
                                    </div>
                                </div>

                                <div class="budget-card">
                                    <div class="budget-card-header">
                                        <span class="budget-card-title">Estimated Total</span>
                                    </div>
                                    <div class="budget-card-value" id="total-estimate">$0</div>
                                    <div class="budget-card-change neutral">One-time + Annual</div>
                                </div>
                            </div>

                            <!-- Cost Breakdown Table -->
                            <div class="content-section">
                                <div class="section-label">
                                    <div class="section-label-icon"></div>
                                    Cost Breakdown
                                </div>
                            </div>

                            <div class="budget-table-wrapper">
                                <table class="budget-table">
                                    <thead>
                                        <tr>
                                            <th>Category</th>
                                            <th>Description</th>
                                            <th>One-Time Cost</th>
                                            <th>Annual Recurring</th>
                                        </tr>
                                    </thead>
                                    <tbody id="facility-cost-breakdown">
                                        <!-- Populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- ==================== PROJECT ROADMAP ==================== -->
                    <div id="profile-project-roadmap" class="profile-card hidden" role="tabpanel" aria-labelledby="nav-project-roadmap">
                        <div class="budget-container" style="position: relative;">
                            <!-- Blur Overlay -->
                            <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; backdrop-filter: blur(8px); background: rgba(255, 255, 255, 0.7); z-index: 100; display: flex; align-items: center; justify-content: center;">
                                <div style="text-align: center; padding: var(--space-12); max-width: 600px;">
                                    <div style="font-size: 64px; margin-bottom: var(--space-4);">🚧</div>
                                    <h2 style="font-size: 32px; font-weight: 700; color: var(--navy-900); margin-bottom: var(--space-4);">Architecture in Progress</h2>
                                    <p style="font-size: 16px; line-height: 1.7; color: var(--gray-600); margin-bottom: var(--space-6);">
                                        We're engineering an interactive project planning interface with drag-and-drop timeline management, project submission workflows, and resource allocation tracking. Coming soon.
                                    </p>
                                    <div style="display: inline-flex; align-items: center; gap: var(--space-2); padding: var(--space-3) var(--space-6); background: var(--navy-800); color: var(--white); border-radius: var(--radius-full); font-size: 13px; font-weight: 600;">
                                        <span>Expected: Q2 2026</span>
                                    </div>
                                </div>
                            </div>

                            <div class="budget-header">
                                <h1 class="budget-title">IT Project Roadmap 2026-2028</h1>
                                <p class="budget-subtitle">
                                    Strategic initiative timeline aligned with organizational growth objectives. Projects prioritized by business impact, dependencies, and resource availability.
                                </p>
                            </div>

                            <!-- 2026 Projects -->
                            <div class="content-section">
                                <div class="section-label">
                                    <div class="section-label-icon"></div>
                                    2026 — Foundation & Modernization
                                </div>
                                <div class="engagements-grid">
                                    <div class="engagement-card">
                                        <div class="engagement-title">Q1: Zero Trust Security Completion</div>
                                        <div class="engagement-description">
                                            Complete implementation of zero trust architecture across all facilities. Owner: Geremia Doan.
                                        </div>
                                        <span class="engagement-metric">
                                            <span class="engagement-metric-icon">📅</span> Jan-Mar 2026
                                        </span>
                                    </div>
                                    <div class="engagement-card">
                                        <div class="engagement-title">Q2: AI-Powered Service Desk Launch</div>
                                        <div class="engagement-description">
                                            Deploy AI chatbot for Tier-0 support, targeting 60% ticket deflection. Owner: Francis Ferma.
                                        </div>
                                        <span class="engagement-metric">
                                            <span class="engagement-metric-icon">📅</span> Apr-Jun 2026
                                        </span>
                                    </div>
                                    <div class="engagement-card">
                                        <div class="engagement-title">Q3: Cloud Cost Optimization</div>
                                        <div class="engagement-description">
                                            Implement FinOps practices and right-size infrastructure. Target: 25% cost reduction. Owner: Anthony Trujillo.
                                        </div>
                                        <span class="engagement-metric">
                                            <span class="engagement-metric-icon">📅</span> Jul-Sep 2026
                                        </span>
                                    </div>
                                    <div class="engagement-card">
                                        <div class="engagement-title">Q4: Identity Management Modernization</div>
                                        <div class="engagement-description">
                                            Migrate to Azure AD-native identity with 90% automation. Owner: Tom Jarrell.
                                        </div>
                                        <span class="engagement-metric">
                                            <span class="engagement-metric-icon">📅</span> Oct-Dec 2026
                                        </span>
                                    </div>
                                </div>
                            </div>

                            <!-- 2027 Projects -->
                            <div class="content-section" style="margin-top: var(--space-8);">
                                <div class="section-label">
                                    <div class="section-label-icon"></div>
                                    2027 — Scale & Integration
                                </div>
                                <div class="engagements-grid">
                                    <div class="engagement-card">
                                        <div class="engagement-title">Q1-Q2: Network Infrastructure Modernization</div>
                                        <div class="engagement-description">
                                            Upgrade core switching, 10Gb backbone, next-gen firewalls. Owner: Geremia Doan.
                                        </div>
                                        <span class="engagement-metric">
                                            <span class="engagement-metric-icon">📅</span> Jan-Jun 2027
                                        </span>
                                    </div>
                                    <div class="engagement-card">
                                        <div class="engagement-title">Q2: Clinical Integration Hub</div>
                                        <div class="engagement-description">
                                            Connect PCC with 8 ancillary systems for seamless data flow. Owner: Rogi Poblete.
                                        </div>
                                        <span class="engagement-metric">
                                            <span class="engagement-metric-icon">📅</span> Apr-Jun 2027
                                        </span>
                                    </div>
                                    <div class="engagement-card">
                                        <div class="engagement-title">Q3-Q4: SOC 2 Type II Certification</div>
                                        <div class="engagement-description">
                                            Achieve enterprise-grade security certification. Owner: Geremia Doan.
                                        </div>
                                        <span class="engagement-metric">
                                            <span class="engagement-metric-icon">📅</span> Jul-Dec 2027
                                        </span>
                                    </div>
                                </div>
                            </div>

                            <!-- 2028 Projects -->
                            <div class="content-section" style="margin-top: var(--space-8);">
                                <div class="section-label">
                                    <div class="section-label-icon"></div>
                                    2028 — Optimization & Innovation
                                </div>
                                <div class="engagements-grid">
                                    <div class="engagement-card">
                                        <div class="engagement-title">Q1-Q2: Enterprise AI Strategy Execution</div>
                                        <div class="engagement-description">
                                            Deploy predictive analytics, advanced automation, RPA. Owner: Anthony Trujillo.
                                        </div>
                                        <span class="engagement-metric">
                                            <span class="engagement-metric-icon">📅</span> Jan-Jun 2028
                                        </span>
                                    </div>
                                    <div class="engagement-card">
                                        <div class="engagement-title">Q3: Strategic Vendor Consolidation</div>
                                        <div class="engagement-description">
                                            Reduce from 40+ to 15 strategic partnerships. $180K savings target. Owner: Anthony Trujillo.
                                        </div>
                                        <span class="engagement-metric">
                                            <span class="engagement-metric-icon">📅</span> Jul-Sep 2028
                                        </span>
                                    </div>
                                    <div class="engagement-card">
                                        <div class="engagement-title">Q4: "30 by 30" Technology Readiness</div>
                                        <div class="engagement-description">
                                            Final validation of infrastructure, security, and support systems for 30-facility operations.
                                        </div>
                                        <span class="engagement-metric">
                                            <span class="engagement-metric-icon">📅</span> Oct-Dec 2028
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </main>

    <!-- ============================================
         JAVASCRIPT - Tab Navigation Logic + Kanban
         ============================================ -->
    <script>
        // ==================== GOOGLE SHEETS INTEGRATION ====================
        
        const SHEET_CONFIG = {
            spreadsheetId: '1WCPNNt1op5DkdPvX9DDlo6txw6SfIK51HYZng5v2KJY',
            apiKey: 'AIzaSyDAemzDfJ37kjYbaBSoBXprdAPagkZ07vg',
            clientId: '593454334812-qp5ic5292vbe273ina2f6egru32qc5r1.apps.googleusercontent.com',
            scope: 'https://www.googleapis.com/auth/spreadsheets',
            baseUrl: 'https://sheets.googleapis.com/v4/spreadsheets'
        };

        let accessToken = null;
        let tokenClient = null;

        // Initialize Google Identity Services
        function initializeGoogleAuth() {
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: SHEET_CONFIG.clientId,
                scope: SHEET_CONFIG.scope,
                callback: (response) => {
                    if (response.access_token) {
                        accessToken = response.access_token;
                        console.log('✅ Authenticated with Google');
                        updateAuthUI(true);
                        
                        // Try to load data after auth
                        loadKanbanFromSheets();
                    }
                },
            });
            
            // Check if we already have a token in session storage
            const savedToken = sessionStorage.getItem('google_access_token');
            if (savedToken) {
                accessToken = savedToken;
                updateAuthUI(true);
                console.log('📋 Using saved access token');
            }
        }

        // Sign in with Google
        function signInWithGoogle() {
            if (tokenClient) {
                tokenClient.requestAccessToken();
            }
        }

        // Sign out
        function signOutGoogle() {
            accessToken = null;
            sessionStorage.removeItem('google_access_token');
            google.accounts.oauth2.revoke(accessToken, () => {
                console.log('Signed out');
            });
            updateAuthUI(false);
        }

        // Reload data from Google Sheets
        async function reloadFromSheet() {
            console.log('🔄 Reloading from Google Sheets...');
            const sheetsData = await loadKanbanFromSheets();
            
            if (sheetsData) {
                kanbanData = sheetsData;
                renderKanban();
                showSaveNotification('✅ Reloaded from Sheet');
                console.log('✅ Data reloaded from Google Sheets');
            } else {
                showSaveNotification('⚠️ Could not load from Sheet');
                console.log('⚠️ Failed to reload from sheets');
            }
        }

        // Update UI based on auth state
        function updateAuthUI(isAuthenticated) {
            const authButton = document.getElementById('google-auth-btn');
            if (authButton) {
                if (isAuthenticated) {
                    authButton.textContent = '✅ Signed In';
                    authButton.classList.add('authenticated');
                    authButton.onclick = signOutGoogle;
                    // Save token
                    if (accessToken) {
                        sessionStorage.setItem('google_access_token', accessToken);
                    }
                } else {
                    authButton.textContent = '🔐 Sign in with Google';
                    authButton.classList.remove('authenticated');
                    authButton.onclick = signInWithGoogle;
                }
            }
        }

        // Helper: Read from Google Sheet
        async function readFromSheet(tabName) {
            const url = `${SHEET_CONFIG.baseUrl}/${SHEET_CONFIG.spreadsheetId}/values/${tabName}?key=${SHEET_CONFIG.apiKey}`;
            
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    console.error('Failed to read from sheet:', response.statusText);
                    return null;
                }
                const data = await response.json();
                return data.values || [];
            } catch (error) {
                console.error('Error reading from sheet:', error);
                return null;
            }
        }

        // Helper: Write to Google Sheet (requires OAuth)
        async function writeToSheet(tabName, values) {
            if (!accessToken) {
                console.warn('⚠️ Not authenticated. Please sign in with Google to save data.');
                // Save to localStorage as fallback
                localStorage.setItem(`sheet_${tabName}`, JSON.stringify(values));
                return false;
            }

            const url = `${SHEET_CONFIG.baseUrl}/${SHEET_CONFIG.spreadsheetId}/values/${tabName}?valueInputOption=RAW`;
            
            try {
                const response = await fetch(url, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${accessToken}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        values: values
                    })
                });
                
                if (!response.ok) {
                    console.error('Failed to write to sheet:', response.statusText);
                    // Fallback to localStorage
                    localStorage.setItem(`sheet_${tabName}`, JSON.stringify(values));
                    return false;
                }
                
                console.log(`✅ Data written to sheet: ${tabName}`);
                return true;
            } catch (error) {
                console.error('Error writing to sheet:', error);
                // Fallback to localStorage
                localStorage.setItem(`sheet_${tabName}`, JSON.stringify(values));
                return false;
            }
        }

        // Load Kanban data from Google Sheets
        async function loadKanbanFromSheets() {
            console.log('📥 Loading data from Google Sheets...');
            
            const currentData = await readFromSheet('responsibilities_current');
            const futureData = await readFromSheet('responsibilities_future');
            
            if (!currentData || !futureData || currentData.length <= 1) {
                console.log('⚠️ No data in sheets. Using defaults.');
                return null;
            }

            // Parse sheet data into kanbanData structure
            const currentParsed = parseSheetToKanban(currentData);
            const futureParsed = parseSheetToKanban(futureData);
            
            const parsedData = {
                current: currentParsed.kanban,
                future: futureParsed.kanban
            };
            
            // Also load key responsibilities
            keyResponsibilities.current = currentParsed.keys;
            keyResponsibilities.future = futureParsed.keys;

            // Store tasks maps
            responsibilityTasks.current = currentParsed.tasksMap;
            responsibilityTasks.future = futureParsed.tasksMap;

            console.log('✅ Data loaded from Google Sheets');
            return parsedData;
        }

        // Convert sheet rows to kanban structure
        function parseSheetToKanban(rows) {
            const kanban = {
                backlog: [],
                anthony: [],
                geremia: [],
                francis: [],
                tom: [],
                rogi: [],
                jon: []
            };

            const keys = {
                anthony: [],
                geremia: [],
                francis: [],
                tom: [],
                rogi: [],
                jon: []
            };

            const tasksMap = {}; // Store tasks for each responsibility

            // Skip header row
            for (let i = 1; i < rows.length; i++) {
                const [person, responsibility, isKey, tasksString] = rows[i];
                if (person && responsibility) {
                    const personKey = person.toLowerCase();
                    if (kanban[personKey] !== undefined) {
                        kanban[personKey].push(responsibility);
                        
                        // Track if marked as key
                        if (isKey === 'TRUE' || isKey === 'true' || isKey === true) {
                            keys[personKey].push(responsibility);
                        }

                        // Parse and store tasks if present
                        if (tasksString && tasksString.trim()) {
                            const tasks = tasksString.split(';').map(t => t.trim()).filter(t => t);
                            tasksMap[responsibility] = tasks;
                        }
                    }
                }
            }

            return { kanban, keys, tasksMap };
        }

        // Convert kanban structure to sheet rows
        function kanbanToSheetRows(kanbanState, state) {
            const rows = [['person', 'responsibility', 'is_key', 'tasks']]; // Header row with tasks column
            
            Object.keys(kanbanState).forEach(person => {
                const responsibilities = kanbanState[person];
                const keyResps = keyResponsibilities[state][person] || [];
                const tasksMap = responsibilityTasks[state] || {};
                
                responsibilities.forEach(responsibility => {
                    const isKey = keyResps.includes(responsibility);
                    const tasks = tasksMap[responsibility] || [];
                    const tasksString = tasks.length > 0 ? tasks.join('; ') : '';
                    rows.push([person, responsibility, isKey ? 'TRUE' : 'FALSE', tasksString]);
                });
            });

            return rows;
        }

        // Save Kanban data to Google Sheets
        async function saveKanbanToSheets() {
            console.log('💾 Saving data to Google Sheets...');
            
            const currentRows = kanbanToSheetRows(kanbanData.current, 'current');
            const futureRows = kanbanToSheetRows(kanbanData.future, 'future');
            
            const currentSuccess = await writeToSheet('responsibilities_current', currentRows);
            const futureSuccess = await writeToSheet('responsibilities_future', futureRows);
            
            if (currentSuccess && futureSuccess) {
                console.log('✅ Data saved to Google Sheets');
                showSaveNotification('Saved to Google Sheets');
                return true;
            } else {
                console.log('💾 Saved to browser (sign in to sync with Google Sheets)');
                showSaveNotification('Saved locally');
                return false;
            }
        }

        // Show save notification
        function showSaveNotification(message) {
            const notification = document.getElementById('save-notification');
            if (notification) {
                notification.textContent = message;
                notification.style.display = 'block';
                setTimeout(() => {
                    notification.style.display = 'none';
                }, 2000);
            }
        }

        // ==================== TAB NAVIGATION ====================
        const navButtons = document.querySelectorAll('.nav-button');
        const profileCards = document.querySelectorAll('.profile-card');

        navButtons.forEach(button => {
            button.addEventListener('click', () => {
                const targetProfile = button.getAttribute('data-profile');
                
                // Update nav buttons
                navButtons.forEach(btn => {
                    btn.classList.remove('active');
                    btn.setAttribute('aria-selected', 'false');
                });
                button.classList.add('active');
                button.setAttribute('aria-selected', 'true');
                
                // Update profile cards with smooth transition
                profileCards.forEach(card => {
                    if (card.id === `profile-${targetProfile}`) {
                        card.classList.remove('hidden');
                        setTimeout(() => {
                            card.classList.add('active');
                        }, 10);
                    } else {
                        card.classList.add('exiting');
                        setTimeout(() => {
                            card.classList.remove('active', 'exiting');
                            card.classList.add('hidden');
                        }, 300);
                    }
                });

                // Smooth scroll to top of card on mobile
                if (window.innerWidth < 968) {
                    document.querySelector('.profile-container').scrollIntoView({ 
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {
                const activeButton = document.querySelector('.nav-button.active');
                const allButtons = Array.from(navButtons);
                const currentIndex = allButtons.indexOf(activeButton);
                
                let nextIndex;
                if (e.key === 'ArrowDown') {
                    nextIndex = (currentIndex + 1) % allButtons.length;
                } else {
                    nextIndex = (currentIndex - 1 + allButtons.length) % allButtons.length;
                }
                
                allButtons[nextIndex].click();
                allButtons[nextIndex].focus();
                e.preventDefault();
            }
        });

        // ==================== KANBAN BOARD ====================
        
        // Responsibility data structure with comprehensive IT tasks
        const responsibilities = {
            current: {
                anthony: [
                    "Defining and governing the lifecycle strategy for enterprise business applications (ERP, MDM, eFax, and core SaaS platforms)",
                    "Aligning technology initiatives with the '30 by 30' growth strategy and executive financial objectives",
                    "Leading vendor strategy, contract governance, and oversight of the Software Asset Management (SAM) program",
                    "Establishing enterprise standards, operating models, and success metrics across all IT domains"
                ],
                geremia: [
                    "Architecting and maintaining the SD-WAN and bandwidth backbone for all facilities",
                    "Leading virtualization strategy and data center consolidation initiatives",
                    "Executing the security roadmap, including network hardening, NDR, and Zero-Trust implementation"
                ],
                francis: [
                    "Owning the full service desk lifecycle and service performance outcomes",
                    "Implementing AI Tier-0 support systems to scale service delivery",
                    "Managing end-user adoption during system changes and upgrades"
                ],
                tom: [
                    "Managing hardware lifecycle and standardization across facilities",
                    "Executing after-hours maintenance and patching to avoid business disruption",
                    "Leading asset recovery and environmental sustainability initiatives"
                ],
                rogi: [
                    "Serving as SME for PointClickCare (PCC) and clinical SaaS platforms",
                    "Developing clinical documentation and training resources",
                    "Identifying and resolving workflow bottlenecks through system configuration and education"
                ],
                jon: [],
                backlog: [
                    "Database backup and recovery operations",
                    "Performance monitoring and query optimization",
                    "Database maintenance tasks and patching",
                    "Identity and access management (Active Directory, Azure AD administration)",
                    "User provisioning and deprovisioning workflows",
                    "Multi-factor authentication (MFA) deployment and support",
                    "Email security and anti-phishing initiatives",
                    "Endpoint detection and response (EDR) management",
                    "Security awareness training program development",
                    "Vulnerability scanning and patch prioritization",
                    "Network monitoring and alerting configuration",
                    "VPN and remote access support",
                    "Firewall rule management and documentation",
                    "Cloud cost optimization and monitoring",
                    "Backup verification and disaster recovery testing",
                    "IT asset inventory and lifecycle tracking",
                    "Software license compliance auditing",
                    "Technology refresh planning (desktop, laptops, mobile devices)",
                    "Printer and peripheral device management",
                    "Conference room technology support",
                    "Telecom and phone system administration",
                    "Internet and ISP vendor management",
                    "IT documentation and knowledge base maintenance",
                    "Change management and CAB processes",
                    "Incident management and root cause analysis",
                    "IT metrics and KPI dashboard development",
                    "Business continuity and disaster recovery planning",
                    "Compliance documentation (HIPAA, SOC 2, state regulations)",
                    "Internal IT project management",
                    "Cross-training and knowledge transfer initiatives"
                ]
            },
            future: {
                anthony: [
                    "Defining and governing the lifecycle strategy for enterprise business applications (ERP, MDM, eFax, and core SaaS platforms)",
                    "Aligning technology initiatives with the '30 by 30' growth strategy and executive financial objectives",
                    "Leading vendor strategy, contract governance, and oversight of the Software Asset Management (SAM) program",
                    "Establishing enterprise standards, operating models, and success metrics across all IT domains",
                    "Strategic cybersecurity architecture and risk governance",
                    "Business continuity and disaster recovery planning",
                    "IT metrics and KPI dashboard development",
                    "Cloud cost optimization and monitoring"
                ],
                geremia: [
                    "Architecting and maintaining the SD-WAN and bandwidth backbone for all facilities",
                    "Leading virtualization strategy and data center consolidation initiatives",
                    "Executing the security roadmap, including network hardening, NDR, and Zero-Trust implementation",
                    "Security operations and incident response",
                    "Firewall rule management and documentation",
                    "Network monitoring and alerting configuration",
                    "Vulnerability scanning and patch prioritization",
                    "Endpoint detection and response (EDR) management",
                    "Email security and anti-phishing initiatives"
                ],
                francis: [
                    "Owning the full service desk lifecycle and service performance outcomes",
                    "Implementing AI Tier-0 support systems to scale service delivery",
                    "Managing end-user adoption during system changes and upgrades",
                    "ITIL process design and optimization",
                    "Change management and CAB processes",
                    "Incident management and root cause analysis",
                    "IT documentation and knowledge base maintenance",
                    "Conference room technology support",
                    "VPN and remote access support"
                ],
                tom: [
                    "Managing hardware lifecycle and standardization across facilities",
                    "Executing after-hours maintenance and patching to avoid business disruption",
                    "Leading asset recovery and environmental sustainability initiatives",
                    "Network closets and access point management",
                    "Identity and access management (Active Directory, Azure AD administration)",
                    "User provisioning and deprovisioning workflows",
                    "Multi-factor authentication (MFA) deployment and support",
                    "IT asset inventory and lifecycle tracking",
                    "Technology refresh planning (desktop, laptops, mobile devices)",
                    "Printer and peripheral device management",
                    "Telecom and phone system administration"
                ],
                rogi: [
                    "Serving as SME for PointClickCare (PCC) and clinical SaaS platforms",
                    "Developing clinical documentation and training resources",
                    "Identifying and resolving workflow bottlenecks through system configuration and education",
                    "Clinical system integrations and vendor management",
                    "Compliance documentation (HIPAA, SOC 2, state regulations)",
                    "Security awareness training program development"
                ],
                jon: [
                    "Database backup and recovery operations",
                    "Performance monitoring and query optimization",
                    "Database maintenance tasks and patching",
                    "Backup verification and disaster recovery testing"
                ],
                backlog: [
                    "Software license compliance auditing",
                    "Internet and ISP vendor management",
                    "Internal IT project management",
                    "Cross-training and knowledge transfer initiatives"
                ]
            }
        };

        let currentState = 'current';
        let kanbanData = JSON.parse(JSON.stringify(responsibilities)); // Deep copy - will be replaced if sheets load
        let keyResponsibilities = {
            current: {
                anthony: [],
                geremia: [],
                francis: [],
                tom: [],
                rogi: [],
                jon: []
            },
            future: {
                anthony: [],
                geremia: [],
                francis: [],
                tom: [],
                rogi: [],
                jon: []
            }
        }; // Tracks which responsibilities are marked as "key"
        let responsibilityTasks = {
            current: {},
            future: {}
        }; // Maps responsibility title to array of tasks
        
        let engagementsData = {
            current: {
                anthony: [],
                geremia: [],
                francis: [],
                tom: [],
                rogi: [],
                jon: []
            },
            future: {
                anthony: [],
                geremia: [],
                francis: [],
                tom: [],
                rogi: [],
                jon: []
            }
        }; // Stores engagements for each person and state
        
        let hasUnsavedChanges = false; // Track if changes need to be applied to bios

        // Mark that changes need to be applied to bios
        function markUnsavedChanges() {
            hasUnsavedChanges = true;
            const banner = document.getElementById('unsaved-changes-banner');
            const applyBtn = document.getElementById('apply-changes');
            if (banner) {
                banner.style.display = 'block';
            }
            if (applyBtn) {
                // Change to blue primary button (no animation)
                applyBtn.classList.add('primary');
            }
        }

        // Clear unsaved changes indicator
        function clearUnsavedChanges() {
            hasUnsavedChanges = false;
            const banner = document.getElementById('unsaved-changes-banner');
            const applyBtn = document.getElementById('apply-changes');
            if (banner) {
                banner.style.display = 'none';
            }
            if (applyBtn) {
                // Change back to gray button
                applyBtn.classList.remove('primary');
            }
        }

        // Initialize Google Auth when library loads
        window.onload = function() {
            if (typeof google !== 'undefined') {
                initializeGoogleAuth();
            }
        };

        // Initialize: Try to load from Google Sheets
        (async function initializeKanbanData() {
            const sheetsData = await loadKanbanFromSheets();
            if (sheetsData) {
                kanbanData = sheetsData;
                console.log('📊 Using data from Google Sheets');
                // Re-render if kanban board is visible
                if (document.getElementById('kanban-board')) {
                    renderKanban();
                }
                // Update all bios with loaded data
                const people = ['anthony', 'geremia', 'francis', 'tom', 'rogi', 'jon'];
                people.forEach(person => {
                    if (document.getElementById(`profile-${person}`)) {
                        updateBioContent(person, 'current');
                    }
                });
            } else {
                console.log('📋 Using default data');
            }
            
            // Load engagements data
            await loadEngagementsFromSheets();
            
            // Load budget data
            await loadBudgetFromSheets();
        })();

        // Load engagements from Google Sheets
        async function loadEngagementsFromSheets() {
            console.log('📥 Loading engagements from Google Sheets...');
            
            const data = await readFromSheet('engagements');
            
            if (!data || data.length <= 1) {
                console.log('⚠️ No engagements data in sheets.');
                return;
            }

            // Reset engagements data
            engagementsData = {
                current: { anthony: [], geremia: [], francis: [], tom: [], rogi: [], jon: [] },
                future: { anthony: [], geremia: [], francis: [], tom: [], rogi: [], jon: [] }
            };

            // Parse engagements: person | title | description | metric | state
            for (let i = 1; i < data.length; i++) {
                const [person, title, description, metric, state] = data[i];
                if (person && title && state) {
                    const personKey = person.toLowerCase();
                    const stateKey = state.toLowerCase() === 'future' ? 'future' : 'current';
                    
                    if (engagementsData[stateKey][personKey] !== undefined) {
                        engagementsData[stateKey][personKey].push({
                            title: title || '',
                            description: description || '',
                            metric: metric || ''
                        });
                    }
                }
            }

            console.log('✅ Engagements loaded from Google Sheets');
            
            // Update all bio pages with engagement data
            const people = ['anthony', 'geremia', 'francis', 'tom', 'rogi', 'jon'];
            people.forEach(person => {
                updateEngagementsDisplay(person, 'current');
            });
        }

        // Update engagements display for a person
        function updateEngagementsDisplay(person, state) {
            const profile = document.getElementById(`profile-${person}`);
            if (!profile) return;

            const engagementsGrid = profile.querySelector('.engagements-grid');
            if (!engagementsGrid) return;

            // Clear existing engagements
            engagementsGrid.innerHTML = '';

            let engagements = engagementsData[state][person] || [];
            
            // Randomize past/current state engagements if more than 3
            if (state === 'current' && engagements.length > 3) {
                engagements = shuffleArray([...engagements]).slice(0, 3);
            }

            // Display engagements (max 3)
            engagements.slice(0, 3).forEach(engagement => {
                const card = document.createElement('div');
                card.className = 'engagement-card';
                
                const titleDiv = document.createElement('div');
                titleDiv.className = 'engagement-title';
                titleDiv.textContent = engagement.title;
                
                const descDiv = document.createElement('div');
                descDiv.className = 'engagement-description';
                descDiv.textContent = engagement.description;
                
                const metricSpan = document.createElement('span');
                metricSpan.className = 'engagement-metric';
                metricSpan.innerHTML = `<span class="engagement-metric-icon">✓</span> ${engagement.metric}`;
                
                card.appendChild(titleDiv);
                card.appendChild(descDiv);
                card.appendChild(metricSpan);
                engagementsGrid.appendChild(card);
            });

            // Show empty state if no engagements
            if (engagements.length === 0) {
                const emptyDiv = document.createElement('div');
                emptyDiv.style.padding = 'var(--space-8)';
                emptyDiv.style.textAlign = 'center';
                emptyDiv.style.color = 'var(--gray-500)';
                emptyDiv.textContent = state === 'current' ? 'No past engagements recorded' : 'No future engagements planned';
                engagementsGrid.appendChild(emptyDiv);
            }
        }

        // Shuffle array (Fisher-Yates algorithm)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Future Engagements / Upcoming Projects data
        const futureEngagements = {
            anthony: [
                {
                    title: "Enterprise AI Strategy",
                    description: "Develop comprehensive AI adoption roadmap including Tier-0 helpdesk automation, predictive analytics for resource planning, and RPA for routine administrative tasks.",
                    metric: "Est. $240K Annual Savings"
                },
                {
                    title: "Cloud Cost Optimization Initiative",
                    description: "Implement FinOps practices, right-size cloud resources, and negotiate enterprise agreements to reduce cloud spend while supporting growth.",
                    metric: "Target: 25% Cost Reduction"
                },
                {
                    title: "Strategic Vendor Consolidation",
                    description: "Consolidate 40+ vendor relationships into 15 strategic partnerships, improving leverage, reducing management overhead, and streamlining procurement.",
                    metric: "Projected: $180K Savings"
                }
            ],
            geremia: [
                {
                    title: "Zero Trust Architecture Completion",
                    description: "Complete implementation of zero trust security model across all facilities, including micro-segmentation, continuous verification, and enhanced monitoring.",
                    metric: "Target: Q3 2025"
                },
                {
                    title: "Network Infrastructure Modernization",
                    description: "Upgrade core switching infrastructure, implement 10Gb backbone, and deploy next-gen firewalls to support 30-facility growth strategy.",
                    metric: "12-Month Initiative"
                },
                {
                    title: "SOC 2 Type II Certification",
                    description: "Achieve SOC 2 Type II certification to meet enterprise customer requirements and enhance competitive positioning in the market.",
                    metric: "Certification Target: Q4 2025"
                }
            ],
            francis: [
                {
                    title: "AI-Powered Service Desk (Tier-0)",
                    description: "Deploy AI chatbot handling 60% of routine requests autonomously, dramatically reducing response times and freeing technical staff for complex issues.",
                    metric: "Target: 60% Ticket Deflection"
                },
                {
                    title: "ITIL Process Maturity",
                    description: "Elevate service delivery to ITIL v4 practices, implementing formal change advisory board, problem management, and service catalog.",
                    metric: "Maturity Level 3 by EOY"
                },
                {
                    title: "User Experience Dashboard",
                    description: "Launch real-time UX monitoring dashboard tracking system performance, user satisfaction, and service quality metrics accessible to leadership.",
                    metric: "Real-Time Visibility"
                }
            ],
            tom: [
                {
                    title: "Hardware Lifecycle Automation",
                    description: "Implement automated asset tracking, predictive replacement scheduling, and streamlined procurement workflows to support rapid facility expansion.",
                    metric: "100% Asset Visibility"
                },
                {
                    title: "Identity Management Modernization",
                    description: "Migrate to Azure AD-native identity management with automated provisioning, self-service password reset, and enhanced security controls.",
                    metric: "90% Automation Rate"
                },
                {
                    title: "Wireless Infrastructure Expansion",
                    description: "Deploy enterprise-grade wireless across all facilities with capacity for 30-facility future state, including IoT device support and guest networks.",
                    metric: "12-Facility Deployment"
                }
            ],
            rogi: [
                {
                    title: "Clinical Workflow Optimization Program",
                    description: "Partner with clinical leadership to identify and resolve EHR workflow bottlenecks, reducing documentation time and improving clinician satisfaction.",
                    metric: "Target: 15% Time Savings"
                },
                {
                    title: "Clinical System Integration Hub",
                    description: "Implement integration platform connecting PCC with pharmacy, labs, and ancillary systems for seamless data flow and reduced manual entry.",
                    metric: "8 System Integrations"
                },
                {
                    title: "Clinician Technology Training Academy",
                    description: "Establish ongoing training program with video library, quick reference guides, and hands-on sessions to maximize clinical system adoption.",
                    metric: "Quarterly Training Cycles"
                }
            ],
            jon: [
                {
                    title: "Database Performance Optimization",
                    description: "Comprehensive query optimization, index tuning, and database consolidation initiative to support 30-facility data growth.",
                    metric: "Target: 40% Faster Queries"
                },
                {
                    title: "Automated Backup Verification",
                    description: "Implement automated backup testing and recovery validation ensuring 100% data recoverability across all critical systems.",
                    metric: "100% Backup Confidence"
                },
                {
                    title: "Database Monitoring Dashboard",
                    description: "Deploy real-time database health monitoring with predictive alerts for capacity, performance, and availability issues.",
                    metric: "Proactive Monitoring"
                }
            ]
        };

        // Initialize Kanban Board
        function initKanban() {
            renderKanban();
            setupDragAndDrop();
            setupStateToggle();
            setupButtons();
        }

        // Render Kanban Cards
        function renderKanban() {
            const columns = ['backlog', 'anthony', 'geremia', 'francis', 'tom', 'rogi', 'jon'];
            
            columns.forEach(columnName => {
                const column = document.querySelector(`[data-column="${columnName}"]`);
                const cardsContainer = column.querySelector('.kanban-cards');
                const countElement = column.querySelector('.count');
                
                cardsContainer.innerHTML = '';
                
                const items = kanbanData[currentState][columnName] || [];
                
                items.forEach((item, index) => {
                    const card = createCard(item, columnName, index);
                    cardsContainer.appendChild(card);
                });

                // Update count
                countElement.textContent = items.length;

                // Show empty state if no items
                if (items.length === 0) {
                    const emptyState = document.createElement('div');
                    emptyState.className = 'kanban-empty';
                    emptyState.textContent = 'Drop responsibilities here';
                    cardsContainer.appendChild(emptyState);
                }
            });
        }

        // Create Card Element
        function createCard(text, column, index) {
            const card = document.createElement('div');
            card.className = 'kanban-card';
            card.draggable = true;
            card.dataset.column = column;
            card.dataset.index = index;
            card.dataset.text = text;

            const title = document.createElement('div');
            title.className = 'kanban-card-title';
            
            // Check if this responsibility has tasks (Future State grouped view)
            const tasks = responsibilityTasks[currentState]?.[text] || [];
            const hasTasks = tasks.length > 0 && currentState === 'future';

            if (hasTasks) {
                // Future State: Grouped responsibility with expandable tasks
                title.innerHTML = `
                    <div style="display: flex; align-items: center; justify-content: space-between; width: 100%;">
                        <span>${text}</span>
                        <span class="expand-icon" style="font-size: 12px; color: var(--gray-500); cursor: pointer;">▼</span>
                    </div>
                `;
                
                // Make title clickable to expand
                title.style.cursor = 'pointer';
                title.onclick = (e) => {
                    e.stopPropagation();
                    toggleCardExpansion(card, text);
                };
            } else {
                // Current State: Simple flat task
                title.textContent = text;
            }

            const meta = document.createElement('div');
            meta.className = 'kanban-card-meta';

            const badge = document.createElement('span');
            badge.className = `kanban-card-badge ${currentState}`;
            badge.textContent = currentState === 'current' ? 'Current' : 'Future';
            
            meta.appendChild(badge);

            // Add key button for team member columns (not backlog)
            if (column !== 'backlog') {
                const isKey = keyResponsibilities[currentState][column]?.includes(text) || false;
                const starBtn = document.createElement('button');
                starBtn.className = `kanban-card-star ${isKey ? 'active' : ''}`;
                starBtn.innerHTML = '🗝️';
                starBtn.style.filter = isKey ? 'none' : 'grayscale(100%) opacity(0.3)';
                starBtn.title = isKey ? 'Remove from key responsibilities' : 'Mark as key responsibility';
                starBtn.onclick = (e) => {
                    e.stopPropagation();
                    toggleKeyResponsibility(text, column);
                };
                meta.appendChild(starBtn);
            }

            card.appendChild(title);
            card.appendChild(meta);

            return card;
        }

        // Toggle card expansion for Future State grouped responsibilities
        function toggleCardExpansion(card, respTitle) {
            const tasks = responsibilityTasks[currentState]?.[respTitle] || [];
            if (tasks.length === 0) return;

            // Check if already expanded
            let tasksList = card.querySelector('.tasks-list');
            const expandIcon = card.querySelector('.expand-icon');

            if (tasksList) {
                // Collapse
                tasksList.remove();
                expandIcon.textContent = '▼';
            } else {
                // Expand
                tasksList = document.createElement('div');
                tasksList.className = 'tasks-list';
                tasksList.style.cssText = 'margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--gray-200); font-size: 12px; color: var(--gray-600);';
                
                const ul = document.createElement('ul');
                ul.style.cssText = 'margin: 0; padding-left: 16px; list-style: disc;';
                
                tasks.forEach(task => {
                    const li = document.createElement('li');
                    li.textContent = task;
                    li.style.marginBottom = '4px';
                    ul.appendChild(li);
                });
                
                tasksList.appendChild(ul);
                card.appendChild(tasksList);
                expandIcon.textContent = '▲';
            }
        }

        // Drag and Drop Setup
        function setupDragAndDrop() {
            let draggedCard = null;
            let sourceColumn = null;

            // Drag start
            document.addEventListener('dragstart', (e) => {
                if (e.target.classList.contains('kanban-card')) {
                    draggedCard = e.target;
                    sourceColumn = e.target.dataset.column;
                    e.target.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                }
            });

            // Drag end
            document.addEventListener('dragend', (e) => {
                if (e.target.classList.contains('kanban-card')) {
                    e.target.classList.remove('dragging');
                    document.querySelectorAll('.drag-over').forEach(el => {
                        el.classList.remove('drag-over');
                    });
                }
            });

            // Drag over
            document.addEventListener('dragover', (e) => {
                e.preventDefault();
                const dropZone = e.target.closest('[data-droppable="true"]');
                if (dropZone) {
                    const column = dropZone.closest('.kanban-column');
                    column.classList.add('drag-over');
                }
            });

            // Drag leave
            document.addEventListener('dragleave', (e) => {
                const column = e.target.closest('.kanban-column');
                if (column && !column.contains(e.relatedTarget)) {
                    column.classList.remove('drag-over');
                }
            });

            // Drop
            document.addEventListener('drop', (e) => {
                e.preventDefault();
                const dropZone = e.target.closest('[data-droppable="true"]');
                
                if (dropZone && draggedCard) {
                    const targetColumn = dropZone.closest('.kanban-column').dataset.column;
                    const cardText = draggedCard.dataset.text;
                    const cardIndex = parseInt(draggedCard.dataset.index);

                    // Remove from source
                    kanbanData[currentState][sourceColumn].splice(cardIndex, 1);

                    // Add to target
                    if (!kanbanData[currentState][targetColumn]) {
                        kanbanData[currentState][targetColumn] = [];
                    }
                    kanbanData[currentState][targetColumn].push(cardText);

                    // Re-render
                    renderKanban();

                    // Mark unsaved changes
                    markUnsavedChanges();

                    // Auto-save to sheets
                    saveKanbanToSheets();

                    // Remove drag-over class
                    document.querySelectorAll('.drag-over').forEach(el => {
                        el.classList.remove('drag-over');
                    });
                }
            });
        }

        // State Toggle
        function setupStateToggle() {
            const toggleButtons = document.querySelectorAll('.state-toggle-btn');
            const indicator = document.querySelector('.comparison-indicator span strong');
            const dot = document.querySelector('.comparison-dot');

            toggleButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const newState = btn.dataset.state;
                    
                    if (newState !== currentState) {
                        currentState = newState;
                        
                        // Update UI
                        toggleButtons.forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        
                        indicator.textContent = newState === 'current' ? 'Current State' : 'Future State';
                        dot.classList.toggle('future', newState === 'future');
                        
                        // Re-render board
                        renderKanban();
                    }
                });
            });
        }

        // Button Actions
        function setupButtons() {
            // Reset button
            // Save as default button
            document.getElementById('save-as-default').addEventListener('click', () => {
                if (confirm('Save current assignments as the new default? This will overwrite the existing default state.')) {
                    responsibilities = JSON.parse(JSON.stringify(kanbanData));
                    alert('✅ Current state saved as default!\n\nThe "Reset to Default" button will now restore to this configuration.');
                }
            });

            document.getElementById('reset-kanban').addEventListener('click', () => {
                if (confirm('Reset to default assignments? This will discard your changes.')) {
                    kanbanData = JSON.parse(JSON.stringify(responsibilities));
                    renderKanban();
                }
            });

            // Clear all assignments button
            document.getElementById('clear-all-assignments').addEventListener('click', () => {
                const currentState = document.querySelector('.state-toggle-btn.active').dataset.state;
                const stateLabel = currentState === 'current' ? 'Current State' : 'Future State';
                
                if (confirm(`Clear all assignments for ${stateLabel}? All responsibilities will move to Unassigned.`)) {
                    clearAllAssignments(currentState);
                }
            });

            // Apply changes button
            document.getElementById('apply-changes').addEventListener('click', () => {
                applyToBios();
            });

            // Add responsibility button
            document.getElementById('add-responsibility-btn').addEventListener('click', () => {
                addNewResponsibility();
            });

            // Allow Enter key to submit (with Shift+Enter for new line)
            document.getElementById('new-responsibility-input').addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    addNewResponsibility();
                }
            });
        }

        // Toggle key responsibility status
        function toggleKeyResponsibility(text, column) {
            if (!keyResponsibilities[currentState][column]) {
                keyResponsibilities[currentState][column] = [];
            }

            const keyList = keyResponsibilities[currentState][column];
            const index = keyList.indexOf(text);

            if (index > -1) {
                // Remove from key responsibilities
                keyList.splice(index, 1);
            } else {
                // Add to key responsibilities
                keyList.push(text);
            }

            // Re-render to update star
            renderKanban();
            
            // Mark unsaved changes
            markUnsavedChanges();
            
            // Save to sheets
            saveKanbanToSheets();
        }

        // Clear all assignments for the current view
        function clearAllAssignments(state) {
            const stateData = kanbanData[state];
            const allResponsibilities = [];
            
            // Collect all responsibilities from all team members
            Object.keys(stateData).forEach(key => {
                if (key !== 'backlog' && Array.isArray(stateData[key])) {
                    allResponsibilities.push(...stateData[key]);
                    stateData[key] = []; // Empty the column
                }
            });
            
            // Add existing backlog items
            if (!stateData.backlog) {
                stateData.backlog = [];
            }
            allResponsibilities.push(...stateData.backlog);
            
            // Set all responsibilities to backlog
            stateData.backlog = allResponsibilities;
            
            // Re-render
            renderKanban();
            
            // Auto-save
            saveKanbanToSheets();
        }

        // Add new responsibility to backlog
        function addNewResponsibility() {
            const input = document.getElementById('new-responsibility-input');
            const text = input.value.trim();

            if (text) {
                // Add to both current and future states
                if (!kanbanData.current.backlog) {
                    kanbanData.current.backlog = [];
                }
                if (!kanbanData.future.backlog) {
                    kanbanData.future.backlog = [];
                }

                kanbanData.current.backlog.push(text);
                kanbanData.future.backlog.push(text);

                // Clear input
                input.value = '';

                // Re-render
                renderKanban();

                // Mark unsaved changes
                markUnsavedChanges();

                // Auto-save to sheets
                saveKanbanToSheets();

                // Show feedback
                input.placeholder = '✅ Added & Saved! Enter another...';
                setTimeout(() => {
                    input.placeholder = 'Enter a new responsibility to add to the backlog...';
                }, 2000);
            }
        }

        // Apply Kanban changes to bio pages
        function applyToBios() {
            const people = ['anthony', 'geremia', 'francis', 'tom', 'rogi', 'jon'];
            
            people.forEach(person => {
                const responsibilities = kanbanData[currentState][person] || [];
                const keyResps = keyResponsibilities[currentState][person] || [];
                const profileCard = document.getElementById(`profile-${person}`);
                
                if (profileCard && responsibilities.length > 0) {
                    const responsibilitiesList = profileCard.querySelector('.responsibilities-list');
                    
                    if (responsibilitiesList) {
                        // Clear existing
                        responsibilitiesList.innerHTML = '';
                        
                        // Add Key Responsibilities section if there are any
                        if (keyResps.length > 0) {
                            const keyHeader = document.createElement('li');
                            keyHeader.style.fontWeight = '700';
                            keyHeader.style.marginTop = '12px';
                            keyHeader.style.marginBottom = '4px';
                            keyHeader.style.color = 'var(--navy-900)';
                            keyHeader.textContent = '🗝️ Key Responsibilities:';
                            responsibilitiesList.appendChild(keyHeader);
                            
                            keyResps.forEach(resp => {
                                const li = document.createElement('li');
                                li.className = 'responsibility-item';
                                li.style.fontWeight = '600';
                                li.textContent = resp;
                                responsibilitiesList.appendChild(li);
                            });
                            
                            // Add divider
                            const divider = document.createElement('li');
                            divider.style.fontWeight = '700';
                            divider.style.marginTop = '12px';
                            divider.style.marginBottom = '4px';
                            divider.style.color = 'var(--navy-900)';
                            divider.textContent = 'All Responsibilities:';
                            responsibilitiesList.appendChild(divider);
                        }
                        
                        // Add all responsibilities EXCEPT the ones marked as key
                        responsibilities.forEach(resp => {
                            // Skip if this responsibility is already listed as key
                            if (!keyResps.includes(resp)) {
                                const li = document.createElement('li');
                                li.className = 'responsibility-item';
                                li.textContent = resp;
                                responsibilitiesList.appendChild(li);
                            }
                        });
                    }
                }
            });

            // Clear unsaved changes indicator
            clearUnsavedChanges();

            alert(`✅ Successfully applied ${currentState === 'current' ? 'Current' : 'Future'} State responsibilities to bio pages!\n\n${getTotalKeyCount()} key responsibilities highlighted.`);
        }

        // Helper to count total key responsibilities
        function getTotalKeyCount() {
            const people = ['anthony', 'geremia', 'francis', 'tom', 'rogi', 'jon'];
            let total = 0;
            people.forEach(person => {
                total += (keyResponsibilities[currentState][person] || []).length;
            });
            return total;
        }

        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initKanban);
        } else {
            initKanban();
        }

        // ==================== INTERACTIVE HEAT MAP ====================
        
        let heatmapEditMode = false;

        function initHeatmap() {
            const toggleBtn = document.getElementById('toggle-heatmap-edit');
            
            // Load RACI data from sheets
            loadRACIFromSheets();
            
            if (toggleBtn) {
                toggleBtn.addEventListener('click', () => {
                    heatmapEditMode = !heatmapEditMode;
                    
                    if (heatmapEditMode) {
                        toggleBtn.textContent = '✅ Edit Mode Active';
                        toggleBtn.style.background = 'var(--accent-green)';
                        toggleBtn.style.borderColor = 'var(--accent-green)';
                        toggleBtn.style.color = 'var(--white)';
                    } else {
                        toggleBtn.textContent = '🖊️ Enable Edit Mode';
                        toggleBtn.style.background = 'var(--white)';
                        toggleBtn.style.borderColor = 'var(--gray-300)';
                        toggleBtn.style.color = 'var(--navy-700)';
                    }
                });

                // Click handler for heat map cells and badges
                document.addEventListener('click', (e) => {
                    if (!heatmapEditMode) return;

                    if (e.target.classList.contains('heatmap-badge')) {
                        cycleHeatmapBadge(e.target);
                    } else if (e.target.closest('.heatmap-cell')) {
                        const cell = e.target.closest('.heatmap-cell');
                        // If clicking empty space in cell, add a new badge
                        if (e.target === cell) {
                            addHeatmapBadge(cell);
                        }
                    }
                });
            }
        }

        function cycleHeatmapBadge(badge) {
            const currentClass = badge.className.split(' ').find(c => ['a', 'r', 'c', 'i', 'empty'].includes(c));
            
            // If cycling to empty, remove the badge entirely
            if (currentClass === 'i') {
                badge.remove();
                saveRACIToSheets(); // Auto-save after edit
                return;
            }
            
            // Remove all RACI classes
            badge.classList.remove('a', 'r', 'c', 'i', 'empty');
            
            // Determine next state
            let nextClass, nextText;
            switch(currentClass) {
                case 'a':
                    nextClass = 'r';
                    nextText = 'R';
                    break;
                case 'r':
                    nextClass = 'c';
                    nextText = 'C';
                    break;
                case 'c':
                    nextClass = 'i';
                    nextText = 'I';
                    break;
                default:
                    nextClass = 'a';
                    nextText = 'A';
                    break;
            }
            
            badge.classList.add(nextClass);
            badge.textContent = nextText;
            saveRACIToSheets(); // Auto-save after edit
        }

        function addHeatmapBadge(cell) {
            const newBadge = document.createElement('span');
            newBadge.className = 'heatmap-badge a';
            newBadge.textContent = 'A';
            cell.appendChild(newBadge);
            saveRACIToSheets(); // Auto-save after adding badge
        }

        // Save RACI matrix to Google Sheets
        async function saveRACIToSheets() {
            console.log('💾 Saving RACI matrix to Google Sheets...');
            
            const rows = [['responsibility', 'marc', 'anthony', 'geremia', 'francis', 'tom', 'rogi', 'jon']]; // Header
            
            // Extract all RACI data from the heatmap tables
            const tables = document.querySelectorAll('.heatmap-table');
            tables.forEach(table => {
                const tbody = table.querySelector('tbody');
                if (!tbody) return;
                
                tbody.querySelectorAll('tr').forEach(row => {
                    const cells = row.querySelectorAll('td');
                    if (cells.length === 0) return;
                    
                    const responsibility = cells[0].textContent.trim();
                    const raciValues = [];
                    
                    // Extract RACI codes from each person column (skip first column which is responsibility name)
                    for (let i = 1; i < cells.length; i++) {
                        const badges = cells[i].querySelectorAll('.heatmap-badge');
                        const codes = Array.from(badges).map(b => b.textContent.trim()).join(',');
                        raciValues.push(codes || '');
                    }
                    
                    rows.push([responsibility, ...raciValues]);
                });
            });
            
            const success = await writeToSheet('raci_matrix', rows);
            
            if (success) {
                console.log('✅ RACI matrix saved to Google Sheets');
                showSaveNotification();
            } else {
                console.log('❌ Failed to save RACI matrix');
            }
        }

        // Load RACI matrix from Google Sheets
        async function loadRACIFromSheets() {
            const data = await readFromSheet('raci_matrix');
            if (!data || data.length <= 1) {
                console.log('📋 No RACI data found in sheets, using defaults');
                return;
            }
            
            // Skip header row
            for (let i = 1; i < data.length; i++) {
                const [responsibility, marc, anthony, geremia, francis, tom, rogi, jon] = data[i];
                
                // Find the row in the heatmap with this responsibility name
                const tables = document.querySelectorAll('.heatmap-table');
                tables.forEach(table => {
                    const tbody = table.querySelector('tbody');
                    if (!tbody) return;
                    
                    tbody.querySelectorAll('tr').forEach(row => {
                        const cells = row.querySelectorAll('td');
                        if (cells.length === 0) return;
                        
                        const rowResponsibility = cells[0].textContent.trim();
                        if (rowResponsibility === responsibility) {
                            // Update each person's column
                            const raciData = [marc, anthony, geremia, francis, tom, rogi, jon];
                            for (let j = 0; j < raciData.length; j++) {
                                const cellIndex = j + 1; // +1 because first column is responsibility name
                                if (cells[cellIndex]) {
                                    const cell = cells[cellIndex].querySelector('.heatmap-cell');
                                    if (cell) {
                                        // Clear existing badges
                                        cell.innerHTML = '';
                                        
                                        // Add new badges from saved data
                                        const codes = raciData[j].split(',').filter(c => c.trim());
                                        codes.forEach(code => {
                                            const badge = document.createElement('span');
                                            badge.className = `heatmap-badge ${code.toLowerCase()}`;
                                            badge.textContent = code;
                                            cell.appendChild(badge);
                                        });
                                    }
                                }
                            }
                        }
                    });
                });
            }
            
            console.log('✅ RACI matrix loaded from Google Sheets');
        }

        // Initialize heat map when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initHeatmap);
        } else {
            initHeatmap();
        }

        // ==================== BIO STATE MANAGEMENT ====================
        
        // Title mapping (current vs future)
        const titleData = {
            anthony: {
                current: "IT Director, South",
                future: "Vice President, Business Systems & Technology"
            },
            geremia: {
                current: "IT Director, North",
                future: "Director, IT Infrastructure & Security"
            },
            francis: {
                current: "Network Administrator",
                future: "IT Service Delivery Manager"
            },
            tom: {
                current: "Network Administrator",
                future: "Systems Administrator"
            },
            rogi: {
                current: "Clinical Project Specialist",
                future: "Clinical Systems Specialist"
            },
            jon: {
                current: "Database Administrator",
                future: "Database Administrator"
            }
        };

        function initBioStates() {
            // Set up state toggle for all profiles
            const people = ['anthony', 'geremia', 'francis', 'tom', 'rogi', 'jon'];
            
            people.forEach(person => {
                const profile = document.getElementById(`profile-${person}`);
                if (!profile) return;

                // Add state toggle if it doesn't exist
                const content = profile.querySelector('.profile-content');
                if (content && !content.querySelector('.profile-state-toggle')) {
                    const toggle = createStateToggle(person);
                    content.insertBefore(toggle, content.firstChild);
                }

                // Update title with data attributes
                const titleElement = profile.querySelector('.profile-title');
                if (titleElement && titleData[person]) {
                    titleElement.dataset.current = titleData[person].current;
                    titleElement.dataset.future = titleData[person].future;
                    titleElement.textContent = titleData[person].current;
                }
            });

            // Set up click handlers for state buttons
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('profile-state-btn')) {
                    const person = e.target.dataset.person;
                    const state = e.target.dataset.state;
                    switchBioState(person, state);
                }
            });

            // Initialize all bios to current state
            people.forEach(person => updateBioContent(person, 'current'));
        }

        function createStateToggle(person) {
            const toggle = document.createElement('div');
            toggle.className = 'profile-state-toggle';
            toggle.innerHTML = `
                <span class="profile-state-label">Viewing</span>
                <div class="profile-state-buttons">
                    <button class="profile-state-btn active current" data-state="current" data-person="${person}">
                        <span class="profile-state-dot current"></span>
                        Current State
                    </button>
                    <button class="profile-state-btn future" data-state="future" data-person="${person}">
                        <span class="profile-state-dot future"></span>
                        Future State
                    </button>
                </div>
            `;
            return toggle;
        }

        function switchBioState(person, state) {
            const profile = document.getElementById(`profile-${person}`);
            if (!profile) return;

            // Update button states
            const buttons = profile.querySelectorAll('.profile-state-btn');
            buttons.forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.state === state) {
                    btn.classList.add('active');
                }
            });

            // Add/remove future-mode class for visual treatment
            if (state === 'future') {
                profile.classList.add('future-mode');
            } else {
                profile.classList.remove('future-mode');
            }

            // Update content
            updateBioContent(person, state);
        }

        function updateBioContent(person, state) {
            const profile = document.getElementById(`profile-${person}`);
            if (!profile) return;

            // Update title
            const titleElement = profile.querySelector('.profile-title');
            if (titleElement && titleElement.dataset[state]) {
                titleElement.textContent = titleElement.dataset[state];
            }

            // Update summary
            const summaryElement = profile.querySelector('.profile-summary');
            if (summaryElement && summaryElement.dataset[state]) {
                summaryElement.textContent = summaryElement.dataset[state];
            }

            // Update accountability
            const accountabilityElement = profile.querySelector('.accountability-text');
            if (accountabilityElement && accountabilityElement.dataset[state]) {
                accountabilityElement.textContent = accountabilityElement.dataset[state];
            }

            // Update responsibilities from kanban data
            const responsibilities = kanbanData[state][person] || [];
            const keyResps = keyResponsibilities[state][person] || [];
            const responsibilitiesList = profile.querySelector('.responsibilities-list');
            
            if (responsibilitiesList) {
                responsibilitiesList.innerHTML = '';
                
                if (responsibilities.length > 0) {
                    // Add Key Responsibilities section if there are any
                    if (keyResps.length > 0) {
                        const keyHeader = document.createElement('li');
                        keyHeader.style.fontWeight = '700';
                        keyHeader.style.marginTop = '12px';
                        keyHeader.style.marginBottom = '4px';
                        keyHeader.style.color = 'var(--navy-900)';
                        keyHeader.textContent = '🗝️ Key Responsibilities:';
                        responsibilitiesList.appendChild(keyHeader);
                        
                        keyResps.forEach(resp => {
                            const li = document.createElement('li');
                            li.className = 'responsibility-item';
                            li.style.fontWeight = '600';
                            li.textContent = resp;
                            responsibilitiesList.appendChild(li);
                        });
                        
                        // Add divider
                        const divider = document.createElement('li');
                        divider.style.fontWeight = '700';
                        divider.style.marginTop = '12px';
                        divider.style.marginBottom = '4px';
                        divider.style.color = 'var(--navy-900)';
                        divider.textContent = 'All Responsibilities:';
                        responsibilitiesList.appendChild(divider);
                    }
                    
                    // Add all responsibilities EXCEPT the ones marked as key
                    responsibilities.forEach(resp => {
                        // Skip if this responsibility is already listed as key
                        if (!keyResps.includes(resp)) {
                            const li = document.createElement('li');
                            li.className = 'responsibility-item';
                            li.textContent = resp;
                            responsibilitiesList.appendChild(li);
                        }
                    });
                }
            }

            // Update engagements section label
            updateEngagementsSection(person, state);
            
            // Update engagements display
            updateEngagementsDisplay(person, state);
        }

        // Update engagements section based on state
        function updateEngagementsSection(person, state) {
            const profile = document.getElementById(`profile-${person}`);
            if (!profile) return;

            // Find the engagements section label
            const sections = profile.querySelectorAll('.section-label');
            sections.forEach(section => {
                const labelText = section.textContent.trim();
                if (labelText.includes('Engagements') || labelText.includes('Example')) {
                    const labelDiv = section.querySelector('.section-label');
                    if (!labelDiv) {
                        // Update the text directly
                        const icon = section.querySelector('.section-label-icon');
                        section.innerHTML = '';
                        if (icon) section.appendChild(icon.cloneNode(true));
                        const textNode = document.createTextNode(state === 'current' ? 'Past Engagements' : 'Future Engagements');
                        section.appendChild(textNode);
                    }
                }
            });
        }

        // Initialize bio states when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initBioStates);
        } else {
            initBioStates();
        }

        // ==================== FACILITY CALCULATOR ====================
        
        function initFacilityCalculator() {
            const bedInput = document.getElementById('bed-count');
            const staffInput = document.getElementById('staff-count');
            
            if (!bedInput || !staffInput) return;

            function calculateCosts() {
                const beds = parseInt(bedInput.value) || 120;
                const staff = parseInt(staffInput.value) || 85;

                // Cost calculations based on facility size
                const costs = {
                    network: {
                        onetime: 45000 + (beds * 50),
                        annual: 18000 + (beds * 20)
                    },
                    endpoints: {
                        onetime: staff * 1200,
                        annual: staff * 200
                    },
                    wireless: {
                        onetime: 35000,
                        annual: 6000
                    },
                    security: {
                        onetime: 25000,
                        annual: 12000 + (staff * 15)
                    },
                    licenses: {
                        onetime: 0,
                        annual: staff * 850
                    },
                    clinical: {
                        onetime: 15000,
                        annual: beds * 180
                    },
                    labor: {
                        onetime: 40000,
                        annual: 0
                    }
                };

                const breakdown = [
                    { category: 'Network Infrastructure', desc: 'Circuits, SD-WAN, switches, cabling', ...costs.network },
                    { category: 'Endpoints & Devices', desc: `${staff} workstations, laptops, printers`, ...costs.endpoints },
                    { category: 'Wireless Infrastructure', desc: 'Access points, controllers, site survey', ...costs.wireless },
                    { category: 'Security Systems', desc: 'Firewalls, cameras, access control', ...costs.security },
                    { category: 'Software Licenses', desc: 'Microsoft 365, MDM, productivity tools', ...costs.licenses },
                    { category: 'Clinical Systems', desc: 'PCC setup, training, integrations', ...costs.clinical },
                    { category: 'Labor & Professional Services', desc: 'Installation, configuration, testing', ...costs.labor }
                ];

                const totalOnetime = breakdown.reduce((sum, item) => sum + item.onetime, 0);
                const totalAnnual = breakdown.reduce((sum, item) => sum + item.annual, 0);

                // Update total display
                document.getElementById('total-estimate').textContent = 
                    `$${((totalOnetime + totalAnnual) / 1000).toFixed(0)}K`;

                // Update table
                const tbody = document.getElementById('facility-cost-breakdown');
                tbody.innerHTML = breakdown.map(item => `
                    <tr>
                        <td class="budget-category">${item.category}</td>
                        <td>${item.desc}</td>
                        <td>$${(item.onetime / 1000).toFixed(1)}K</td>
                        <td>$${(item.annual / 1000).toFixed(1)}K</td>
                    </tr>
                `).join('') + `
                    <tr class="budget-total-row">
                        <td colspan="2">TOTAL COST</td>
                        <td>$${(totalOnetime / 1000).toFixed(1)}K</td>
                        <td>$${(totalAnnual / 1000).toFixed(1)}K</td>
                    </tr>
                `;
            }

            bedInput.addEventListener('input', calculateCosts);
            staffInput.addEventListener('input', calculateCosts);
            
            // Initial calculation
            calculateCosts();
        }

        // Initialize facility calculator when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initFacilityCalculator);
        } else {
            initFacilityCalculator();
        }

        // ==================== BUDGET PLANNER ====================

        // Load budget data from Google Sheets
        async function loadBudgetFromSheets() {
            console.log('📥 Loading budget data from Google Sheets...');
            
            const categoriesData = await readFromSheet('budget_categories');
            const subcategoriesData = await readFromSheet('budget_subcategories');
            
            if (categoriesData && categoriesData.length > 1) {
                // Parse categories: category_id | name | current | market_low | market_mid | market_high | sweet_spot | max_recommended
                for (let i = 1; i < categoriesData.length; i++) {
                    const [id, name, current, marketLow, marketMid, marketHigh, sweetSpot, maxRecommended] = categoriesData[i];
                    if (id && budgetMarketData[id]) {
                        budgetMarketData[id].current = parseFloat(current) || budgetMarketData[id].current;
                        budgetMarketData[id].marketLow = parseFloat(marketLow) || budgetMarketData[id].marketLow;
                        budgetMarketData[id].marketMid = parseFloat(marketMid) || budgetMarketData[id].marketMid;
                        budgetMarketData[id].marketHigh = parseFloat(marketHigh) || budgetMarketData[id].marketHigh;
                        budgetMarketData[id].sweetSpot = parseFloat(sweetSpot) || budgetMarketData[id].sweetSpot;
                        budgetMarketData[id].maxRecommended = parseFloat(maxRecommended) || budgetMarketData[id].maxRecommended;
                    }
                }
                console.log('✅ Budget categories loaded from Google Sheets');
            }
            
            if (subcategoriesData && subcategoriesData.length > 1) {
                // Parse subcategories: parent_category | subcategory_id | name | current | market_low | market_mid | market_high | sweet_spot | max_recommended
                for (let i = 1; i < subcategoriesData.length; i++) {
                    const [parent, id, name, current, marketLow, marketMid, marketHigh, sweetSpot, maxRecommended] = subcategoriesData[i];
                    if (parent && id && subcategoryData[parent] && subcategoryData[parent][id]) {
                        subcategoryData[parent][id].current = parseFloat(current) || subcategoryData[parent][id].current;
                        subcategoryData[parent][id].marketLow = parseFloat(marketLow) || subcategoryData[parent][id].marketLow;
                        subcategoryData[parent][id].marketMid = parseFloat(marketMid) || subcategoryData[parent][id].marketMid;
                        subcategoryData[parent][id].marketHigh = parseFloat(marketHigh) || subcategoryData[parent][id].marketHigh;
                        subcategoryData[parent][id].sweetSpot = parseFloat(sweetSpot) || subcategoryData[parent][id].sweetSpot;
                        subcategoryData[parent][id].maxRecommended = parseFloat(maxRecommended) || subcategoryData[parent][id].maxRecommended;
                    }
                }
                console.log('✅ Budget subcategories loaded from Google Sheets');
            }
            
            // Refresh budget displays if they're visible
            if (document.getElementById('budget-line-items')) {
                renderBudgetItems();
                updateSummary();
            }
        }

        // ==================== BUDGET PLANNER ====================
        
        // Market data for SNF/Post-Acute IT in Orange County, CA
        const budgetMarketData = {
            infrastructure: {
                name: 'Infrastructure & Operations',
                current: 650000,
                marketLow: 720000,
                marketMid: 840000,
                marketHigh: 980000,
                sweetSpot: 860000,
                maxRecommended: 1050000,
                impacts: {
                    low: '⚠️ RISK: Aging infrastructure, frequent outages, inability to support growth. Technical debt accumulates. Security vulnerabilities increase. Staff frustration high.',
                    mid: '✓ ADEQUATE: Baseline operations maintained. Some modernization possible. Can support current facilities but growth limited.',
                    sweet: '⭐ OPTIMAL: Modern, scalable infrastructure. Zero-downtime operations. Ready for rapid expansion. Best cost-to-value ratio.',
                    high: '💰 PREMIUM: Top-tier infrastructure. Maximum redundancy. May exceed current needs. Consider if rapid growth is certain.',
                    excessive: '⚠️ OVERSPEND: Diminishing returns. Resources better allocated elsewhere. Gold-plating beyond organizational needs.'
                }
            },
            personnel: {
                name: 'Personnel & Team',
                current: 840000,
                marketLow: 880000,
                marketMid: 960000,
                marketHigh: 1100000,
                sweetSpot: 980000,
                maxRecommended: 1150000,
                impacts: {
                    low: '⚠️ RISK: Below-market compensation causes turnover. Difficulty attracting talent. Understaffing leads to burnout. Knowledge loss during transitions.',
                    mid: '✓ ADEQUATE: Competitive salaries. Team stability maintained. Limited training budget. Some turnover expected.',
                    sweet: '⭐ OPTIMAL: Premium talent retention. Continuous training investment. Low turnover. Team grows with organization.',
                    high: '💰 PREMIUM: Top-tier compensation. Excellent training programs. Very low turnover. May exceed market needs.',
                    excessive: '⚠️ OVERSPEND: Compensation significantly above market. ROI diminishes. Budget better spent on tools/infrastructure.'
                }
            },
            software: {
                name: 'Software & Licenses',
                current: 320000,
                marketLow: 420000,
                marketMid: 480000,
                marketHigh: 580000,
                sweetSpot: 500000,
                maxRecommended: 650000,
                impacts: {
                    low: '⚠️ RISK: Missing critical tools. Manual processes. Compliance gaps. Shadow IT emerges. Productivity suffers.',
                    mid: '✓ ADEQUATE: Core systems covered. Some automation. Basic productivity tools. Compliance maintained.',
                    sweet: '⭐ OPTIMAL: Best-in-class tools. Full automation. AI-powered efficiency. Strong competitive advantage.',
                    high: '💰 PREMIUM: Enterprise-grade everything. Maximum automation. Cutting-edge AI. May exceed needs.',
                    excessive: '⚠️ OVERSPEND: Tool bloat. License waste. Features unused. Complexity without benefit.'
                }
            },
            security: {
                name: 'Security & Compliance',
                current: 90000,
                marketLow: 180000,
                marketMid: 240000,
                marketHigh: 320000,
                sweetSpot: 260000,
                maxRecommended: 380000,
                impacts: {
                    low: '🚨 CRITICAL: Severe breach risk. Regulatory non-compliance. Inadequate monitoring. Potential fines. Reputation damage.',
                    mid: '✓ ADEQUATE: Basic security posture. Compliance maintained. Some gaps remain. Incident response possible.',
                    sweet: '⭐ OPTIMAL: Enterprise-grade security. Zero-trust architecture. Proactive threat hunting. Insurance discounts.',
                    high: '💰 PREMIUM: Maximum security controls. 24/7 SOC. Advanced threat intelligence. May exceed SNF risk profile.',
                    excessive: '⚠️ OVERSPEND: Over-engineered for healthcare setting. Budget better spent on operational improvements.'
                }
            }
        };

        let proposedBudget = {};
        let proposedSubBudgets = {};
        let comparisonMode = false;
        let granularView = false;

        // Granular subcategories with tag-based impacts
        const subcategoryData = {
            infrastructure: {
                network: {
                    name: 'Network & Connectivity',
                    current: 140000,
                    marketLow: 160000,
                    marketMid: 180000,
                    sweetSpot: 185000,
                    marketHigh: 210000,
                    maxRecommended: 240000,
                    tags: {
                        risk: ['Frequent outages', 'Slow connectivity', 'Can\'t support growth', 'User complaints'],
                        caution: ['Baseline reliable', 'Limited bandwidth', 'Growth constrained'],
                        optimal: ['99.9% uptime', '10Gb backbone', 'Expansion ready', 'High satisfaction'],
                        premium: ['Maximum redundancy', 'Future-proofed', 'Premium SLAs'],
                        overspend: ['Unused capacity', 'Over-engineered', 'Wasted budget']
                    }
                },
                cloud: {
                    name: 'Cloud & Data Center',
                    current: 190000,
                    marketLow: 210000,
                    marketMid: 240000,
                    sweetSpot: 245000,
                    marketHigh: 280000,
                    maxRecommended: 330000,
                    tags: {
                        risk: ['Performance issues', 'Limited scaling', 'High $/unit', 'Technical debt'],
                        caution: ['Baseline capacity', 'Manual scaling', 'Cost concerns'],
                        optimal: ['Auto-scaling', 'Cost optimized', 'Predictable spend', 'Growth ready'],
                        premium: ['Premium tiers', 'Reserved capacity', 'Global availability'],
                        overspend: ['Over-provisioned', 'Underutilized', 'Poor ROI']
                    }
                },
                virtualization: {
                    name: 'Virtualization & Servers',
                    current: 95000,
                    marketLow: 110000,
                    marketMid: 120000,
                    sweetSpot: 125000,
                    marketHigh: 145000,
                    maxRecommended: 170000,
                    tags: {
                        risk: ['Aging hardware', 'Limited redundancy', 'Recovery risk', 'Bottlenecks'],
                        caution: ['Basic HA', 'Older platform', 'Manual failover'],
                        optimal: ['Modern Nutanix', 'Full HA', 'Fast recovery', 'Capacity buffer'],
                        premium: ['Latest hardware', 'Maximum resilience', 'Premium support'],
                        overspend: ['Excess capacity', 'Premature refresh', 'Budget waste']
                    }
                },
                hardware: {
                    name: 'Hardware & Endpoints',
                    current: 105000,
                    marketLow: 120000,
                    marketMid: 135000,
                    sweetSpot: 140000,
                    marketHigh: 155000,
                    maxRecommended: 180000,
                    tags: {
                        risk: ['Old equipment', 'Slow performance', 'Security risk', 'User frustration'],
                        caution: ['Aging fleet', 'Refresh needed', 'Some complaints'],
                        optimal: ['Modern devices', 'Reliable performance', 'Secure', 'High productivity'],
                        premium: ['Premium models', 'Latest hardware', 'Executive-grade'],
                        overspend: ['Unnecessary upgrades', 'Over-specced', 'Budget surplus']
                    }
                },
                maintenance: {
                    name: 'Maintenance & Support',
                    current: 120000,
                    marketLow: 120000,
                    marketMid: 165000,
                    sweetSpot: 165000,
                    marketHigh: 190000,
                    maxRecommended: 220000,
                    tags: {
                        risk: ['Warranty gaps', 'Slow response', 'Extended downtime', 'DIY fixes'],
                        caution: ['Basic support', 'Limited hours', 'Some delays'],
                        optimal: ['24/7 support', 'Fast response', 'Vendor partnerships', 'Minimal downtime'],
                        premium: ['White-glove service', 'Dedicated TAMs', 'Instant response'],
                        overspend: ['Redundant contracts', 'Overlapping coverage', 'Wasted spend']
                    }
                }
            },
            personnel: {
                leadership: {
                    name: 'Leadership (Anthony, Geremia)',
                    current: 320000,
                    marketLow: 340000,
                    marketMid: 360000,
                    sweetSpot: 370000,
                    marketHigh: 400000,
                    maxRecommended: 450000,
                    tags: {
                        risk: ['Below market', 'Turnover risk', 'Recruiting difficult', 'Experience loss'],
                        caution: ['Market competitive', 'Some retention risk', 'Limited growth budget'],
                        optimal: ['Competitive pay', 'Stable leadership', 'Attract talent', 'Continuity'],
                        premium: ['Top quartile pay', 'Executive perks', 'Very stable'],
                        overspend: ['Above market premium', 'Inflated costs', 'Compensation imbalance']
                    }
                },
                technical: {
                    name: 'Technical Staff (Francis, Tom, Rogi)',
                    current: 380000,
                    marketLow: 390000,
                    marketMid: 420000,
                    sweetSpot: 430000,
                    marketHigh: 460000,
                    maxRecommended: 520000,
                    tags: {
                        risk: ['Retention issues', 'Skill gaps', 'Burnout risk', 'Quality concerns'],
                        caution: ['Market rate', 'Some turnover', 'Limited training'],
                        optimal: ['Competitive pay', 'Strong retention', 'Quality work', 'High morale'],
                        premium: ['Premium salaries', 'Excellent benefits', 'Very low turnover'],
                        overspend: ['Premium unsustainable', 'Compressed margins', 'Budget pressure']
                    }
                },
                database: {
                    name: 'Database Admin (Jon)',
                    current: 110000,
                    marketLow: 115000,
                    marketMid: 120000,
                    sweetSpot: 122000,
                    marketHigh: 135000,
                    maxRecommended: 150000,
                    tags: {
                        risk: ['Below market', 'Flight risk', 'Specialized role', 'Hard to replace'],
                        caution: ['Market rate', 'Some risk', 'Specialist premium'],
                        optimal: ['Competitive rate', 'Role stability', 'Knowledge retained'],
                        premium: ['Premium specialist rate', 'Very stable', 'Senior level'],
                        overspend: ['Premium excessive', 'Budget pressure']
                    }
                },
                training: {
                    name: 'Training & Development',
                    current: 30000,
                    marketLow: 35000,
                    marketMid: 60000,
                    sweetSpot: 58000,
                    marketHigh: 75000,
                    maxRecommended: 95000,
                    tags: {
                        risk: ['Stagnant skills', 'No certifications', 'Limited growth', 'Outdated knowledge'],
                        caution: ['Basic training', 'Some conferences', 'Slow progress'],
                        optimal: ['Continuous learning', 'Current certs', 'Career paths', 'Innovation'],
                        premium: ['Executive coaching', 'Premium programs', 'Conference travel'],
                        overspend: ['Excessive training', 'Underutilized', 'Budget inefficiency']
                    }
                }
            },
            software: {
                clinical: {
                    name: 'Clinical Systems (PCC)',
                    current: 140000,
                    marketLow: 170000,
                    marketMid: 180000,
                    sweetSpot: 185000,
                    marketHigh: 210000,
                    maxRecommended: 250000,
                    tags: {
                        risk: ['Limited modules', 'Manual workflows', 'Integration gaps', 'User frustration'],
                        caution: ['Core modules only', 'Some automation', 'Basic integrations'],
                        optimal: ['Full module suite', 'Automated workflows', 'Strong integrations', 'User satisfaction'],
                        premium: ['Premium modules', 'Advanced analytics', 'Custom development'],
                        overspend: ['Unused features', 'Over-licensed', 'Shelfware']
                    }
                },
                business: {
                    name: 'Business Systems (ERP, MDM)',
                    current: 85000,
                    marketLow: 110000,
                    marketMid: 120000,
                    sweetSpot: 125000,
                    marketHigh: 140000,
                    maxRecommended: 170000,
                    tags: {
                        risk: ['Legacy systems', 'Manual processes', 'Error-prone', 'Inefficiency'],
                        caution: ['Basic automation', 'Some integration', 'Manual workarounds'],
                        optimal: ['Modern platforms', 'Fully automated', 'Integrated', 'Efficient'],
                        premium: ['Enterprise features', 'Advanced workflows', 'Premium support'],
                        overspend: ['Over-engineered', 'Complex licensing', 'Poor utilization']
                    }
                },
                productivity: {
                    name: 'Microsoft 365 & Productivity',
                    current: 72000,
                    marketLow: 85000,
                    marketMid: 96000,
                    sweetSpot: 98000,
                    marketHigh: 115000,
                    maxRecommended: 135000,
                    tags: {
                        risk: ['Basic licenses', 'Limited collaboration', 'Security gaps', 'Productivity loss'],
                        caution: ['E1/E3 licenses', 'Basic collaboration', 'Some security'],
                        optimal: ['E3/E5 licenses', 'Full collaboration', 'Security included', 'High productivity'],
                        premium: ['E5 universal', 'Premium features', 'Advanced security'],
                        overspend: ['Unused premium features', 'Over-licensed users']
                    }
                },
                servicedesk: {
                    name: 'Service Desk & ITSM',
                    current: 23000,
                    marketLow: 40000,
                    marketMid: 48000,
                    sweetSpot: 50000,
                    marketHigh: 60000,
                    maxRecommended: 75000,
                    tags: {
                        risk: ['Manual ticketing', 'No automation', 'Slow response', 'User dissatisfaction'],
                        caution: ['Basic ITSM', 'Limited automation', 'Some delays'],
                        optimal: ['Modern ITSM', 'AI Tier-0', 'Fast resolution', 'User satisfaction'],
                        premium: ['Enterprise platform', 'Full automation', 'Premium features'],
                        overspend: ['Platform underutilized', 'Overbuilt for size']
                    }
                }
            },
            security: {
                infrastructure_security: {
                    name: 'Infrastructure Security',
                    current: 35000,
                    marketLow: 70000,
                    marketMid: 90000,
                    sweetSpot: 95000,
                    marketHigh: 110000,
                    maxRecommended: 135000,
                    tags: {
                        risk: ['Basic firewalls', 'No segmentation', 'Limited monitoring', 'Breach risk'],
                        caution: ['Standard firewalls', 'Some segmentation', 'Basic monitoring'],
                        optimal: ['Next-gen firewalls', 'Zero trust ready', 'Full monitoring', 'Protected'],
                        premium: ['Advanced threat protection', '24/7 SOC', 'Threat intelligence'],
                        overspend: ['Over-engineered', 'Redundant systems', 'Complex management']
                    }
                },
                endpoint_security: {
                    name: 'Endpoint & Email Security',
                    current: 28000,
                    marketLow: 55000,
                    marketMid: 72000,
                    sweetSpot: 75000,
                    marketHigh: 90000,
                    maxRecommended: 115000,
                    tags: {
                        risk: ['Basic antivirus', 'No EDR', 'Phishing risk', 'Ransomware exposure'],
                        caution: ['Standard AV', 'Basic email filtering', 'Some protection'],
                        optimal: ['EDR deployed', 'Email protection', 'Threat hunting', 'Secure endpoints'],
                        premium: ['XDR platform', 'Advanced email security', 'Behavioral analysis'],
                        overspend: ['Overlapping tools', 'Complex stack', 'Management overhead']
                    }
                },
                compliance: {
                    name: 'Compliance & Auditing',
                    current: 15000,
                    marketLow: 30000,
                    marketMid: 42000,
                    sweetSpot: 45000,
                    marketHigh: 60000,
                    maxRecommended: 80000,
                    tags: {
                        risk: ['Manual compliance', 'Audit gaps', 'Fine risk', 'Reputation risk'],
                        caution: ['Basic compliance', 'Manual processes', 'Some gaps'],
                        optimal: ['Automated compliance', 'Audit ready', 'Documentation current', 'Low risk'],
                        premium: ['Continuous compliance', 'Advanced GRC platform', 'Consultant support'],
                        overspend: ['Excessive auditing', 'Consultant overuse', 'Diminishing returns']
                    }
                },
                training_awareness: {
                    name: 'Security Training & Awareness',
                    current: 12000,
                    marketLow: 25000,
                    marketMid: 36000,
                    sweetSpot: 35000,
                    marketHigh: 45000,
                    maxRecommended: 60000,
                    tags: {
                        risk: ['No training', 'User errors common', 'Phishing success', 'Weak link'],
                        caution: ['Annual training', 'Basic awareness', 'Some progress'],
                        optimal: ['Regular training', 'Simulated phishing', 'Security culture', 'Human firewall'],
                        premium: ['Executive coaching', 'Advanced simulations', 'Gamification'],
                        overspend: ['Excessive training', 'Diminishing engagement', 'Time waste']
                    }
                }
            }
        };

        function initBudgetPlanner() {
            // Initialize with optimal (sweet spot) values
            Object.keys(budgetMarketData).forEach(key => {
                proposedBudget[key] = budgetMarketData[key].sweetSpot;
                
                // Initialize subcategories
                if (subcategoryData[key]) {
                    proposedSubBudgets[key] = {};
                    Object.keys(subcategoryData[key]).forEach(subKey => {
                        proposedSubBudgets[key][subKey] = subcategoryData[key][subKey].sweetSpot;
                    });
                }
            });

            renderBudgetItems();
            updateSummary();
            setupBudgetControls();
        }

        function renderBudgetItems() {
            const container = document.getElementById('budget-line-items');
            if (!container) return;

            container.innerHTML = Object.keys(budgetMarketData).map(key => {
                const item = budgetMarketData[key];
                const value = proposedBudget[key] || item.sweetSpot;
                const zone = getZone(item, value);
                const tags = budgetMarketData[key].tags ? budgetMarketData[key].tags[zone] : [];
                
                let html = `
                    <div class="planner-item">
                        <div class="planner-item-header">
                            <div class="planner-item-info">
                                <div class="planner-item-title">${item.name}</div>
                                <div class="planner-item-values">
                                    <div class="planner-value">
                                        <div class="planner-value-label">Proposed</div>
                                        <div class="planner-value-amount" data-item="${key}-proposed">
                                            $${(value / 1000).toFixed(0)}K
                                        </div>
                                    </div>
                                    ${comparisonMode ? `
                                    <div class="planner-value">
                                        <div class="planner-value-label">Current</div>
                                        <div class="planner-value-amount current">
                                            $${(item.current / 1000).toFixed(0)}K
                                        </div>
                                    </div>
                                    ` : ''}
                                </div>
                            </div>
                            <div id="risk-${key}">
                                ${getRiskIndicator(key, value)}
                            </div>
                        </div>

                        <div id="tags-${key}">
                            ${renderTags(tags, zone)}
                        </div>

                        <div class="planner-slider-container">
                            <div class="planner-slider-wrapper">
                                <div class="planner-slider-sweetspot" style="left: ${((item.sweetSpot - item.marketLow) / (item.maxRecommended - item.marketLow)) * 100}%"></div>
                                <input 
                                    type="range" 
                                    class="planner-slider" 
                                    id="slider-${key}"
                                    min="${item.marketLow}" 
                                    max="${item.maxRecommended}" 
                                    value="${value}"
                                    step="10000"
                                    data-item="${key}">
                            </div>
                            <div class="planner-slider-header">
                                <div class="planner-slider-labels">
                                    <span class="planner-slider-label">$${(item.marketLow / 1000).toFixed(0)}K</span>
                                    <span class="planner-slider-label">⭐ $${(item.sweetSpot / 1000).toFixed(0)}K</span>
                                    <span class="planner-slider-label">$${(item.maxRecommended / 1000).toFixed(0)}K</span>
                                </div>
                            </div>
                        </div>

                        <div class="planner-manual-input">
                            <label style="font-size: 13px; font-weight: 600; color: var(--gray-600);">Manual Entry:</label>
                            <input 
                                type="number" 
                                id="manual-${key}"
                                placeholder="Enter amount"
                                data-item="${key}">
                            <button class="kanban-btn" onclick="applyManualValue('${key}')">Apply</button>
                        </div>
                `;

                // Add granular subcategories if enabled
                if (granularView && subcategoryData[key]) {
                    html += `<div class="planner-subcategories" id="subcategories-${key}">`;
                    
                    Object.keys(subcategoryData[key]).forEach(subKey => {
                        const subItem = subcategoryData[key][subKey];
                        const subValue = proposedSubBudgets[key][subKey] || subItem.sweetSpot;
                        const subZone = getZone(subItem, subValue);
                        const subTags = subItem.tags ? subItem.tags[subZone] : [];
                        
                        html += `
                            <div class="planner-subcategory-item">
                                <div class="planner-subcategory-header">
                                    <div class="planner-subcategory-title">${subItem.name}</div>
                                    <div class="planner-subcategory-actions">
                                        <button class="planner-icon-btn" onclick="editSubcategory('${key}', '${subKey}')" title="Edit">✏️</button>
                                        <button class="planner-icon-btn danger" onclick="removeSubcategory('${key}', '${subKey}')" title="Remove">🗑️</button>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: center; gap: var(--space-3); margin-bottom: var(--space-3);">
                                    <span style="font-size: 18px; font-weight: 700; color: var(--navy-900);">$${(subValue / 1000).toFixed(0)}K</span>
                                    <span class="planner-risk-indicator ${subZone}">${subZone.toUpperCase()}</span>
                                </div>
                                ${renderTags(subTags, subZone)}
                                <div class="planner-slider-wrapper" style="margin-top: var(--space-3);">
                                    <div class="planner-slider-sweetspot" style="left: ${((subItem.sweetSpot - subItem.marketLow) / (subItem.maxRecommended - subItem.marketLow)) * 100}%"></div>
                                    <input 
                                        type="range" 
                                        class="planner-slider" 
                                        id="slider-${key}-${subKey}"
                                        min="${subItem.marketLow}" 
                                        max="${subItem.maxRecommended}" 
                                        value="${subValue}"
                                        step="5000"
                                        data-category="${key}"
                                        data-subcategory="${subKey}">
                                </div>
                                <div style="display: flex; justify-content: space-between; font-size: 11px; color: var(--gray-500); margin-top: var(--space-1);">
                                    <span>$${(subItem.marketLow / 1000).toFixed(0)}K</span>
                                    <span>⭐ $${(subItem.sweetSpot / 1000).toFixed(0)}K</span>
                                    <span>$${(subItem.maxRecommended / 1000).toFixed(0)}K</span>
                                </div>
                            </div>
                        `;
                    });

                    html += `
                        <div class="planner-add-item-form" id="add-form-${key}" style="display: none;">
                            <input type="text" placeholder="Line item name" id="new-name-${key}">
                            <input type="number" placeholder="Amount" id="new-amount-${key}">
                            <button class="kanban-btn primary" onclick="addSubcategory('${key}')">Add</button>
                            <button class="kanban-btn" onclick="cancelAddSubcategory('${key}')">Cancel</button>
                        </div>
                        <button class="kanban-btn" onclick="showAddForm('${key}')" style="width: 100%; margin-top: var(--space-3);">
                            + Add Line Item
                        </button>
                    </div>`;
                }

                html += `</div>`;
                return html;
            }).join('');

            // Add event listeners to main sliders
            Object.keys(budgetMarketData).forEach(key => {
                const slider = document.getElementById(`slider-${key}`);
                if (slider) {
                    slider.addEventListener('input', (e) => {
                        updateBudgetItem(key, parseInt(e.target.value));
                    });
                }
            });

            // Add event listeners to subcategory sliders
            if (granularView) {
                Object.keys(subcategoryData).forEach(category => {
                    Object.keys(subcategoryData[category]).forEach(subKey => {
                        const slider = document.getElementById(`slider-${category}-${subKey}`);
                        if (slider) {
                            slider.addEventListener('input', (e) => {
                                updateSubcategoryItem(category, subKey, parseInt(e.target.value));
                            });
                        }
                    });
                });
            }
        }

        function getRiskClass(key, value) {
            const item = budgetMarketData[key];
            const lowMidThreshold = (item.marketLow + item.marketMid) / 2;
            
            if (value < lowMidThreshold) return 'risk-high';
            if (value < item.sweetSpot) return 'risk-medium';
            if (value <= item.marketHigh) return 'risk-low';
            if (value <= item.maxRecommended) return 'risk-medium'; // Premium but acceptable
            return 'risk-high'; // Overspend
        }

        function getRiskIndicator(key, value) {
            const item = budgetMarketData[key];
            const lowMidThreshold = (item.marketLow + item.marketMid) / 2;
            
            if (value < lowMidThreshold) return '<span class="planner-risk-indicator high">HIGH RISK</span>';
            if (value < item.sweetSpot) return '<span class="planner-risk-indicator medium">CAUTION</span>';
            if (value <= item.marketHigh) return '<span class="planner-risk-indicator low">⭐ OPTIMAL</span>';
            if (value <= item.maxRecommended) return '<span class="planner-risk-indicator medium">PREMIUM</span>';
            return '<span class="planner-risk-indicator high">OVERSPEND</span>';
        }

        function getImpactText(key, value) {
            const item = budgetMarketData[key];
            const lowMidThreshold = (item.marketLow + item.marketMid) / 2;
            
            if (value < lowMidThreshold) return item.impacts.low;
            if (value < item.sweetSpot) return item.impacts.mid;
            if (value <= item.marketHigh) return item.impacts.sweet;
            if (value <= item.maxRecommended) return item.impacts.high;
            return item.impacts.excessive;
        }

        // Get zone for a given value
        function getZone(item, value) {
            const lowMidThreshold = (item.marketLow + item.marketMid) / 2;
            
            if (value < lowMidThreshold) return 'risk';
            if (value < item.sweetSpot) return 'caution';
            if (value <= item.marketHigh) return 'optimal';
            if (value <= item.maxRecommended) return 'premium';
            return 'overspend';
        }

        // Get tags for display based on value and zone
        function getTags(categoryKey, subcategoryKey, value) {
            const data = subcategoryKey ? 
                subcategoryData[categoryKey][subcategoryKey] : 
                budgetMarketData[categoryKey];
            
            if (!data || !data.tags) return [];
            
            const zone = getZone(data, value);
            return data.tags[zone] || [];
        }

        // Render tags HTML
        function renderTags(tags, zone) {
            if (!tags || tags.length === 0) return '';
            
            return `<div class="planner-tags-container">
                ${tags.map(tag => `<span class="planner-tag ${zone}">${tag}</span>`).join('')}
            </div>`;
        }

        function updateBudgetItem(key, value) {
            proposedBudget[key] = value;
            
            // Update display
            const proposedElement = document.querySelector(`[data-item="${key}-proposed"]`);
            if (proposedElement) {
                proposedElement.textContent = `$${(value / 1000).toFixed(0)}K`;
            }
            
            // Update risk indicator
            const riskElement = document.getElementById(`risk-${key}`);
            if (riskElement) {
                riskElement.innerHTML = getRiskIndicator(key, value);
            }
            
            // Update tags without full re-render
            const tagsContainer = document.getElementById(`tags-${key}`);
            if (tagsContainer) {
                const item = budgetMarketData[key];
                const zone = getZone(item, value);
                const tags = budgetMarketData[key].tags ? budgetMarketData[key].tags[zone] : [];
                tagsContainer.innerHTML = renderTags(tags, zone);
            }
            
            updateSummary();
            checkForChanges();
        }

        function updateSummary() {
            const total = Object.values(proposedBudget).reduce((sum, val) => sum + val, 0);
            const currentTotal = Object.values(budgetMarketData).reduce((sum, item) => sum + item.current, 0);
            
            document.getElementById('proposed-total').textContent = 
                `$${(total / 1000000).toFixed(1)}M`;
            
            if (comparisonMode) {
                document.getElementById('current-total').textContent = 
                    `$${(currentTotal / 1000000).toFixed(1)}M`;
            }

            // Calculate market position
            const optimalTotal = Object.values(budgetMarketData).reduce((sum, item) => sum + item.marketMid, 0);
            const percentile = Math.round((total / optimalTotal) * 50 + 25);
            document.getElementById('market-position').textContent = `${percentile}th Percentile`;

            // Count risks
            let highRisks = 0;
            Object.keys(budgetMarketData).forEach(key => {
                if (getRiskClass(key, proposedBudget[key]) === 'risk-high') highRisks++;
            });

            const riskCard = document.getElementById('risk-card');
            if (highRisks > 0) {
                riskCard.className = 'planner-summary-card risk-high';
                document.getElementById('risk-count').textContent = `${highRisks} Critical`;
                document.getElementById('risk-summary').textContent = 'Action required';
            } else {
                riskCard.className = 'planner-summary-card risk-low';
                document.getElementById('risk-count').textContent = '0 Critical';
                document.getElementById('risk-summary').textContent = 'All systems nominal';
            }
        }

        function setupBudgetControls() {
            // Toggle granular view
            document.getElementById('toggle-granular-view')?.addEventListener('click', (e) => {
                granularView = !granularView;
                e.target.textContent = granularView ? '📊 Hide Detailed Breakdown' : '📊 Show Detailed Breakdown';
                e.target.classList.toggle('active');
                renderBudgetItems();
            });

            // Load current budget
            document.getElementById('load-current-budget')?.addEventListener('click', () => {
                Object.keys(budgetMarketData).forEach(key => {
                    proposedBudget[key] = budgetMarketData[key].current;
                    const slider = document.getElementById(`slider-${key}`);
                    if (slider) slider.value = budgetMarketData[key].current;
                    
                    // Load current for subcategories
                    if (subcategoryData[key]) {
                        Object.keys(subcategoryData[key]).forEach(subKey => {
                            proposedSubBudgets[key][subKey] = subcategoryData[key][subKey].current;
                        });
                    }
                });
                renderBudgetItems();
                updateSummary();
            });

            // Toggle comparison
            document.getElementById('compare-mode-toggle')?.addEventListener('click', (e) => {
                comparisonMode = !comparisonMode;
                e.target.textContent = comparisonMode ? '👁️ Hide Comparison' : '👁️ Show Comparison';
                document.getElementById('current-total-card').style.display = 
                    comparisonMode ? 'block' : 'none';
                renderBudgetItems();
            });

            // Reset to optimal
            document.getElementById('reset-to-optimal')?.addEventListener('click', () => {
                if (confirm('Reset all values to optimal (sweet spot) levels?')) {
                    Object.keys(budgetMarketData).forEach(key => {
                        proposedBudget[key] = budgetMarketData[key].sweetSpot;
                        
                        // Reset subcategories
                        if (subcategoryData[key]) {
                            Object.keys(subcategoryData[key]).forEach(subKey => {
                                proposedSubBudgets[key][subKey] = subcategoryData[key][subKey].sweetSpot;
                            });
                        }
                    });
                    renderBudgetItems();
                    updateSummary();
                }
            });

            // Save to 2026
            document.getElementById('save-to-2026')?.addEventListener('click', () => {
                if (confirm('Save this budget configuration as the official 2026 IT Budget?')) {
                    alert('✅ Budget saved! Changes will reflect in the "2026 IT Budget" tab.');
                    document.getElementById('save-to-2026').style.display = 'none';
                }
            });
        }

        function checkForChanges() {
            // Show save button if values differ from optimal
            let hasChanges = false;
            Object.keys(budgetMarketData).forEach(key => {
                if (proposedBudget[key] !== budgetMarketData[key].marketMid) {
                    hasChanges = true;
                }
            });
            document.getElementById('save-to-2026').style.display = 
                hasChanges ? 'block' : 'none';
        }

        function applyManualValue(key) {
            const input = document.getElementById(`manual-${key}`);
            const value = parseInt(input.value);
            
            if (isNaN(value) || value < 0) {
                alert('Please enter a valid amount');
                return;
            }

            const item = budgetMarketData[key];
            
            // Check if dangerously low (below 70% of market minimum)
            if (value < item.marketLow * 0.7) {
                input.parentElement.classList.add('deep-red');
                if (!confirm(`⚠️ WARNING: This value is ${Math.round((1 - value/item.marketLow) * 100)}% below minimum market rate. This creates severe operational risk. Continue?`)) {
                    return;
                }
            } 
            // Check if excessive (above max recommended)
            else if (value > item.maxRecommended * 1.2) {
                if (!confirm(`⚠️ WARNING: This value is ${Math.round((value/item.maxRecommended - 1) * 100)}% above recommended maximum. This may indicate overspending with diminishing returns. Continue?`)) {
                    return;
                }
            } else {
                input.parentElement.classList.remove('deep-red');
            }

            proposedBudget[key] = value;
            const slider = document.getElementById(`slider-${key}`);
            if (slider) {
                // Extend slider range if needed
                if (value > slider.max) slider.max = value;
                if (value < slider.min) slider.min = value;
                slider.value = value;
            }
            
            updateBudgetItem(key, value);
            input.value = '';
        }

        // Make applyManualValue globally accessible
        window.applyManualValue = applyManualValue;

        // Make global helper functions accessible
        window.editSubcategory = function(category, subKey) {
            const newName = prompt('Edit name:', subcategoryData[category][subKey].name);
            if (newName) {
                subcategoryData[category][subKey].name = newName;
                renderBudgetItems();
            }
        };

        window.removeSubcategory = function(category, subKey) {
            if (confirm(`Remove ${subcategoryData[category][subKey].name}?`)) {
                delete subcategoryData[category][subKey];
                delete proposedSubBudgets[category][subKey];
                renderBudgetItems();
                updateSummary();
            }
        };

        window.showAddForm = function(category) {
            document.getElementById(`add-form-${category}`).style.display = 'flex';
        };

        window.cancelAddSubcategory = function(category) {
            document.getElementById(`add-form-${category}`).style.display = 'none';
            document.getElementById(`new-name-${category}`).value = '';
            document.getElementById(`new-amount-${category}`).value = '';
        };

        window.addSubcategory = function(category) {
            const name = document.getElementById(`new-name-${category}`).value;
            const amount = parseInt(document.getElementById(`new-amount-${category}`).value);
            
            if (!name || !amount) {
                alert('Please enter both name and amount');
                return;
            }

            // Create new subcategory with estimated market ranges
            const newKey = name.toLowerCase().replace(/\s+/g, '_');
            subcategoryData[category][newKey] = {
                name: name,
                current: amount,
                marketLow: amount * 0.9,
                marketMid: amount,
                sweetSpot: amount * 1.05,
                marketHigh: amount * 1.2,
                maxRecommended: amount * 1.4,
                tags: {
                    risk: ['Underfunded'],
                    caution: ['Baseline'],
                    optimal: ['Well-funded'],
                    premium: ['Premium tier'],
                    overspend: ['Excessive']
                }
            };

            proposedSubBudgets[category][newKey] = amount;
            
            window.cancelAddSubcategory(category);
            renderBudgetItems();
            updateSummary();
        };

        function updateSubcategoryItem(category, subKey, value) {
            proposedSubBudgets[category][subKey] = value;
            
            // Recalculate parent category total
            let total = 0;
            Object.keys(proposedSubBudgets[category]).forEach(sk => {
                total += proposedSubBudgets[category][sk];
            });
            proposedBudget[category] = total;
            
            // Update display
            updateSummary();
            renderBudgetItems();
        }

        // Initialize budget planner when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initBudgetPlanner);
        } else {
            initBudgetPlanner();
        }

        // ==================== BUDGET PLANNER TABLE VIEW ====================
        
        function initBudgetPlannerTable() {
            renderTableView();
            setupTableControls();
        }

        let tableComparisonMode = false;

        function setupTableControls() {
            // Toggle data sources
            window.toggleDataSources = function() {
                const content = document.getElementById('data-sources-content');
                const toggle = document.getElementById('data-sources-toggle');
                if (content.style.display === 'none') {
                    content.style.display = 'block';
                    toggle.textContent = 'Hide Details ▲';
                } else {
                    content.style.display = 'none';
                    toggle.textContent = 'Show Details ▼';
                }
            };

            // Configure Current Budget
            document.getElementById('table-configure-current')?.addEventListener('click', () => {
                openConfigureModal();
            });

            // Add new line item
            document.getElementById('table-add-line-item')?.addEventListener('click', () => {
                openAddItemModal();
            });

            // Load current budget
            document.getElementById('table-load-current')?.addEventListener('click', () => {
                Object.keys(subcategoryData).forEach(categoryKey => {
                    Object.keys(subcategoryData[categoryKey]).forEach(subKey => {
                        proposedSubBudgets[categoryKey][subKey] = subcategoryData[categoryKey][subKey].current;
                    });
                });
                renderTableView();
                alert('📋 Current budget loaded. This shows your actual spending today vs. optimal levels.');
            });

            // Toggle comparison
            document.getElementById('table-compare-toggle')?.addEventListener('click', (e) => {
                tableComparisonMode = !tableComparisonMode;
                e.target.textContent = tableComparisonMode ? '👁️ Hide Current Comparison' : '👁️ Show Current Comparison';
                document.getElementById('table-current-card').style.display = 
                    tableComparisonMode ? 'block' : 'none';
                document.getElementById('current-budget-explanation').style.display = 
                    tableComparisonMode ? 'block' : 'none';
                renderTableView();
            });

            // Reset to optimal
            document.getElementById('table-reset-optimal')?.addEventListener('click', () => {
                if (confirm('Reset all line items to optimal (sweet spot) levels?')) {
                    Object.keys(subcategoryData).forEach(categoryKey => {
                        Object.keys(subcategoryData[categoryKey]).forEach(subKey => {
                            proposedSubBudgets[categoryKey][subKey] = subcategoryData[categoryKey][subKey].sweetSpot;
                        });
                    });
                    renderTableView();
                }
            });

            // Save to 2026 Budget
            document.getElementById('table-save-2026')?.addEventListener('click', () => {
                if (confirm('Save this budget configuration as the official 2026 IT Budget?')) {
                    // Update the 2026 IT Budget tab with new values
                    updateBudgetTab();
                    alert('✅ Budget saved! Changes are now reflected in the "2026 IT Budget" tab.');
                    document.getElementById('table-save-2026').style.display = 'none';
                }
            });
        }

        // Function to update the 2026 IT Budget tab with new values
        function updateBudgetTab() {
            // Calculate category totals from subcategories
            const categoryTotals = {
                infrastructure: 0,
                personnel: 0,
                software: 0,
                security: 0
            };
            
            Object.keys(subcategoryData).forEach(categoryKey => {
                Object.keys(subcategoryData[categoryKey]).forEach(subKey => {
                    categoryTotals[categoryKey] += proposedSubBudgets[categoryKey][subKey];
                });
            });

            const total = Object.values(categoryTotals).reduce((sum, val) => sum + val, 0);

            // Update summary cards at top
            const budgetCards = document.querySelectorAll('#profile-budget .budget-card');
            if (budgetCards[0]) { // Total
                const valueDiv = budgetCards[0].querySelector('.budget-card-value');
                if (valueDiv) valueDiv.textContent = `$${(total / 1000000).toFixed(1)}M`;
            }
            if (budgetCards[1]) { // Infrastructure
                const valueDiv = budgetCards[1].querySelector('.budget-card-value');
                if (valueDiv) valueDiv.textContent = `$${(categoryTotals.infrastructure / 1000).toFixed(0)}K`;
                const changeDiv = budgetCards[1].querySelector('.budget-card-change');
                if (changeDiv) changeDiv.textContent = `${Math.round((categoryTotals.infrastructure / total) * 100)}% of budget`;
            }
            if (budgetCards[2]) { // Personnel
                const valueDiv = budgetCards[2].querySelector('.budget-card-value');
                if (valueDiv) valueDiv.textContent = `$${(categoryTotals.personnel / 1000).toFixed(0)}K`;
                const changeDiv = budgetCards[2].querySelector('.budget-card-change');
                if (changeDiv) changeDiv.textContent = `${Math.round((categoryTotals.personnel / total) * 100)}% of budget`;
            }
            if (budgetCards[3]) { // Software
                const valueDiv = budgetCards[3].querySelector('.budget-card-value');
                if (valueDiv) valueDiv.textContent = `$${(categoryTotals.software / 1000).toFixed(0)}K`;
                const changeDiv = budgetCards[3].querySelector('.budget-card-change');
                if (changeDiv) changeDiv.textContent = `${Math.round((categoryTotals.software / total) * 100)}% of budget`;
            }

            // Update category headers in table
            const tableRows = document.querySelectorAll('#profile-budget .budget-table tbody tr');
            tableRows.forEach(row => {
                const categoryCell = row.querySelector('.budget-category');
                if (categoryCell) {
                    const text = categoryCell.textContent;
                    if (text.includes('Infrastructure & Operations')) {
                        categoryCell.textContent = `Infrastructure & Operations — $${(categoryTotals.infrastructure / 1000).toFixed(0)},000`;
                    } else if (text.includes('Personnel')) {
                        categoryCell.textContent = `Personnel — $${(categoryTotals.personnel / 1000).toFixed(0)},000`;
                    } else if (text.includes('Software & Licenses')) {
                        categoryCell.textContent = `Software & Licenses — $${(categoryTotals.software / 1000).toFixed(0)},000`;
                    } else if (text.includes('Strategic Initiatives')) {
                        // Map security to strategic initiatives or keep separate
                        categoryCell.textContent = `Strategic Initiatives — $${(categoryTotals.security / 1000).toFixed(0)},000`;
                    }
                }
            });

            // Update total row
            const totalRow = document.querySelector('#profile-budget .budget-total-row td:last-child');
            if (totalRow) {
                totalRow.textContent = `$${(total / 1000000).toFixed(1)}M`;
            }

            console.log('✅ Budget tab updated:', {
                total: `$${(total / 1000000).toFixed(1)}M`,
                infrastructure: `$${(categoryTotals.infrastructure / 1000).toFixed(0)}K`,
                personnel: `$${(categoryTotals.personnel / 1000).toFixed(0)}K`,
                software: `$${(categoryTotals.software / 1000).toFixed(0)}K`,
                security: `$${(categoryTotals.security / 1000).toFixed(0)}K`
            });
        }

        function renderTableView() {
            const tbody = document.getElementById('table-budget-items');
            if (!tbody) return;

            let html = '';
            let totalProposed = 0;
            let totalCurrent = 0;
            let criticalCount = 0;

            // Update table headers if comparison mode
            const thead = tbody.parentElement.querySelector('thead tr');
            if (thead) {
                if (tableComparisonMode) {
                    thead.innerHTML = `
                        <th>Category</th>
                        <th>Description</th>
                        <th>Current</th>
                        <th>Proposed</th>
                    `;
                } else {
                    thead.innerHTML = `
                        <th>Category</th>
                        <th>Description</th>
                        <th>Annual Cost</th>
                    `;
                }
            }

            Object.keys(subcategoryData).forEach(categoryKey => {
                const category = budgetMarketData[categoryKey];
                let categoryTotal = 0;

                // Category header row
                html += `
                    <tr class="category-row">
                        <td colspan="${tableComparisonMode ? 4 : 3}">${category.name}</td>
                    </tr>
                `;

                // Subcategory rows
                Object.keys(subcategoryData[categoryKey]).forEach(subKey => {
                    const subItem = subcategoryData[categoryKey][subKey];
                    const value = proposedSubBudgets[categoryKey]?.[subKey] || subItem.sweetSpot;
                    const zone = getZone(subItem, value);
                    const tags = subItem.tags ? subItem.tags[zone] : [];
                    
                    categoryTotal += value;
                    totalProposed += value;
                    totalCurrent += subItem.current;

                    // Determine risk class for row styling
                    let riskClass = '';
                    const lowMidThreshold = (subItem.marketLow + subItem.marketMid) / 2;
                    if (value < lowMidThreshold * 0.8) {
                        riskClass = 'risk-severe';
                        criticalCount++;
                    } else if (value < lowMidThreshold) {
                        riskClass = 'risk-critical';
                        criticalCount++;
                    }

                    html += `
                        <tr class="subcategory-row ${riskClass}">
                            <td class="category-cell">${subItem.name}</td>
                            <td class="description-cell">
                                <div class="table-description">${getTableDescription(categoryKey, subKey)}</div>
                                <div class="planner-tags-container" id="table-tags-${categoryKey}-${subKey}">
                                    ${renderTags(tags, zone)}
                                </div>
                            </td>
                            ${tableComparisonMode ? `
                                <td style="padding: var(--space-3) var(--space-5);">
                                    <div style="font-size: 14px; font-weight: 600; color: var(--gray-500);">
                                        $${(subItem.current / 1000).toFixed(0)}K
                                    </div>
                                </td>
                            ` : ''}
                            <td class="slider-cell">
                                <div class="table-slider-wrapper">
                                    <div class="table-slider-container">
                                        <input 
                                            type="range" 
                                            class="table-slider" 
                                            id="table-slider-${categoryKey}-${subKey}"
                                            min="${subItem.marketLow}" 
                                            max="${subItem.maxRecommended}" 
                                            value="${value}"
                                            step="5000"
                                            data-category="${categoryKey}"
                                            data-subcategory="${subKey}">
                                    </div>
                                    <div class="table-value-display" id="table-value-${categoryKey}-${subKey}">
                                        $${(value / 1000).toFixed(0)}K
                                    </div>
                                    <input 
                                        type="number" 
                                        class="table-manual-input"
                                        id="table-manual-${categoryKey}-${subKey}"
                                        placeholder="$"
                                        data-category="${categoryKey}"
                                        data-subcategory="${subKey}">
                                </div>
                            </td>
                        </tr>
                    `;
                });
            });

            tbody.innerHTML = html;

            // Update summary cards
            updateTableSummary(totalProposed, totalCurrent, criticalCount);

            // Add event listeners
            Object.keys(subcategoryData).forEach(categoryKey => {
                Object.keys(subcategoryData[categoryKey]).forEach(subKey => {
                    const slider = document.getElementById(`table-slider-${categoryKey}-${subKey}`);
                    if (slider) {
                        slider.addEventListener('input', (e) => {
                            updateTableItem(categoryKey, subKey, parseInt(e.target.value));
                        });
                    }

                    const input = document.getElementById(`table-manual-${categoryKey}-${subKey}`);
                    if (input) {
                        input.addEventListener('keypress', (e) => {
                            if (e.key === 'Enter') {
                                const value = parseInt(input.value) * 1000; // Convert K to actual
                                if (!isNaN(value)) {
                                    updateTableItem(categoryKey, subKey, value);
                                    input.value = '';
                                }
                            }
                        });
                    }
                });
            });
        }

        function getTableDescription(categoryKey, subKey) {
            // Check for custom user-added descriptions first
            if (window.customDescriptions && window.customDescriptions[`${categoryKey}-${subKey}`]) {
                return window.customDescriptions[`${categoryKey}-${subKey}`];
            }

            // Check if subcategory has description property
            if (subcategoryData[categoryKey][subKey].description) {
                return subcategoryData[categoryKey][subKey].description;
            }

            // Default descriptions
            const descriptions = {
                infrastructure: {
                    network: 'SD-WAN circuits, switches, cabling, bandwidth - all facilities',
                    cloud: 'Azure/AWS hosting, data center colocation, cloud storage & compute',
                    virtualization: 'Nutanix platform, server hardware, hypervisor licensing (VMware/Hyper-V)',
                    hardware: 'Workstations, laptops, tablets, printers, peripheral equipment',
                    maintenance: '24/7 vendor support contracts, warranties, professional services'
                },
                personnel: {
                    leadership: 'IT Director/VP compensation, benefits, bonuses (Anthony, Geremia)',
                    technical: 'Network admins, service delivery specialists, clinical IT staff (Francis, Tom, Rogi)',
                    database: 'Database administrator compensation and benefits (Jon)',
                    training: 'Certifications (CompTIA, Microsoft, Cisco), conferences, continuing education'
                },
                software: {
                    clinical: 'PointClickCare EHR/billing platform and ancillary clinical SaaS subscriptions',
                    business: 'ERP (financial/operations), MDM (Jamf/MaaS360), eFax, business applications',
                    productivity: 'Microsoft 365 E3/E5 licenses, email, Teams, OneDrive, identity (Azure AD)',
                    servicedesk: 'ITSM platform (ticketing, asset management), monitoring tools, AI Tier-0 bot'
                },
                security: {
                    infrastructure_security: 'Next-gen firewalls (Fortinet/Palo Alto), network segmentation, Zero Trust components',
                    endpoint_security: 'EDR (CrowdStrike/SentinelOne), antivirus, email security (Proofpoint/Mimecast)',
                    compliance: 'Audit support, GRC tools, documentation management, consultant fees',
                    training_awareness: 'KnowBe4/similar platform, phishing simulations, security awareness campaigns'
                }
            };

            return descriptions[categoryKey]?.[subKey] || '';
        }

        function updateTableItem(categoryKey, subKey, value) {
            proposedSubBudgets[categoryKey][subKey] = value;

            // Update display
            document.getElementById(`table-value-${categoryKey}-${subKey}`).textContent = 
                `$${(value / 1000).toFixed(0)}K`;

            // Update tags
            const subItem = subcategoryData[categoryKey][subKey];
            const zone = getZone(subItem, value);
            const tags = subItem.tags ? subItem.tags[zone] : [];
            document.getElementById(`table-tags-${categoryKey}-${subKey}`).innerHTML = 
                renderTags(tags, zone);

            // Update row styling based on risk
            const row = document.getElementById(`table-slider-${categoryKey}-${subKey}`)?.closest('tr');
            if (row) {
                row.classList.remove('risk-critical', 'risk-severe');
                const lowMidThreshold = (subItem.marketLow + subItem.marketMid) / 2;
                if (value < lowMidThreshold * 0.8) {
                    row.classList.add('risk-severe');
                } else if (value < lowMidThreshold) {
                    row.classList.add('risk-critical');
                }
            }

            // Calculate totals and update summary
            let totalProposed = 0;
            let totalCurrent = 0;
            let criticalCount = 0;
            
            Object.keys(subcategoryData).forEach(catKey => {
                Object.keys(subcategoryData[catKey]).forEach(sKey => {
                    const val = proposedSubBudgets[catKey][sKey];
                    const item = subcategoryData[catKey][sKey];
                    totalProposed += val;
                    totalCurrent += item.current;
                    
                    const threshold = (item.marketLow + item.marketMid) / 2;
                    if (val < threshold) criticalCount++;
                });
            });

            updateTableSummary(totalProposed, totalCurrent, criticalCount);

            // Show save button
            document.getElementById('table-save-2026').style.display = 'block';
        }

        function updateTableSummary(totalProposed, totalCurrent, criticalCount) {
            // Update proposed total
            document.getElementById('table-proposed-total').textContent = 
                `$${(totalProposed / 1000000).toFixed(1)}M`;

            // Update current total (if in comparison mode)
            document.getElementById('table-current-total').textContent = 
                `$${(totalCurrent / 1000000).toFixed(1)}M`;

            // Calculate market position (percentile)
            let optimalTotal = 0;
            let lowTotal = 0;
            let highTotal = 0;
            Object.keys(subcategoryData).forEach(catKey => {
                Object.keys(subcategoryData[catKey]).forEach(sKey => {
                    const item = subcategoryData[catKey][sKey];
                    optimalTotal += item.sweetSpot;
                    lowTotal += item.marketLow;
                    highTotal += item.maxRecommended;
                });
            });

            const range = highTotal - lowTotal;
            const position = totalProposed - lowTotal;
            const percentile = Math.max(0, Math.min(100, Math.round((position / range) * 100)));

            document.getElementById('table-market-position').textContent = `${percentile}th Percentile`;
            
            let positionLabel = 'Low-Market';
            let positionColor = 'risk-high';
            if (percentile >= 40 && percentile <= 60) {
                positionLabel = 'Mid-Market (Optimal)';
                positionColor = 'risk-low';
            } else if (percentile > 60 && percentile <= 80) {
                positionLabel = 'Above Market';
                positionColor = 'risk-medium';
            } else if (percentile > 80) {
                positionLabel = 'Premium Tier';
                positionColor = 'risk-medium';
            }
            document.getElementById('table-market-detail').textContent = positionLabel;
            
            const marketCard = document.getElementById('table-market-card');
            marketCard.className = `planner-summary-card ${positionColor}`;

            // Update risk assessment
            const totalCard = document.getElementById('table-total-card');
            if (criticalCount > 0) {
                totalCard.className = 'planner-summary-card risk-high';
                document.getElementById('table-proposed-status').textContent = `${criticalCount} areas underfunded`;
            } else if (percentile < 40) {
                totalCard.className = 'planner-summary-card risk-medium';
                document.getElementById('table-proposed-status').textContent = 'Below optimal range';
            } else if (percentile > 80) {
                totalCard.className = 'planner-summary-card risk-medium';
                document.getElementById('table-proposed-status').textContent = 'Above optimal range';
            } else {
                totalCard.className = 'planner-summary-card risk-low';
                document.getElementById('table-proposed-status').textContent = 'Optimal range';
            }

            // Update risk count card
            const riskCard = document.getElementById('table-risk-summary-card');
            if (criticalCount > 5) {
                riskCard.className = 'planner-summary-card risk-high';
                document.getElementById('table-risk-count').textContent = `${criticalCount} Critical`;
                document.getElementById('table-risk-summary').textContent = 'Immediate action required';
            } else if (criticalCount > 0) {
                riskCard.className = 'planner-summary-card risk-medium';
                document.getElementById('table-risk-count').textContent = `${criticalCount} At Risk`;
                document.getElementById('table-risk-summary').textContent = 'Attention needed';
            } else {
                riskCard.className = 'planner-summary-card risk-low';
                document.getElementById('table-risk-count').textContent = '0 Critical';
                document.getElementById('table-risk-summary').textContent = 'All systems nominal';
            }
        }

        // Initialize table view when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initBudgetPlannerTable);
        } else {
            initBudgetPlannerTable();
        }

        // ==================== MODAL FUNCTIONS ====================

        // Generate smart tags based on item type and category
        function generateSmartTags(categoryKey, name, description) {
            const nameLower = name.toLowerCase();
            const descLower = (description || '').toLowerCase();
            const combined = nameLower + ' ' + descLower;

            // Detect item type
            const isHardware = /ups|hardware|server|switch|router|firewall|device|equipment|workstation|laptop|printer/i.test(combined);
            const isSoftware = /software|license|subscription|saas|platform|tool|application/i.test(combined);
            const isPersonnel = /salary|compensation|staff|employee|headcount|hire|contractor/i.test(combined);
            const isService = /service|support|contract|maintenance|warranty|professional services/i.test(combined);
            const isNetwork = /network|bandwidth|circuit|connectivity|internet|wan|lan/i.test(combined);
            const isSecurity = /security|firewall|protection|antivirus|edr|encryption/i.test(combined);

            // Generate contextual tags
            let tags = {
                risk: [],
                caution: [],
                optimal: [],
                premium: [],
                overspend: []
            };

            if (isHardware) {
                tags.risk = ['Inadequate redundancy', 'Equipment failure risk', 'Downtime exposure', 'No spare capacity'];
                tags.caution = ['Basic redundancy', 'Minimal spares', 'Limited lifecycle budget'];
                tags.optimal = ['N+1 redundancy', 'Proper spare pool', 'Reliable operation', 'Lifecycle funded'];
                tags.premium = ['N+2 redundancy', 'Excessive spares', 'Over-spec\'d'];
                tags.overspend = ['Unnecessary redundancy', 'Unused equipment', 'Capital waste', 'Overbuilt'];
            } else if (isSoftware) {
                tags.risk = ['Feature gaps', 'Manual workarounds', 'Productivity loss', 'User frustration'];
                tags.caution = ['Basic features', 'Limited licenses', 'Some manual work'];
                tags.optimal = ['Full feature set', 'Adequate licenses', 'High productivity', 'User satisfaction'];
                tags.premium = ['Advanced features', 'Generous licensing', 'Nice-to-haves'];
                tags.overspend = ['Unused licenses', 'Feature bloat', 'Shelfware', 'Poor utilization'];
            } else if (isPersonnel) {
                tags.risk = ['Below market rate', 'Turnover risk', 'Recruiting difficulty', 'Understaffed'];
                tags.caution = ['Market competitive', 'Adequate staffing', 'Some turnover'];
                tags.optimal = ['Strong compensation', 'Proper staffing', 'Low turnover', 'Attracts talent'];
                tags.premium = ['Above market pay', 'Generous benefits', 'Premium talent'];
                tags.overspend = ['Excessive compensation', 'Overstaffed', 'Margin pressure', 'Unsustainable'];
            } else if (isService) {
                tags.risk = ['Limited support', 'Slow response', 'Extended downtime', 'Warranty gaps'];
                tags.caution = ['Basic support', 'Standard SLAs', 'Some delays'];
                tags.optimal = ['24/7 support', 'Fast response', 'Vendor partnership', 'Minimal downtime'];
                tags.premium = ['White-glove service', 'Dedicated support', 'Premium SLAs'];
                tags.overspend = ['Redundant contracts', 'Overlapping support', 'Excessive coverage'];
            } else if (isNetwork) {
                tags.risk = ['Bandwidth constraints', 'Poor performance', 'Can\'t support growth', 'User complaints'];
                tags.caution = ['Adequate bandwidth', 'Some congestion', 'Limited headroom'];
                tags.optimal = ['Ample bandwidth', 'Good performance', 'Growth ready', 'User satisfaction'];
                tags.premium = ['Premium bandwidth', 'Maximum performance', 'Excess capacity'];
                tags.overspend = ['Unused bandwidth', 'Over-provisioned', 'Poor ROI'];
            } else if (isSecurity) {
                tags.risk = ['Security gaps', 'Breach exposure', 'Compliance risk', 'Inadequate protection'];
                tags.caution = ['Basic protection', 'Compliance maintained', 'Some gaps'];
                tags.optimal = ['Strong security', 'Proactive defense', 'Compliance solid', 'Low risk'];
                tags.premium = ['Maximum security', 'Advanced threat protection', 'Extensive coverage'];
                tags.overspend = ['Security theater', 'Overlapping tools', 'Diminishing returns'];
            } else {
                // Generic fallback for unknown types
                tags.risk = ['Underfunded', 'Service gaps', 'Operational risk', 'Limited capability'];
                tags.caution = ['Baseline functional', 'Some limitations', 'Growth constrained'];
                tags.optimal = ['Well-funded', 'Reliable service', 'Supports growth', 'Best value'];
                tags.premium = ['Premium tier', 'Advanced features', 'Excess capacity'];
                tags.overspend = ['Overbuilt', 'Underutilized', 'Poor ROI', 'Budget waste'];
            }

            return tags;
        }

        // Close modal when clicking outside
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('config-modal')) {
                e.target.classList.remove('active');
            }
        });

        function openConfigureModal() {
            const modal = document.getElementById('configure-current-modal');
            const form = document.getElementById('current-budget-form');
            
            let html = '';
            Object.keys(subcategoryData).forEach(categoryKey => {
                html += `<div style="margin-bottom: var(--space-6);"><h3 style="font-size: 16px; font-weight: 700; color: var(--navy-900); margin-bottom: var(--space-4); padding-bottom: var(--space-3); border-bottom: 2px solid var(--navy-800);">${budgetMarketData[categoryKey].name}</h3>`;
                
                Object.keys(subcategoryData[categoryKey]).forEach(subKey => {
                    const subItem = subcategoryData[categoryKey][subKey];
                    html += `
                        <div class="config-item">
                            <div class="config-item-label">${subItem.name}</div>
                            <input 
                                type="number" 
                                class="config-item-input" 
                                id="current-${categoryKey}-${subKey}"
                                value="${subItem.current}"
                                min="0"
                                placeholder="Current spending">
                        </div>
                    `;
                });
                
                html += '</div>';
            });
            
            form.innerHTML = html;
            modal.classList.add('active');
        }

        window.closeConfigureModal = function() {
            document.getElementById('configure-current-modal').classList.remove('active');
        };

        window.saveCurrentBudget = function() {
            Object.keys(subcategoryData).forEach(categoryKey => {
                Object.keys(subcategoryData[categoryKey]).forEach(subKey => {
                    const input = document.getElementById(`current-${categoryKey}-${subKey}`);
                    if (input) {
                        subcategoryData[categoryKey][subKey].current = parseInt(input.value) || 0;
                    }
                });
            });
            
            closeConfigureModal();
            alert('✅ Current budget values saved! Use "Load Current Budget" to apply these values.');
        };

        function openAddItemModal() {
            const modal = document.getElementById('add-item-modal');
            modal.classList.add('active');
            
            // Add click listener to submit button instead of form submit
            const submitBtn = document.getElementById('submit-new-line-item');
            submitBtn.onclick = function() {
                const categoryKey = document.getElementById('new-item-category').value;
                const name = document.getElementById('new-item-name').value;
                const currentValue = parseInt(document.getElementById('new-item-current').value) || 0;
                const proposed = parseInt(document.getElementById('new-item-proposed').value);
                const description = document.getElementById('new-item-description').value || name;

                console.log('Button clicked:', { categoryKey, name, currentValue, proposed, description });

                if (!categoryKey) {
                    alert('Please select a category');
                    return;
                }
                
                if (!name) {
                    alert('Please enter a line item name');
                    return;
                }
                
                if (!proposed || proposed <= 0) {
                    alert('Please enter a valid proposed cost');
                    return;
                }

                // Create new subcategory with intelligent tag generation
                const newKey = name.toLowerCase().replace(/[^a-z0-9]+/g, '_');
                
                // Check if key already exists
                if (subcategoryData[categoryKey] && subcategoryData[categoryKey][newKey]) {
                    if (!confirm(`A line item with this name already exists. Overwrite it?`)) {
                        return;
                    }
                }

                // Ensure subcategoryData[categoryKey] exists
                if (!subcategoryData[categoryKey]) {
                    subcategoryData[categoryKey] = {};
                }

                // Auto-generate market ranges with proposed as sweet spot
                subcategoryData[categoryKey][newKey] = {
                    name: name,
                    current: currentValue || Math.round(proposed * 0.70), // Current at 70% shows underfunding
                    marketLow: Math.round(proposed * 0.75), // 75% of proposed is minimum viable
                    marketMid: Math.round(proposed * 0.90), // 90% is baseline
                    sweetSpot: proposed, // YOUR proposed amount IS the sweet spot
                    marketHigh: Math.round(proposed * 1.15), // 15% above for premium
                    maxRecommended: Math.round(proposed * 1.35), // 35% above is max before waste
                    description: description,
                    tags: generateSmartTags(categoryKey, name, description)
                };

                // Initialize proposedSubBudgets[categoryKey] if needed
                if (!proposedSubBudgets[categoryKey]) {
                    proposedSubBudgets[categoryKey] = {};
                }

                proposedSubBudgets[categoryKey][newKey] = proposed;

                // Store custom description
                if (!window.customDescriptions) window.customDescriptions = {};
                window.customDescriptions[`${categoryKey}-${newKey}`] = description;

                console.log('Line item added successfully');

                // Close modal and refresh
                closeAddItemModal();
                renderTableView();
                
                alert(`✅ Added "${name}" to ${budgetMarketData[categoryKey].name}\n\nNew line item appears at the bottom of the ${budgetMarketData[categoryKey].name} section.`);
            };
        }

        window.closeAddItemModal = function() {
            const modal = document.getElementById('add-item-modal');
            modal.classList.remove('active');
            
            // Reset form
            const form = modal.querySelector('form');
            if (form) form.reset();
            
            // Clear individual fields as backup
            document.getElementById('new-item-category').value = '';
            document.getElementById('new-item-name').value = '';
            document.getElementById('new-item-current').value = '';
            document.getElementById('new-item-proposed').value = '';
            document.getElementById('new-item-description').value = '';
        };

    </script>
</body>
</html>
